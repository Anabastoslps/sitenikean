"use strict";ze.App=function(){this.appStateLog="",this.appState=ze.App.APP_STATE.DEFAULT,this.isInitialized=!1,this.zipFilename=null,this.zipFileSize=null,this.zipMimeType=null,this.isTarFile=!1,this.zipEntryTree=null,this.zipBlob=null,this.zipDriveFileId=null,this.zipIsDirty=!1,this.zipParentId=null,this.zipBlobSource=null,this.currentArchiveTypeString="ZIP",this.currentArchiveHeaderIsEncrypted=!1,this.currentExtractionLocation=ze.App.DEFAULT_DRIVE_EXTRACTION_LOCATION,this.skipCreateParentFolderForSession=!1,this.previousZipBlobs=[],this.previousZipFilenames=[],this.isInZipEditMode=!1,this.wasZipFileCreatedLocallyOrEdited=!1,this.isSavingToDrive=!1,this.wasSaveToDriveCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.willDownloadAfterDecompression=!1,this.isPreviewDecompressing=!1,this.wasPreviewDecompressionCancelled=!1,this.wasArchiveDecompressionProcessCancelled=!1,this.wasCheckPasswordCancelled=!1,this.hasDownloadBeenAutoRetried=!1,this.lastDownloadId=null,this.addFilesToZipOrEncryptZipCancelRequested=!1,this.doResumeOpenFromDriveAfterManualAuth=!1,this.doResumeExtractToDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToDriveAfterManualAuth=!1,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.doResumeChooseFolderLocationAfterManualAuth=!1,this.doResumeAddFilesToZipFromDriveAfterManualAuth=!1,this.fileIdToOpen=null,this.parentFolderId=null,this.asyncWorkQueue=new ze.AsyncWorkQueue(ze.App.MAX_WORKQUEUE_WORKERS),this.zipEntryStateMap={},this.zipEntriesInProcessMap={},this.totalSessionSize=0,this.currentSessionProgress=0,this.isSessionClosed=!1,this.isSessionAborted=!1,this.isSessionAbortedForThePurposesOfPreview=!1,this.abortedSessionWasForDownloadAllToLocal=!1,this.sessionHasBeenRetried=!1,this.isProcessingOpenLocalZipFileInputEl=!1,this.isProcessingOpenLocalZipPartFileInputEl=!1,this.isProcessingAddLocalFileInputEl=!1,this.isProcessingAddLocalFolderInputEl=!1,this.createZipFromFileAssociatedExtension=null,this.previewedEntry=null,this.previewedBlob=null,this.previewType=null,this.sessionPropMap={},this.highestZipEntryIndexUploadedInSession=0,this.hasAutoProceededWithDirectNewFlow=!1,this.currentAutodetectedEncoding=null,this.autoRefreshTokenTimer=null,this.isPreviewPdfDirty=!1,this.isPreviewDrvDirty=!1,this.errorCounter=0,this.isCurrentlyInJumpToZipOperation=!1,this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=null,this.cachedMistypedZipImageUri=null,this.extraZipPartsMap={},this.numExtraZipParts=0,this.zipPartsLoadedMask=[]},ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MINUTES=29,ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS=60*ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MINUTES*1e3,ze.App.ERR_WRITE_DATA="Error while writing file data",ze.App.ERR_READ_DATA="Error while reading file data",ze.App.ERR_READ_DATA_CRC="Error while reading file data (CRC32 check failed)",ze.App.ERR_INCORRECT_PASSWORD="Incorrect password provided",ze.App.ERR_GENERIC_DECOMPRESS="Error while decompressing entry",ze.App.DECOMPRESS_WORKER_MESSAGE_EVENT="message",ze.App.TEXTDECODER_ASCII=null,ze.App.TEXTDECODER_UTF8=null;try{"TextDecoder"in window&&(ze.App.TEXTDECODER_ASCII=new TextDecoder("ascii"),ze.App.TEXTDECODER_UTF8=new TextDecoder("utf-8"))}catch(e){logImpression("text_decoder_instantiate_error","app_load",e)}ze.App.LIB_JSCHARDET_SCRIPT_NAME="lib/jschardet/jschardet1-4-1.min.js",ze.App.LIB_ZIPWRITER_SCRIPT_NAME="lib/lib-zipwriter-1-min.js",ze.App.LIB_ZIPREADER_SCRIPT_NAME="lib/lib-zipreader-1-min.js",ze.App.LIB_CRYPTO_SCRIPT_NAME="lib/lib-crypto-5-maxmin.js",ze.App.LIB_RAR_SCRIPT_NAME="lib/lib-rar-7-min.js",ze.App.LIB_SEVENZIP_SCRIPT_NAME="lib/lib-sevenz-9-min.js",ze.App.LIB_BZIP_SCRIPT_NAME="lib/lib-bzip2-new-1-min.js",ze.App.LIB_LZMA_SCRIPT_NAME="lib/lib-lzma-new-3-min.js",ze.App.LIB_XZ_SCRIPT_NAME="lib/lib-xz-2-min.js",ze.App.LIB_INFLATE_SCRIPT_NAME="lib/lib-inflate-15-min.js",ze.App.LIB_PPMDH_SCRIPT_NAME="lib/lib-ppmdh-1-min.js",ze.App.LIB_PPMDI_SCRIPT_NAME="lib/lib-ppmdi-4-min.js",ze.App.CHUNK_SIZE_INFLATE=1048576,ze.App.CHUNK_SIZE_COPY=2097152,ze.App.CHUNK_SIZE_PPMDH=131072,ze.App.CHUNK_SIZE_PPMDI=131072,ze.App.CHUNK_SIZE_BZIP=524288,ze.App.CHUNK_SIZE_LZMA=524288,ze.App.CHUNK_SIZE_XZ=-1,ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK="zeZipWriter",ze.App.LIB_ZIPREADER_WINDOW_OBJECT_CHECK="zeZipReader",ze.App.LIB_SEVENZIP_WINDOW_OBJECT_CHECK="zeSevenZLib",ze.App.LIB_RAR_WINDOW_OBJECT_CHECK="RarNode_construct",ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK="zeCryptoLib",ze.App.LIB_JSCHARDET_WINDOW_OBJECT_CHECK="jschardet",ze.App.DEFAULT_DRIVE_EXTRACTION_LOCATION="Google Drive",ze.App.DEFAULT_PAGE_TITLE="ZIP Extractor - Free App for Opening and Creating ZIP Files",ze.App.SUPPORTED_ARCHIVE_EXTENSIONS=["zip","zipx","tar","rar","7z","gz","gzip","tgz","lzma","lz","tlz","bz","bz2","bzip","bzip2","tbz","tbz2","xz","txz","jar","war","ear","epub","apk"],ze.App.SUPPORTED_GOOGLE_DOCS_EXPORT_TYPES=["document","spreadsheet","presentation","drawing","jam"],ze.App.ENCRYPTION_MODE_NONE="none",ze.App.ENCRYPTION_MODE_UNKNOWN="unknown",ze.App.ENCRYPTION_MODE_PKZIPSTANDARD="pkzipstandard",ze.App.ENCRYPTION_MODE_PKZIPSTRONG="pkzipstrong",ze.App.ENCRYPTION_MODE_WINZIPAES="winzipaes",ze.App.ENCRYPTION_MODE_PKZIPOTHER="pkzipother",ze.App.ENCRYPTION_MODE_ENCRYPTEDCDR="encryptedcdr",ze.App.ENCRYPTION_MODE_7ZAES="7z-aes",ze.App.ENCRYPTION_MODE_RAR="rar-all",ze.App.ARCHIVE_TYPE={ZIP:"ZIP",RAR:"RAR",BZIP:"BZIP",GZIP:"GZIP",TAR:"TAR",XZ:"XZ",LZMA_STANDALONE:"LZMA",SEVENZIP:"7-Zip",LZIP:"LZIP"},ze.App.CANONICAL_MIME_TYPES={ZIP:"application/zip",ZIP2:"application/x-zip",ZIP3:"application/x-zip-compressed",GZIP:"application/x-gzip",GZIP2:"application/gzip",GZIP3:"application/x-gzip-compressed",GZIP4:"application/gzip-compressed",XZ:"application/x-xz",SEVENZIP:"application/x-7z-compressed",SEVENZIP2:"application/7z",RAR:"application/rar",RAR2:"application/x-rar",RAR3:"application/x-rar-compressed",RAR4:"application/vnd.rar",BZIP:"application/x-bzip2",BZIP2:"application/bzip2",BZIP3:"application/x-bzip",BZIP4:"application/bzip",BZIP5:"application/x-bz2",TAR:"application/x-tar",TAR2:"application/tar",LZIP:"application/lzip",LZIP2:"application/x-lzip",PNG:"image/png",BMP:"image/bmp",GIF:"image/gif",JPG:"image/jpg",PDF:"application/pdf",MP4:"video/mp4"},ze.App.SUPPORTED_MIME_TYPES=["application/zip","application/x-zip","application/x-zip-compressed","application/rar","application/x-rar","application/x-rar-compressed","application/vnd.rar","application/x-7z-compressed","application/7z","application/tar, application/x-tar","application/x-gzip","application/gzip","application/gzip-compressed","application/x-gzip-compressed","application/x-gtar","application/x-tgz","application/tar+gzip","application/x-gtar-compressed","application/bzip2","application/x-bzip","application/x-bzip2","application/x-bz2","application/bzip","application/x-xz","application/lzip","application/x-lzip","application/epub+zip","application/epub","application/java-archive","application/vnd.android.package-archive"],ze.App.DOCUMENT_REFERENCES=["startPagePrompt","startPageIconImg","startPageIconImgDrive","startPageIconImgGmail","startPageIconImgGeneral","startPageNewDetails","startPageDriveDetails","startPageDriveDetailsCallToAction","startPageGmailDetails","startPageGmailDetailsCallToAction","startPageGeneralDetails","startPageGeneralDetailsCallToAction","checkingAuthSpinner","authButtonContainer","generalButtonContainer","authButtonDetails","profileImageDiv","profileImageImg","profileName","openLocalZipFileInputEl","openLocalZipPartFileInputEl","addLocalFileInputEl","addLocalFolderInputEl","topBanner","startCard","appContent","mainWrapper","centeredBodyContent","mainApp","fileTableHeader","fileTableHeaderLabel","fileTableHeaderSize","fileTableContainer","fileTableAlternateImage","fileTableAlternateImageImg","mainLabel","secondaryLabel","secondaryLabelContainer","mainProgressBarContainer","mainProgressBar","selectAllCheckbox","rootStatus","rootStatusIcon","rootStatusIconContainer","rootStatusSpinner","addFilesFromComputerButton","addFolderButton","addFilesToZipFromDriveButton","addFilesButtonContainer","addZipPartFromComputerButton","addZipPartFromDriveButton","downloadZipButton","saveZipToDriveButton","openZipInDriveButton","editZipButton","fixEncodingButton","doneButton","closeButton","openZipFromDriveButton","openZipFromComputerButton","createNewZipButton","viewFilesButton","openSingleFileButton","rateAppButton","sendFeedbackButton","authButton","retryButton","cancelButton","extractButton","checkPasswordButton","fileTableItems","preview","previewArchiveContent","previewArc","previewGenericContent","previewGen","previewImageContent","previewImg","previewAudioContent","previewAud","previewTextContent","previewTxt","previewVideoContent","previewVid","previewPdfContent","previewPdf","previewDriveContent","previewCloseButton","previewDownloadButton","previewOpenEmbeddedArchiveButton","previewOpenInDriveButton","previewSaveToDriveButton","previewCancelButton","previewNextButton","previewPrevButton","downloadAnchorEl","previewItemFilename","previewZipFilenameAndStatus","previewSpinner","previewItemIcon","previewItemIconImg","noPreviewIcon","previewItemSize","previewProgressBarContainer","previewProgressBar","previewErrorContent","previewErrorCaption","previewErrorDetails","zipTable","mainScrollableContent","mainScrollableContentSubContainer","mainAppHeader","buttonContainer","openButtonsContainer","mainIcon","mainSpinner","zipPasswordInputContainer","zipPasswordInput","zipFilenameInputContainer","zipFilenameInput","fileTableSubHeader","fileTableSubHeaderIcon","fileTableSubHeaderLabel","secondaryLabelLink","previewDriveSaveToDriveFirst","previewSaveToDriveDetails","secondaryLabelLinkCombo","mainAppHeaderContent","footer","textBlockHowToUse","mainAppSubTitle","addPasswordButton","setPasswordButton","encryptionPrompt","encryptionPromptCheckbox","encryptionPromptText","showZipPasswordButton","hideZipPasswordButton","enableCookiesContent","enableCookiesImg1","enableCookiesImg2","enableCookiesImg3","zipDropArea","bottomDndRegionContainer","topDndRegionContainer","mainMoreActionsMouseDownButton","mainContextMenu","previewMoreActionsMouseDownButton","previewContextMenu","previousZipButton","locateFileInDriveButton","addFilesGeneralPromptButton"],ze.App.SESS_PROP={},ze.App.SESS_PROP.DIDAUTHORIZE="didAuthorize",ze.App.SESS_PROP.DIDPREVIEW="didPreview",ze.App.SESS_PROP.DIDDOWNLOADDRIVEFILE="didDownloadDriveFile",ze.App.SESS_PROP.DIDDRIVEFILEDOWNLOAD="didDriveFileDownloadSuccessfully",ze.App.SESS_PROP.DIDPICKEXTRACTLOCATION="didPickExtractLocation",ze.App.SESS_PROP.DIDPICKLOCALZIP="didPickLocalZip",ze.App.SESS_PROP.DIDDRAGDROPZIP="didDragDropZip",ze.App.SESS_PROP.DIDPICKDRIVEZIP="didPickDriveZip",ze.App.SESS_PROP.DIDDOWNLOADPREVIEWEDITEM="didDownloadPreviewedItem",ze.App.SESS_PROP.DIDOPENZIP="didOpenZip",ze.App.SESS_PROP.DIDZIPOPEN="didZipOpen",ze.App.SESS_PROP.DIDZIPRENDER="didZipRender",ze.App.SESS_PROP.DIDEXTRACTZIP="didExtractZip",ze.App.SESS_PROP.DIDZIPEXTRACT="didZipExtract",ze.App.SESS_PROP.DIDVIEWFILES="didViewFiles",ze.App.SESS_PROP.DIDCANCELDOWNLOAD="didCancelDownload",ze.App.SESS_PROP.DIDCANCELEXTRACTION="didCancelExtraction",ze.App.SESS_PROP.DIDRETRYDOWNLOAD="didRetryDownload",ze.App.SESS_PROP.DIDRETRYEXTRACTION="didRetryExtraction",ze.App.SESS_PROP.DIDCREATENEWEMPTYZIP="didCreateNewZip",ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP="didAddLocalFilesToZip",ze.App.SESS_PROP.DIDADDLOCALFOLDERSTOZIP="didAddLocalFoldersToZip",ze.App.SESS_PROP.DIDRATEAPP="didRateApp",ze.App.SESS_PROP.DIDEDITZIP="didEditZip",ze.App.SESS_PROP.DIDDOWNLOADALLITEMS="didDownloadAllItems",ze.App.SESS_PROP.DIDDOWNLOADZIPTOLOCAL="didDownloadZipToLocal",ze.App.SESS_PROP.DIDRENAMEZIP="didRenameZip",ze.App.SESS_PROP.DIDSAVEZIPTODRIVE="didSaveZipToDrive",ze.App.APP_STATE={DEFAULT:"default",INIT:"init",UNSUPPORTED_BROWSER:"unsupportedBrowser",NEW_SESSION:"newSession",APP_CREATE:"appCreate",APP_CREATED:"appCreated",APP_INIT:"appInit",ENCRYPTING_ZIP:"encryptingZip",ADD_PASSWORD_TO_ZIP:"addPasswordToZip",PASSWORD_REQUIRED:"passwordRequired",PASSWORD_INCORRECT:"passwordIncorrect",PASSWORD_VERIFIED:"passwordVerified",PASSWORD_FORMAT_NOT_SUPPORTED:"passwordFormatNotSupported",AUTH_PENDING_AUTO:"authPendingAuto",AUTH_PENDING_USER:"authPendingUser",AUTH_REQUIRED:"authRequired",AUTH_ERROR:"authError",AUTH_MISMATCH:"authMisMatch",DOWNLOADING:"downloading",DOWNLOADING_METADATA:"downloadingMetadata",DOWNLOADING_MULTIPLE_METADATA:"downloadingMultipleMetadata",DOWNLOADING_FILE_TO_ADD_TO_ZIP:"downloadingFileToAddToZip",DOWNLOADED_FILE_TO_ADD_TO_ZIP:"downloading",CANCEL_DOWNLOAD_REQUESTED:"cancelDownloadRequested",DOWNLOAD_CANCELED:"downloadCanceled",DOWNLOAD_ALL_BYTES_TRANSFERRED:"downloadAllBytesTransferred",DOWNLOAD_FIRST_BYTE_TRANSFERRED:"downloadFirstByteTransferred",DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED:"downloadToAddToZipFirstByteTransferred",DOWNLOADED:"downloaded",DOWNLOAD_ERROR:"downloadError",DOWNLOAD_ERROR_DUE_TO_AUTH:"downloadErrorDueToAuth",ZIP_READING:"zipReading",ZIP_READ_ERROR:"zipReadError",ZIP_READ_CANCELLED:"zipReadCancelled",MODULE_LOAD_ERROR:"moduleLoadError",MODEL_BUILDING:"modelBuilding",MODEL_BUILT:"modelBuilt",EXTRACTING:"extracting",EXTRACTION_COMPLETE:"extractionComplete",DOWNLOADING_ALL_TO_LOCAL:"downloadingAllToLocal",API_LOADED:"apiLoaded",READY_TO_EXTRACT:"readyToExtract",SESSION_CANCELED:"sessionCanceled",EXTRACTION_CANCEL_REQUESTED:"extractionCancelRequested",EXTRACTION_CANCELED:"extractionCanceled",RENDER_ZIP_UI:"renderZipUi",EXTRACTION_COMPLETE_WITH_ERRORS:"completeWithErrors",LIBRARY_LOADING:"libraryLoading",CREATING_NEW_ZIP:"creatingNewZip",EDIT_ZIP:"editZip",ADDING_FILES_TO_ZIP:"addingFilesToZip",FILES_ADDED_TO_ZIP:"filesAddedToZip",ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE:"addOrRemoveFilesToZipSessionDone",ZIP_WRITE_ERROR:"zipWriteError",ZIP_WRITE_CANCELLED:"zipWriteCancelled",ZIP_ENCRYPTION_ERROR:"zipEncryptionError",ZIP_ENCRYPTION_CANCELLED:"zipEncryptionCancelled",CHECKING_PASSWORD:"checkingPassword",CHECK_PASSWORD_CANCELLED:"checkPasswordCancelled",MULTI_PART_ZIP:"multiPartZip"},ze.App.ESTATE={ADDED_TO_ZIP:"addedToZip",CREATED_ZIP_SAVED_TO_DRIVE:"createdZipSavedToDrive",DEFAULT:"default",QUEUED:"queued",QUEUED_PENDING_RETRY:"queuedPendingRetry",REQUEUED_AFTER_ERROR:"requeuedAfterError",SKIPPED:"skipped",PENDING_UPLOAD:"pendingUpload",PENDING_DOWNLOAD:"pendingDownload",WAITING:"waiting",CANCELED:"canceled",BEGIN_DECOMPRESSION:"beginDecompression",DECOMPRESSION_PROGRESS:"decompressionProgress",DECOMPRESSION_COMPLETE:"decompressionComplete",DECOMPRESSION_ERROR:"decompressionError",DECOMPRESSION_CANCELED:"decompressionCanceled",BEGIN_UPLOAD:"beginUpload",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_ERROR:"uploadError",UPLOAD_ALL_BYTES_TRANSFERRED:"uploadAllBytesTransferred",UPLOAD_COMPLETE:"uploadComplete",UPLOAD_ABORTED:"uploadAborted",PARSE_ERROR:"parseError",DOWNLOAD_COMPLETE:"downloadComplete",ENTRY_DISK_MISSING:"entryDiskMissing"},ze.App.SESSION_ITEM_STATE_TYPE={UPLOAD_ERROR:"uploadError",DECOMPRESSION_ERROR:"decompressionError",CANCELED:"canceled",AUTH_ERROR:"authError"},ze.App.MAIN_ICON_TYPE={SECURITY:"security",LOCKED:"locked",UNLOCKED:"unlocked",INFO:"info",WARNING:"warning",ERROR:"error",SPINNER:"spinner",CANCEL:"cancel",SUCCESS:"success",MULTIPART:"warning",ADD:"add",EDIT:"edit"},ze.App.NAME="ZIP Extractor",ze.App.EXTRACTED_FOLDER_SUFFIX="(Unzipped Files)",ze.App.FILE_EXTENSION_REGEX="/\\.[^/.]+$/",ze.App.DRIVE_URL="https://drive.google.com/drive/",ze.App.FOLDER_SUFFIX="folders/",ze.App.LOCATE_ACTION_KEY="#?action=locate",ze.App.DEFAULT_ZIP_FILENAME="Untitled.zip",ze.App.MAX_WORKQUEUE_WORKERS=4,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER=1,ze.App.ENTRY_OVERHEAD_BYTES=1e5,ze.App.createDriveFolderLink=function(e){var t="u/"+CURRENT_AUTH_USER+"/";return ze.App.DRIVE_URL+t+(e?ze.App.FOLDER_SUFFIX+e:"")},ze.App.createDriveRecentLink=function(){var e="u/"+CURRENT_AUTH_USER+"/";return ze.App.DRIVE_URL+e+"recent"},ze.App.createDriveLocateLink=function(e,t){var i="u/"+CURRENT_AUTH_USER+"/";return ze.App.DRIVE_URL+i+ze.App.LOCATE_ACTION_KEY+"&id="+e+(t?"&parent="+t:"")},ze.App.getFolderName=function(e){return ze.App.trimFileExtension(e)+" "+ze.App.EXTRACTED_FOLDER_SUFFIX},ze.App.endsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},ze.App.startsWith=function(e,t){return 0==e.indexOf(t,0)},ze.App.stringSuffixAt=function(e,t){return e.substring(t)},ze.App.stringContains=function(e,t){return-1!=e.indexOf(t,0)},ze.App.trimFileExtension=function(e){return e.replace(ze.App.FILE_EXTENSION_REGEX,"")},ze.App.getFileExtension=function(e){if(null==e)return null;e=e.trim().split(".");return 1==e.length?"":e.pop().toLowerCase().trim()},ze.App.getBaseFilenameNoExtension=function(e){if(null==e)return null;var t=e.lastIndexOf(".");return e.substring(0,t)},ze.App.trimLastFileExtension=function(e){var t=e.split(".");return 1==t.length?e:(t.pop(),t.join("."))},ze.App.execLater=function(e,t,i){window.setTimeout(function(){e(),t&&t()},i||0)},ze.App.readUint64FromDataView=function(e,t,i){var r=e.getUint32(t,!!i),t=e.getUint32(t+4,!!i);return i?r+Math.pow(2,32)*t:t+Math.pow(2,32)*r},ze.App.isClickEventFromKeyboard=function(e){return e&&0===e.detail},ze.App.maybeReportTestError=function(e){ze.App.isForTesting()&&(console.log("ZE TEST SUITE REPORTING ERROR: "+e),zeTestSuite.reportError(e))},ze.App.maybeReportTestSuccess=function(e){ze.App.isForTesting()&&zeTestSuite.reportSuccess(e)},ze.App.isForTesting=function(){return"zeTestSuite"in window&&"isForTestSuiteFlow"in window&&isForTestSuiteFlow()},ze.App.getTestingPassword=function(){return zeTestSuite.external__getTestPasswordString()},ze.App.maybePreloadLibraryForType=function(e,t){e=ze.App.getFileExtension(e)||"";"rar"!=(e=e.toLowerCase())&&t!=ze.App.CANONICAL_MIME_TYPES.RAR&&t!=ze.App.CANONICAL_MIME_TYPES.RAR2&&t!=ze.App.CANONICAL_MIME_TYPES.RAR3&&t!=ze.App.CANONICAL_MIME_TYPES.RAR4||ze.App.maybePreloadLibrary(ze.App.LIB_RAR_WINDOW_OBJECT_CHECK,ze.App.LIB_RAR_SCRIPT_NAME),"zip"!=e&&"zipx"!=e&&t!=ze.App.CANONICAL_MIME_TYPES.ZIP&&t!=ze.App.CANONICAL_MIME_TYPES.ZIP2&&t!=ze.App.CANONICAL_MIME_TYPES.ZIP3||ze.App.maybePreloadLibrary(ze.App.LIB_ZIPREADER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPREADER_SCRIPT_NAME),"7z"!=e&&t!=ze.App.CANONICAL_MIME_TYPES.SEVENZIP&&t!=ze.App.CANONICAL_MIME_TYPES.SEVENZIP2||ze.App.maybePreloadLibrary(ze.App.LIB_SEVENZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_SEVENZIP_SCRIPT_NAME)},ze.App.maybePreloadLibrary=function(e,t){null==window[e]&&loadScript(t,function(){},function(){})},ze.App.prototype.globalContextMenuClickListener=function(e){e&&e.target&&(e.target==this.mainContextMenu||e.target==this.previewContextMenu||e.target.parentElement&&(e.target.parentElement==this.mainContextMenu||e.target.parentElement==this.previewContextMenu)||e.target.parentElement&&e.target.parentElement.parentElement&&(e.target.parentElement.parentElement==this.mainContextMenu||e.target.parentElement.parentElement==this.previewContextMenu))||this.closeAndUnlistenContextMenus()},ze.App.prototype.boundGlobalContextMenuClickListener=null,ze.App.prototype.unlistenContextMenus=function(){this.boundGlobalContextMenuClickListener?(document.removeEventListener("mousedown",this.boundGlobalContextMenuClickListener),this.boundGlobalContextMenuClickListener=null):console.log("Warning: Expected boundGlobalContextMenuClickListener to be defined")},ze.App.prototype.closeAndUnlistenContextMenus=function(){this.unlistenContextMenus(),this.showEl(this.mainContextMenu,!1,!0),this.showEl(this.previewContextMenu,!1,!0)},ze.App.prototype.isAnyContextMenuShown=function(){return this.isElementShown(this.mainContextMenu)||this.isElementShown(this.previewContextMenu)},ze.App.prototype.initAfterDomLoaded=function(e){this.isInitialized||(this.isInitialized=!0,this.fileIdToOpen=e,this.addDocumentReferences(),this.addEventListeners(),logImpression("app_initialized - initAfterDomLoaded()","app_load",ze.VERSION),this.startSessionAfterInit(),ze.App.maybePreloadLibraryForType("test.zip"))},ze.App.prototype.startSessionAfterInit=function(){isAuthorized()&&(this.updateUserInfoUi(),this.maybeEnableAutoRefreshTokenTimer()),this.fileIdToOpen?isAuthorized()?this.maybeDownloadAfterAuth():isFirstAuthPending()||this.updateStartPageButtons():isFirstAuthPending()||this.maybeProceedWithDirectNewFlow()||(this.updateStartPageButtons(),this.showEl(this.mainAppHeader,!1),this.startNewManualSession(),this.showEl(this.mainScrollableContent,!0),this.configureStartPageForNewManualSession())},ze.App.prototype.handleCancelAddPasswordToZip=function(){this.zipPasswordInput.value="",this.hideAddPasswordPrompt(!0)},ze.App.prototype.hideAddPasswordPrompt=function(e){var t=e?this.zipHasAtLeastOneEntry()?"Editing ZIP file":"Creating new ZIP file":"Password set. Ready to add files to ZIP";this.updateLabelsAndProgress(t,""),e?this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO):this.setMainIcon(ze.App.MAIN_ICON_TYPE.LOCKED),this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.encryptionPrompt,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.showEl(this.doneButton,!0),this.showEl(this.setPasswordButton,!1);e=this.zipHasAtLeastOneEntry();this.showEl(this.downloadZipButton,e),this.showEl(this.saveZipToDriveButton,e),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.configureZipEditMode()},ze.App.prototype.handleAddPasswordToZip=function(){this.setAppState(ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP)},ze.App.prototype.encryptZip=function(e){e?ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,bindFn(this.encryptZipEnsureCreateZipLibLoaded,this,!0)):this.encryptZipEnsureCreateZipLibLoaded()},ze.App.prototype.encryptZipEnsureCreateZipLibLoaded=function(e){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.doEncryptZip,this,e))},ze.App.ensureLibLoadedAndCallback=function(i,r,s,o){null!=window[i]?s&&s():(MAINAPP.setAppState(ze.App.APP_STATE.LIBRARY_LOADING),loadScript(r,s,function(e){var t;o?(t=e.target,e&&"error"==e.type&&e.target&&e.target.src&&(t="Target source: "+e.target.src),logImpression("module_load_error","misc",t),MAINAPP.setAppState(ze.App.APP_STATE.MODULE_LOAD_ERROR,e)):ze.App.ensureLibLoadedAndCallback(i,r,s,!0)}))},ze.App.prototype.doEncryptZip=function(e){e=e?ze.App.ENCRYPTION_MODE_WINZIPAES:ze.App.ENCRYPTION_MODE_PKZIPSTANDARD;this.zipEntryTree.isEncrypted=!0,this.zipEntryTree.encryptionMode=e,this.hideAddPasswordPrompt(!1),this.zipIsEmpty()?this.refreshZipTableBannerHeading():(this.setAppState(ze.App.APP_STATE.ENCRYPTING_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1,logImpression("do_encrypt_zip","encrypt_zip",this.createZipFromFileAssociatedExtension+" ("+e+")"),zeZipWriter.serializeZipFromEntries(this.zipEntryTree.originalEntries,this.zipBlob,[],bindFn(this.renderCreatedZip,this,!1,null,null,!0,!1,void 0,void 0,!1,void 0),bindFn(this.handleZipEncryptError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipEncryptError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,e,this.getZipPasswordCharCodeByteArray(),this.currentAutodetectedEncoding,this.zipEntryTree.isZip64))},ze.App.prototype.maybeProceedWithDirectNewFlow=function(){return!this.hasAutoProceededWithDirectNewFlow&&(!!isForDirectNewFlow()&&(this.hasAutoProceededWithDirectNewFlow=!0,logImpression("create_new_zip_direct_new","create_new_zip"),this.doCreateNewZip(),!0))},ze.App.prototype.checkStateUserAndLoggedInUserMatch=function(){var e=getLoggedInUserId();if(null==e)return!1;var t=getStateUserId();return null==t||("{userId}"==t||t==e)},ze.App.prototype.handleStateUserIdMismatchError=function(){logImpression("auth_account_mismatch","auth","authUser: "+CURRENT_AUTH_USER),this.setAppState(ze.App.APP_STATE.AUTH_MISMATCH)},ze.App.prototype.handleFirstAuthError=function(){this.maybeProceedWithDirectNewFlow()||this.updateStartPageButtons()},ze.App.prototype.handleFirstAuthSuccess=function(){this.handleAppPostAuthorizationTasks(),this.maybeEnableAutoRefreshTokenTimer()},ze.App.prototype.handleAppPostAuthorizationTasks=function(){this.updateUserInfoUi(),this.fileIdToOpen?this.maybeDownloadAfterAuth():this.maybeProceedWithDirectNewFlow()||this.updateStartPageButtons()},ze.App.prototype.maybeDownloadAfterAuth=function(){this.downloadInProgress(this.fileIdToOpen)||(this.checkStateUserAndLoggedInUserMatch()?(this.zipBlobSource="drive",this.downloadFileById(this.fileIdToOpen)):this.handleStateUserIdMismatchError())},ze.App.prototype.configureStartPageForNewManualSession=function(){this.authButtonDetails.textContent="",this.showEl(this.startPageIconImgGeneral,!0),this.showEl(this.startPageIconImgGmail,!1),this.showEl(this.startPageIconImgDrive,!1),this.showEl(this.generalButtonContainer,!0),this.showEl(this.authButtonContainer,!1),this.showEl(this.authButton,!1),this.showEl(this.authButtonDetails,!1),this.showEl(this.checkingAuthSpinner,!1),this.showEl(this.startPageGeneralDetails,!0),this.showEl(this.startPageGeneralDetailsCallToAction,!0),document.getElementById("startPageGeneralDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageGmailDetails,!1),this.showEl(this.startPageGmailDetailsCallToAction,!1),this.showEl(this.startPageDriveDetails,!1),this.showEl(this.startPageDriveDetailsCallToAction,!1),this.showEl(this.startPageNewDetails,!1),this.showEl(this.startPagePrompt,!0)},ze.App.prototype.updateStartPageButtons=function(){var e=null==this.fileIdToOpen?"general":getReferringSource();null!=this.fileIdToOpen&&"gmail"!=e&&(e="drive");var t="drive"==e,i="gmail"==e,e=!(t||i||isForDirectNew);this.showEl(this.authButtonContainer,!e),this.showEl(this.authButton,!e),this.showEl(this.authButtonDetails,!e),this.showEl(this.checkingAuthSpinner,!1),this.showEl(this.generalButtonContainer,e),this.showEl(this.startPageGeneralDetails,e),e&&document.getElementById("startPageGeneralDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageGmailDetails,i),i&&document.getElementById("startPageGmailDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageDriveDetails,t),t&&document.getElementById("startPageDriveDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageNewDetails,isForDirectNew)},ze.App.prototype.initiateManualAuth=function(e){var t=null;this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),authorize(!1,bindFn(this.handleManualAuthSuccess,this),bindFn(this.handleManualAuthError,this),t,void 0,!0,"initiateManualAuth")},ze.App.prototype.handleManualAuthSuccess=function(){this.doResumeOpenFromDriveAfterManualAuth?(this.doResumeOpenFromDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),ze.App.showPicker(bindFn(this.handlePickerZipFileSelected,this))):this.doResumeChooseFolderLocationAfterManualAuth?(this.doResumeChooseFolderLocationAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.handleSecondaryLabelLinkClick()):this.doResumeExtractToDriveAfterManualAuth?(this.doResumeExtractToDriveAfterManualAuth=!1,this.enableEl(this.extractButton,!0),this.updateLabelsForReadyToExtract(),this.updateUserInfoUi(),this.setAuthText(""),this.doExtract(!1)):this.doResumeSavePreviewItemToDriveAfterManualAuth?(this.doResumeSavePreviewItemToDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.handlePreviewSaveToDriveButtonClick()):this.doResumeSaveZipToDriveAfterManualAuth?(this.doResumeSaveZipToDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.saveZipToDrive(!0)):this.doResumeAddFilesToZipFromDriveAfterManualAuth?(this.doResumeAddFilesToZipFromDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.addFilesToZipFromDrive()):(this.setAuthText("Signed in as "+getUserEmail()),this.handleAppPostAuthorizationTasks())},ze.App.prototype.handleManualAuthError=function(e,t){this.setAppState(ze.App.APP_STATE.AUTH_ERROR,e,t)},ze.App.prototype.updateUserInfoUi=function(){this.sessionPropMap[ze.App.SESS_PROP.DIDAUTHORIZE]=!0;var e=ze.App.htmlEscape(getUserEmail()),t=ze.App.htmlEscape(getUserFullName(),!0),i=ze.App.htmlEscape(getUserGivenName(),!0);this.profileImageImg.src=getUserPicture()+"?size=72",this.profileName.textContent=i,this.showEl(this.profileImageDiv,!0),this.showEl(this.profileName,!0),this.profileImageImg.title="Switch Google Account",this.profileName.title=t+" ("+e+")"},ze.App.prototype.setAppState=function(e,t,i,r,s){this.appState=e,this.appStateLog+=" "+e,this.updateViewFromAppState(t,i,r,s)},ze.App.prototype.downloadInProgress=function(e){return this.lastDownloadId==e&&(this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA||this.appState==ze.App.APP_STATE.DOWNLOADING||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_CANCELED||this.appState==ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED||this.appState==ze.App.APP_STATE.CANCEL_DOWNLOAD_ERROR)},ze.App.prototype.downloadFileById=function(e){logImpression("download_file_metadata","download","start. is_authorized="+isAuthorized()),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADDRIVEFILE]=!0,this.hideWelcomeText(),this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.lastDownloadId=e,this.setAppState(ze.App.APP_STATE.DOWNLOADING_METADATA);var t=this,i=ze.Dapi.generateCallbacks(function(e){ze.App.maybePreloadLibraryForType(e.name,e.mimeType),e.mimeType==ze.Dapi.MimeType.FOLDER?t.handleOpenWithOnFolder(e):t.downloadFile(e)},bindFn(this.onDownloadError,this),void 0,bindFn(this.onDownloadAborted,this));ze.Dapi.get(e,i)},ze.App.prototype.handleOpenWithOnFolder=function(e){logImpression("open_with_on_folder","misc");var t=this;this.doCreateNewZip(function(){t.addFilesToZipFromDrive(e.id)})},ze.App.prototype.downloadFile=function(e){logImpression("download_file_blob","download","start");var t=ze.App.getProcessedSizeFromDriveFileObj(e);this.setAppState(ze.App.APP_STATE.DOWNLOADING,e.name,t);t=ze.Dapi.generateCallbacks(bindFn(this.onDownloadSuccess,this,e),bindFn(this.onDownloadError,this),bindFn(this.onDownloadProgress,this,!1,null,t),bindFn(this.onDownloadAborted,this));ze.App.isExportableGoogleDocsMimeType(e.mimeType)?ze.Dapi.exportGoogleDocFileBytes(e.id,t):ze.Dapi.downloadFileBytes(e.id,t)},ze.App.prototype.onDownloadSuccess=function(i,s){logImpression("download_file_blob","download","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDDRIVEFILEDOWNLOAD]=!0,this.setAppState(ze.App.APP_STATE.DOWNLOADED),this.parentFolderId=ze.App.getParentIdOfDriveFile(i),this.zipParentId=ze.App.getParentIdOfDriveFile(i);var o,n,p,a=i.name.trim(),e=ze.App.isExportableGoogleDocsMimeType(i.mimeType);e&&(a+=".pdf",i.mimeType="application/pdf",i.id=null),!e&&ze.App.isSupportedArchiveType(a,i.mimeType)?(this.zipDriveFileId=i.id,this.readArchive(a,i.size,i.mimeType,s)):!e&&null!=ze.App.translateZipPartFilenameToIndex(a)&&STATE&&STATE.ids&&1<STATE.ids.length?(o=STATE.ids.slice(1),n=ze.App.getBaseFilenameNoExtension(a),this.updateLabelsAndProgress("Downloading ZIP parts..."),this.showOrHideOpenZipPartButtons(!1),(p=this).downloadMultipleFileIds(o,function(e,t){var r=ze.App.getArchiveFilesProperties(t,n);r.hasPrimaryArchive?(t=o[r.primaryArchiveIdx],p.downloadMultipleFileIds([t],function(e,t){var i=t[0],t=e[0],e=STATE.ids[0];STATE.ids[0]=STATE.ids[1+r.primaryArchiveIdx],STATE.ids[1+r.primaryArchiveIdx]=e,p.readArchive(i.name.trim(),i.size,i.mimeType,t)},function(e){p.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)})):p.createNewZipFromFile(a,s,i.id)},function(e){console.trace(),console.log("download multipart ERROR",e),p.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},!0)):this.createNewZipFromFile(a,s,i.id)},ze.App.prototype.onDownloadError=function(e,t){var i="isAuthorized? "+isAuthorized()+" - isTokenExpired? "+isTokenExpired()+"; error: "+e,r="",r=this.appState==ze.App.APP_STATE.DOWNLOADING?"download_file_init_error":this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED?"download_file_blob_error":this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA?"download_file_metadata_error":this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP?"download_file_init_error_add_to_zip":this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED?"download_file_blob_error_add_to_zip":"download_file_other_error";logImpression(r,"download",i);var s=this,i=e==ze.Dapi.ErrType.AUTH_ERROR||e==ze.Dapi.ErrType.FORBIDDEN||e==ze.Dapi.ErrType.FILE_NOT_FOUND;this.hasDownloadBeenAutoRetried?(e=i?ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH:ze.App.APP_STATE.DOWNLOAD_ERROR,this.setAppState(e,t,i)):(this.hasDownloadBeenAutoRetried=!0,i?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_AUTO),authorize(!0,bindFn(this.downloadFileById,this,this.lastDownloadId),function(){s.setAppState(ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH,"(Auth auto retry failed): "+t,!0)},void 0,CURRENT_AUTH_USER,!1,"onDownloadError")):this.downloadFileById(this.lastDownloadId))},ze.App.prototype.onDownloadProgress=function(e,t,i,r,s){this.appState!=ze.App.APP_STATE.DOWNLOAD_CANCELED&&-1!=i&&(s=null!=s&&0!==s?s:i,e=e?'Downloading: "'+t+'" ('+ze.App.formatSize(i)+")":"Opening",this.handleGenericMainProgress(r,s,!0,e),r===i?this.setAppState(ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED,t,i):this.appState==ze.App.APP_STATE.DOWNLOADING&&0<r?this.setAppState(ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED,t,i):this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&0<r&&this.setAppState(ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED,t,i))},ze.App.prototype.onDownloadAborted=function(){this.handleDownloadCanceled()},ze.App.prototype.handleDownloadCanceled=function(){this.setAppState(ze.App.APP_STATE.DOWNLOAD_CANCELED)},ze.App.prototype.maybeEnableAutoRefreshTokenTimer=function(){null==this.autoRefreshTokenTimer&&(this.autoRefreshTokenTimer=setTimeout(bindFn(this.doAutoRefreshToken,this),ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS))},ze.App.prototype.doAutoRefreshToken=function(){clearTimeout(this.autoRefreshTokenTimer);var e=this;authorize(!0,function(){e.autoRefreshTokenTimer=setTimeout(bindFn(e.doAutoRefreshToken,e),ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS)},function(e){},void 0,CURRENT_AUTH_USER,!1,"autoRefreshToken",!0)},ze.App.prototype.handleZipDropAreaDragEnter=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.allowedEffect="copyMove",console.log("dragenter",e),this.mainScrollableContent.scrollTop=0,this.showEl(this.mainScrollableContentSubContainer,!1),this.zipDropArea.style.zIndex="200",this.showEl(this.zipDropArea,!0),this.mainScrollableContent.classList.add("dndDisablePointerEventsRegion"),this.zipDropArea.style.opacity="1"},ze.App.prototype.handleZipDropAreaDragLeave=function(e){e.stopPropagation(),e.preventDefault(),this.zipDropArea.classList.remove("zipDropAreaHover"),console.log("dragleave",e),this.mainScrollableContent.classList.remove("dndDisablePointerEventsRegion"),this.showEl(this.mainScrollableContentSubContainer,!0),this.zipDropArea.style.opacity="0",this.zipDropArea.style.zIndex="50"},ze.App.prototype.handleZipDropAreaDragOver=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},ze.App.prototype.handleZipDropAreaDrop=function(e){console.log("DROP"),e.stopPropagation(),e.preventDefault(),this.zipDropArea.classList.remove("zipDropAreaHover"),this.mainScrollableContent.classList.remove("dndDisablePointerEventsRegion"),this.showEl(this.mainScrollableContentSubContainer,!0),this.zipDropArea.style.opacity="0",this.zipDropArea.style.zIndex="50";var t,i,r,s,o=e.dataTransfer.items;o&&0<o.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDPICKLOCALZIP]=!0,e=this.convertDataTransferItemsToFileOrDirectoryEntries(o),t=!1,r=i=null,1==o.length&&e&&0<=e.length&&e[0].isDirectory&&(t=!0,(r=e[0].name)&&(i=r+".zip")),(s=this).traverseEntryTreeAsync(e,function(e){s.convertFileEntriesIntoFilesAsync(e,function(e){s.closeSession(),s.maybeCreateLocalSessionFromFiles(e,!0,t,i,r)},function(e){console.err(e)})}))},ze.App.prototype.traverseEntryTreeAsync=function(e,t){this.doTraverseEntryTreeAsync(e,0,[],t)},ze.App.prototype.doTraverseEntryTreeAsync=function(i,r,s,o){var e,n;r==i.length?o(s):(e=i[r]).isFile?(s.push(e),this.doTraverseEntryTreeAsync(i,r+1,s,o)):e.isDirectory?(s.push(e),(n=this).scanDirectoryForEntries(e.createReader(),function(e){n.traverseEntryTreeAsync(e,function(e){for(var t=0;t<e.length;t++)s.push(e[t]);n.doTraverseEntryTreeAsync(i,r+1,s,o)})})):console.log("Unrecognized Entry Type",e)},ze.App.prototype.convertFileEntriesIntoFilesAsync=function(e,t,i){this.doConvertFileEntriesIntoFilesAsync(e,0,[],t,i)},ze.App.prototype.doConvertFileEntriesIntoFilesAsync=function(t,i,r,s,o){var e,n,p=this,a=t[i],l=ze.App.startsWith(a.fullPath,"/")?a.fullPath.substring(1):a.fullPath;a.isDirectory?(e={isDirectory:!0},ze.App.endsWith(l,"/")||(l+="/"),e.fullPath=l,n=a.name,ze.App.endsWith(n,"/")||(n+="/"),e.name=n,r.push(e),i==t.length-1?s(r):p.doConvertFileEntriesIntoFilesAsync(t,i+1,r,s,o)):a.file(function(e){e.fullPath=l,r.push(e),i==t.length-1?s(r):p.doConvertFileEntriesIntoFilesAsync(t,i+1,r,s,o)},o)},ze.App.prototype.convertDataTransferItemsToFileOrDirectoryEntries=function(e){if(null==e)return e;if(!e.length)return[];for(var t,i=[],r=0;r<e.length;r++)"file"==e[r].kind&&(((t=e[r]).webkitGetAsEntry||t.getAsEntry)&&i.push(t.webkitGetAsEntry?t.webkitGetAsEntry():t.getAsEntry()));return i},ze.App.prototype.scanDirectoryForEntries=function(e,t){this.doScanDirectory(e,[],t)},ze.App.prototype.doScanDirectory=function(i,r,s){var o=this;i.readEntries(function(e){if(0==e.length)s(r);else{for(var t=0;t<e.length;t++)r.push(e[t]);o.doScanDirectory(i,r,s)}})},ze.App.prototype.maybeCreateLocalSessionFromFiles=function(e,t,i,r,s){var o,n=ze.App.getArchiveFilesProperties(e);if(n.hasPrimaryArchive&&!n.isDirectoryTree){var p=e[n.primaryArchiveIdx],a=p.name.trim(),l=ze.App.getFileExtension(a)||"";if((l=l.toLowerCase())&&""!=l&&-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(l)){var h=null;if(n.hasMultiPartArchiveParts){h=[];for(var d=0;d<n.multiPartArchivePartsIdx.length;d++)h.push(e[n.multiPartArchivePartsIdx[d]])}if(n.hasMultiPartArchiveParts||!i)return this.zipBlobSource="local",void this.loadArchiveSessionFromManualBlobs(a,p,h);console.log("This is a folder scenario and NOT a multi archive part scenario. Therefore, proceed to fall through to create.")}else console.log("unsupported file extension for archive: "+a)}t&&(o=this).doCreateNewZip(function(){o.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP]=!0,o.addFilesToZip(e,void 0,void 0,!0,i,r,s)})},ze.App.getArchiveType=function(e,t){return e==ze.App.CANONICAL_MIME_TYPES.ZIP||e==ze.App.CANONICAL_MIME_TYPES.ZIP2||e==ze.App.CANONICAL_MIME_TYPES.ZIP3?ze.App.ARCHIVE_TYPE.ZIP:e==ze.App.CANONICAL_MIME_TYPES.RAR||e==ze.App.CANONICAL_MIME_TYPES.RAR2||e==ze.App.CANONICAL_MIME_TYPES.RAR3||e==ze.App.CANONICAL_MIME_TYPES.RAR4?ze.App.ARCHIVE_TYPE.RAR:e==ze.App.CANONICAL_MIME_TYPES.GZIP||e==ze.App.CANONICAL_MIME_TYPES.GZIP2||e==ze.App.CANONICAL_MIME_TYPES.GZIP3||e==ze.App.CANONICAL_MIME_TYPES.GZIP4?ze.App.ARCHIVE_TYPE.GZIP:e==ze.App.CANONICAL_MIME_TYPES.TAR||e==ze.App.CANONICAL_MIME_TYPES.TAR2?ze.App.ARCHIVE_TYPE.TAR:e==ze.App.CANONICAL_MIME_TYPES.BZIP||e==ze.App.CANONICAL_MIME_TYPES.BZIP2||e==ze.App.CANONICAL_MIME_TYPES.BZIP3||e==ze.App.CANONICAL_MIME_TYPES.BZIP4||e==ze.App.CANONICAL_MIME_TYPES.BZIP5?ze.App.ARCHIVE_TYPE.BZIP:e==ze.App.CANONICAL_MIME_TYPES.SEVENZIP||e==ze.App.CANONICAL_MIME_TYPES.SEVENZIP2?ze.App.ARCHIVE_TYPE.SEVENZIP:e==ze.App.CANONICAL_MIME_TYPES.XZ?ze.App.ARCHIVE_TYPE.XZ:e==ze.App.CANONICAL_MIME_TYPES.LZIP||e==ze.App.CANONICAL_MIME_TYPES.LZIP2?ze.App.ARCHIVE_TYPE.LZIP:"zip"==t||"zipx"==t?ze.App.ARCHIVE_TYPE.ZIP:"tar"==t?ze.App.ARCHIVE_TYPE.TAR:"rar"==t?ze.App.ARCHIVE_TYPE.RAR:"gz"==t||"gzip"==t||"tgz"==t?ze.App.ARCHIVE_TYPE.GZIP:"7z"==t?ze.App.ARCHIVE_TYPE.SEVENZIP:"lz"==t||"tlz"==t?ze.App.ARCHIVE_TYPE.LZIP:"lzma"==t?ze.App.ARCHIVE_TYPE.LZMA_STANDALONE:"xz"==t||"txz"==t?ze.App.ARCHIVE_TYPE.XZ:"bz"==t||"bz2"==t||"bzip"==t||"bzip2"==t||"tbz"==t||"tbz2"==t?ze.App.ARCHIVE_TYPE.BZIP:ze.App.ARCHIVE_TYPE.ZIP},ze.App.prototype.readArchive=function(e,t,i,r,s,o,n){var p=null!=s?s:t;this.hideWelcomeText();s=(s=ze.App.getFileExtension(e)||"").toLowerCase();this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,ze.App.updatePageTitle(e),this.zipFilename=e,this.zipFileSize=t,this.zipMimeType=i,this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.retryButton,!1);var a=ze.App.getArchiveType(i,s),t=a.toLowerCase();switch(logImpression("read_"+t,t,"start. Extension: "+s+"; MIME type: "+i),this.currentArchiveTypeString=a,this.setAppState(ze.App.APP_STATE.ZIP_READING),a){case ze.App.ARCHIVE_TYPE.RAR:this.doReadRar(r,n,o);break;case ze.App.ARCHIVE_TYPE.GZIP:this.doReadGzip(r,e,o);break;case ze.App.ARCHIVE_TYPE.TAR:this.doReadTarFromBlob(r,this.currentAutodetectedEncoding,o,e);break;case ze.App.ARCHIVE_TYPE.BZIP:this.doReadBzip(r,e,o);break;case ze.App.ARCHIVE_TYPE.ZIP:this.doReadZip(r,e,i,p,this.currentAutodetectedEncoding,o);break;case ze.App.ARCHIVE_TYPE.SEVENZIP:this.doReadSevenZ(r,n,o);break;case ze.App.ARCHIVE_TYPE.LZMA_STANDALONE:this.doReadLzmaStandalone(r,e,o);break;case ze.App.ARCHIVE_TYPE.LZIP:this.doReadLzip(r,e,o);break;case ze.App.ARCHIVE_TYPE.XZ:this.doReadXz(r,e,o);break;default:throw new Error("Unrecognized archiveType in doReadArchive(): "+a)}},ze.App.prototype.doReadZip=function(i,e,t,r,s,o){var n=this;ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPREADER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPREADER_SCRIPT_NAME,function(){zeZipReader.readHeaderMetadataFromEocdr(i,e,t,r,function(e){var t=e.numExtraZipParts;200<t?n.archiveReadError(o,"Cannot read multi-part ZIP file with more than 200 parts ("+t+")"):(e.encoding=s,zeZipReader.readEntriesFromCentralDirectory(e,i,bindFn(n.archiveReadSuccess,n,i,e.zipFileComment,t,e.isZip64,o),bindFn(n.archiveReadError,n,o)))},bindFn(n.archiveReadError,n,o))})},ze.App.prototype.archiveReadSuccess=function(e,t,i,r,s,o,n){logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0;n=s||n;this.buildEntryTree(o,bindFn(this.entryTreeBuildComplete,this,e,n),t,i,r)},ze.App.prototype.archiveReadError=function(e,t,i,r,s,o){i?(logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","cancelled"),this.setAppState(ze.App.APP_STATE.ZIP_READ_CANCELLED)):(i=t&&null!=t.code?" FileError Code: "+t.code:"",logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","error: "+t+i),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,t,r,s,o)),e&&e(!1)},ze.App.prototype.doReadSevenZ=function(e,t,i){var r=this;ze.App.ensureLibLoadedAndCallback(ze.App.LIB_SEVENZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_SEVENZIP_SCRIPT_NAME,function(){r.updateLabelsAndProgress("Loading..."),ze.SevenZLibCore.verifySevenZFile(e,bindFn(ze.SevenZLibCore.getSevenZEntries,r,e,bindFn(r.archiveReadSuccess,r,e,void 0,void 0,void 0,i),bindFn(r.archiveReadErrorWithHeaderPassword,r),bindFn(r.archiveReadProgress,r),t),bindFn(r.archiveReadErrorWithHeaderPassword,r))})},ze.App.prototype.doReadRar=function(e,t,i){ze.RarLib.verifyRarFile(e,bindFn(ze.RarLib.getRarEntries,this,e,bindFn(this.archiveReadSuccess,this,e,void 0,void 0,void 0,i),bindFn(this.archiveReadErrorWithHeaderPassword,this),bindFn(this.archiveReadProgress,this),t),bindFn(this.archiveReadErrorWithHeaderPassword,this))},ze.App.prototype.archiveReadErrorWithHeaderPassword=function(e,t,i,r){i||r||logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","error: "+e),this.handleReadErrorWithOptionalHeaderPassword(e,t,i,r)},ze.App.prototype.doReadTarFromBlob=function(e,t,i,r){this.isTarFile=!0,ze.TarLib.verifyTarFile(e,bindFn(ze.TarLib.getTarEntriesFromBlob,this,e,bindFn(this.archiveReadSuccess,this,e,void 0,void 0,void 0,i),bindFn(this.archiveReadError,this,i),bindFn(this.archiveReadProgress,this),t,r),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadTarFromByteArrayParts=function(r,s){var o=this;ze.TarLib.getTarEntriesFromByteArrayParts(r,function(e){for(var t=new Blob(r),i=0;i<r.length;i++)r[i]=[];r=[],o.isTarFile=!0,o.archiveReadSuccess(t,void 0,void 0,void 0,s,e)},bindFn(this.archiveReadError,this,s),bindFn(this.archiveReadProgress,this))},ze.App.prototype.archiveDecompressProgress=function(e,t,i,r){this.handleGenericMainProgress(e,t,i,"Decompressing"+(r?" '"+r+"'":""))},ze.App.prototype.archiveReadProgress=function(e,t,i,r){this.handleGenericMainProgress(e,t,i,"Reading"+(r?" '"+r+"'":""))},ze.App.prototype.handleJumpToZipDecompressProgress=function(e,t,i,r){this.handleGenericMainProgress(e,t,i,"Decompressing"+(r?" '"+r+"'":""))},ze.App.prototype.handleGenericMainProgress=function(e,t,i,r){t=Math.floor(3+e/t*97);return this.setProgressBarPercent(t),i&&(r=r||"",this.updateLabelsAndProgress(null,r+" ("+t.toString()+"%)",t)),t},ze.App.prototype.handleGenericPreviewProgress=function(e,t,i,r){t=Math.floor(3+e/t*97);return this.setPreviewProgressBarPercent(t),i&&(r=r||"",this.previewZipFilenameAndStatus.textContent=r+" ("+t+"%)"),t},ze.App.prototype.generalDecompressionCheckCancelFn=function(){return this.wasPreviewDecompressionCancelled||this.isSessionAbortedForThePurposesOfPreview||this.wasArchiveDecompressionProcessCancelled||this.wasCheckPasswordCancelled},ze.App.prototype.doReadBzip=function(e,t,i){ze.BzipLib.verifyBzipFile(e,bindFn(ze.BzipLib.getBzipEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadGzip=function(e,t,i){var r=this;ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPREADER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPREADER_SCRIPT_NAME,function(){ze.GzipLib.verifyGzipFile(e,bindFn(ze.GzipLib.getGzipEntry,r,e,t,bindFn(r.streamDecodedArchiveReadSuccess,r,e,bindFn(r.archiveReadError,r,i),i),bindFn(r.archiveReadError,r,i)),bindFn(r.archiveReadError,r,i))})},ze.App.prototype.doReadLzip=function(e,t,i){ze.LzipLib.verifyLzipFile(e,bindFn(ze.LzipLib.getLzipEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadLzmaStandalone=function(e,t,i){ze.LzmaLib.verifyLzmaFile(e,bindFn(ze.LzmaLib.getLzmaEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadXz=function(e,t,i){ze.XzLib.verifyXzFile(e,bindFn(ze.XzLib.getXzEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.streamDecodedArchiveReadSuccess=function(e,t,i,r,s,o){logImpression("read_"+this.currentArchiveTypeString.toLowerCase(),"archive","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.maybeHandleEmbeddedTarFileBeforeDecompress(e,t,r,s,o,i)},ze.App.prototype.maybeHandleEmbeddedTarFileBeforeDecompress=function(e,t,i,r,s,o){var r=r||i.filename,n=this;r&&ze.App.endsWith(r.toLowerCase(),".tar")?(this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.updateLabelsAndProgress(null,"Decompressing "+r+"..."),this.wasArchiveDecompressionProcessCancelled=!1,this.zipBlob=e,ze.App.decompressArchiveEntry(e,i,!0,function(e){n.updateLabelsAndProgress("Reading embedded TAR file..."),ze.App.execLater(function(){try{n.doReadTarFromByteArrayParts(e,o)}catch(e){return void t(e)}},void 0,1)},t,bindFn(this.archiveDecompressProgress,this),bindFn(this.generalDecompressionCheckCancelFn,this),void 0,!0,r)):this.buildEntryTree([i],bindFn(this.entryTreeBuildComplete,this,e,o),s)},ze.App.prototype.handleReadErrorWithOptionalHeaderPassword=function(e,t,i,r){var s;i?(this.currentArchiveHeaderIsEncrypted=!0,r?(this.setAppState(ze.App.APP_STATE.PASSWORD_INCORRECT),ze.App.maybeReportTestError(e)):(s=this,ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){s.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED,!0),s.manualUpdateFileTableHeaderFromEmbedded(),ze.App.maybeReportTestError(e)}))):this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.entryTreeBuildComplete=function(e,t){this.zipBlob=e,this.renderZipTableUi(bindFn(this.zipUiRenderComplete,this,t))},ze.App.prototype.zipUiRenderComplete=function(e,t){if(null!=this.zipEntryTree)if(this.refreshZipTableBannerHeading(),this.isInZipEditMode)this.configureZipEditMode(this.numFilesRecentlyAdded,this.numFilesRecentlyRemoved,t),this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=null,e&&e(!0);else if(0<this.numExtraZipParts&&this.areAdditionalZipPartsRequired()){var p,t=this.getAdditionalZipPartsRequiredExtensionString();this.setAppState(ze.App.APP_STATE.MULTI_PART_ZIP,t),logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","start. numExtraParts: "+this.numExtraZipParts),e&&e(!0),STATE&&STATE.ids&&1<STATE.ids.length&&(i=STATE.ids.slice(1),this.updateLabelsAndProgress("Downloading ZIP parts..."),this.showOrHideOpenZipPartButtons(!1),(p=this).downloadMultipleFileIds(i,function(e,t){var i=ze.App.getBaseFilenameNoExtension(p.zipFilename),r=ze.App.getArchiveFilesProperties(t,i),s=null;if(r.hasMultiPartArchiveParts){s=[];for(var o=0;o<r.multiPartArchivePartsIdx.length;o++){var n=r.multiPartArchivePartsIdx[o];e[n].name=t[n].name,s.push(e[n])}}s&&0<s.length&&p.addZipPartBlobsToExistingMultiPartArchive(s)},function(e){console.trace(),console.log("download multipart ERROR",e),p.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),p.updateLabelsAndProgress(void 0,"Multi-Download Error (A): "+e,100)}))}else{if(0<this.numExtraZipParts)try{this.maybeHandleMultiPartZipFollowUpActions()}catch(e){throw logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","error: "+e),console.trace(),e}this.zipEntryTree.isEncrypted?this.configurePasswordPrompt():this.setReadyToExtract();var i=this.isFixEncodingOptionAvailable();this.showEl(this.fixEncodingButton,i),i&&this.enableEl(this.fixEncodingButton,!0);i=0<this.previousZipBlobs.length;this.showEl(this.previousZipButton,i);i="Number of entries in archive: "+this.zipEntryTree.originalEntries.length+"; encrypted: "+!!this.zipEntryTree.isEncrypted;e&&e(!0),ze.App.maybeReportTestSuccess(i)}else e&&e(!1)},ze.App.prototype.isFixEncodingOptionAvailable=function(){return this.zipEntryTree&&!!this.zipEntryTree.filenameHasExtendedChar&&null==this.currentAutodetectedEncoding},ze.App.prototype.maybeHandleMultiPartZipFollowUpActions=function(){if(!(this.numExtraZipParts<=0)){var e=[],t=0;e[0]=0;for(var i=1;i<=this.numExtraZipParts;i++){var r=this.extraZipPartsMap["zipPart-"+i];if(!r)throw new Error("Error: Blob part is null in this.extraZipPartsMap for index "+i);t+=r.size,e[i]=t}for(var s=this.zipEntryTree.originalEntries,o=0;o<s.length;o++)s[o].offset+=e[s[o].diskNumberStart];this.extraZipPartsMap={},this.numExtraZipParts=0,this.zipPartsLoadedMask=[]}},ze.App.prototype.areAdditionalZipPartsRequired=function(){for(var e=1;e<=this.numExtraZipParts;e++)if(!this.extraZipPartsMap["zipPart-"+e])return!0;return!1},ze.App.prototype.getAdditionalZipPartsRequiredExtensionString=function(){for(var e="",t=1;t<=this.numExtraZipParts;t++)this.extraZipPartsMap["zipPart-"+t]||(e+=t<=9?".z0"+t:".z"+t,t<this.numExtraZipParts&&(e+=", "));return e=e.trim(),ze.App.endsWith(e,",")&&(e=e.substring(0,e.length-1)),e},ze.App.prototype.addZipPartFilesToMapAndCreateMaskIndex=function(e,t){this.zipPartsLoadedMask=new Array(this.numExtraZipParts);for(var i="zipPart-",r=0;r<e.length;r++){var s,o=e[r];!ze.App.filePrefixesMatch(o.name,t)||null!=(s=ze.App.translateZipPartFilenameToIndex(o.name))&&""!==s&&(this.extraZipPartsMap[i+s]=o)}var n,p=i.length;for(n in this.extraZipPartsMap){var a=ze.App.stringSuffixAt(n,p),a=parseInt(a);this.zipPartsLoadedMask[a-1]=!0}},ze.App.filePrefixesMatch=function(e,t){e=ze.App.getBaseFilenameNoExtension(e);return null!=e&&e==ze.App.getBaseFilenameNoExtension(t)},ze.App.translateZipPartFilenameToIndex=function(e){e=ze.App.getFileExtension(e.toLowerCase());if(!ze.App.startsWith(e,"z"))return null;var t=ze.App.stringSuffixAt(e,1);try{var i=parseInt(t);return isNaN(i)?null:i}catch(e){return null}},ze.App.prototype.getConsolidatedZipBlobFromZipPartsMap=function(e){if(!e)throw new Error("Expected non-null blob part for finalMainZipBlob");for(var t=[],i=1;i<=this.numExtraZipParts;i++){var r=this.extraZipPartsMap["zipPart-"+i];if(!r)throw new Error("Expected non-null blob part for index: "+i);t.push(r)}return t.push(e),new Blob(t)},ze.App.prototype.setReadyToExtract=function(e,t){this.setAppState(ze.App.APP_STATE.READY_TO_EXTRACT,e,t),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPRENDER]=!0,logImpression("ready_to_extract",this.currentArchiveTypeString.toLowerCase(),"correctPassword: "+!!e)},ze.App.prototype.refreshZipTableBannerHeading=function(e){var t,i=this.zipEntryTree.zipFileComment&&!ze.App.startsWith(this.zipEntryTree.zipFileComment,"Created by ZIP Extractor")?'<div class="zipBannerLine"><b>ZIP Comment:</b> '+ze.App.htmlEscape(this.zipEntryTree.zipFileComment)+"</div>":"";this.zipEntryTree.empty&&!e&&(e="This "+this.currentArchiveTypeString+" file is empty and does not ",this.currentArchiveTypeString==ze.App.ARCHIVE_TYPE.ZIP?e+='yet contain any files. Click the "Add Files" button above to add files':e+="contain any files",e=e&&'<div class="zipBannerLine">'+e+"</div>",i?i+=e:i=e),this.zipEntryTree.isEncrypted&&(t="This "+this.currentArchiveTypeString+" file is encrypted with a password",this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_WINZIPAES?t+=" using strong encryption":t+="",t=t&&'<div class="zipBannerLine">'+t+"</div>",i?i+=t:i=t),this.isFixEncodingOptionAvailable()&&(t='<div class="zipBannerLine">'+(t='ZIP Extractor may be able improve these filenames with the "Fix Encoding" button above')+"</div>",i?i+=t:i=t),i?(this.fileTableSubHeaderLabel.innerHTML=i,this.showEl(this.fileTableSubHeader,!0)):(this.fileTableSubHeaderLabel.textContent="",this.showEl(this.fileTableSubHeader,!1))},ze.App.prototype.checkPassword=function(){var e;this.wasCheckPasswordCancelled=!1,this.currentArchiveHeaderIsEncrypted?this.readArchive(this.zipFilename,this.zipFileSize,this.zipMimeType,this.zipBlob,void 0,void 0,this.getZipPasswordCharCodeByteArray()):(e=this.zipEntryTree.passwordCheckEntry)?(logImpression("check_password","pwd_flow","begin_decompress"),ze.App.decompressArchiveEntry(this.zipBlob,e,!0,bindFn(this.checkPasswordSuccess,this,e),bindFn(this.checkPasswordError,this,e),bindFn(this.archiveReadProgress,this),bindFn(this.generalDecompressionCheckCancelFn,this),this.getZipPasswordCharCodeByteArray(),!0)):this.checkPasswordError(null,"no check entry available")},ze.App.prototype.checkPasswordSuccess=function(e){logImpression("check_password","pwd_flow","success"),this.zipEntryTree.isEncrypted=!1,this.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED)},ze.App.prototype.checkPasswordError=function(e,t,i){console.log(t),i?(logImpression("check_password_canceled","pwd_flow"),this.setAppState(ze.App.APP_STATE.CHECK_PASSWORD_CANCELLED)):(logImpression("check_password","pwd_flow","error: "+t),this.setAppState(ze.App.APP_STATE.PASSWORD_INCORRECT,!0))},ze.App.prototype.doExtract=function(e){logImpression("extract_"+this.currentArchiveTypeString.toLowerCase(),this.currentArchiveTypeString.toLowerCase(),"is_for_auto_retry="+e),this.sessionPropMap[ze.App.SESS_PROP.DIDEXTRACTZIP]=!0,this.setAppState(ze.App.APP_STATE.EXTRACTING),this.executeSession(e,!1,this.skipCreateParentFolderForSession)},ze.App.prototype.getNumOfTopLevelItemsInZipEntryTree=function(){try{if(this.zipEntryTree&&this.zipEntryTree.children)return Object.keys(this.zipEntryTree.children).length}catch(e){return console.log(e),-1}},ze.App.prototype.getSingleTopLevelEntry=function(e){if(this.zipEntryTree&&this.zipEntryTree.children){var t=Object.keys(this.zipEntryTree.children);if(t&&1===t.length){t=this.zipEntryTree.children[t[0]],e=!e||!!t.directory==e;if(t&&e)return t}}return null},ze.App.prototype.downloadAllItemsToLocal=function(){if(logImpression("download_all_items",this.currentArchiveTypeString.toLowerCase()),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADALLITEMS]=!0,this.isInZipEditMode)this.closeZipEditMode();else if(this.appState==ze.App.APP_STATE.EXTRACTION_CANCELED||this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE||this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS){var e=this;return void this.resetZipAsync(void 0,void 0,function(){e.doDownloadAllItemsToLocal()})}this.doDownloadAllItemsToLocal()},ze.App.prototype.doDownloadAllItemsToLocal=function(){this.setAppState(ze.App.APP_STATE.DOWNLOADING_ALL_TO_LOCAL),ze.App.execLater(bindFn(this.executeSession,this,!1,!0),void 0,0)},ze.App.prototype.handleExtractionComplete=function(e,t){var i=this.currentArchiveTypeString.toLowerCase();logImpression(i+(t?"_all_items_downloaded":"_extracted"),i),this.zipEntryTree&&this.zipEntryTree.isEncrypted&&logImpression("encrypted_"+i+(t?"_all_items_download_complete":"_extraction_complete"),"crypto"),e?this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCELED,t):(e=0<this.getNumFilesWithUploadErrors())&&!this.sessionHasBeenRetried?(this.parentFolderId=null,this.queueEntry(this.zipEntryTree,t),this.queueEntryChildren(this.zipEntryTree,t),this.doExtract(!0)):(e=e?ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS:ze.App.APP_STATE.EXTRACTION_COMPLETE,this.setAppState(e,t))},ze.App.prototype.getNewParentId=function(){if(this.zipEntryTree&&this.zipEntryTree.driveFileId)return this.zipEntryTree.driveFileId;var e=this.getSingleTopLevelEntry(!0);return e&&e.driveFileId?e.driveFileId:this.parentFolderId},ze.App.prototype.buildEntryTree=function(e,t,i,r,s){this.setAppState(ze.App.APP_STATE.MODEL_BUILDING),this.buildEntryTreeInternal(e,i,r,s),t(),console.log("---\x3e AFTER callbackFn() in buildEntryTree.")},ze.App.prototype.buildEntryTreeInternal=function(e,t,i,r){if(this.zipEntryTree)throw new Error("Existing ZIP Entry Tree must be cleared before being built (log: "+this.appStateLog+")");this.numExtraZipParts=i||0;i=ze.App.getFolderName(this.zipFilename);this.zipEntryTree={directory:!0,root:!0,name:i,path:i,children:{},state:ze.App.APP_STATE.DEFAULT,passwordCheckEntry:null,originalEntries:e},r&&(this.zipEntryTree.isZip64=!0),t&&(this.zipEntryTree.zipFileComment=t),null==e?(logImpression("error_null_entries",this.currentArchiveTypeString.toLowerCase()),e=[],this.zipEntryTree.empty=!0):0==e.length&&(this.zipEntryTree.empty=!0);for(var s=Number.MAX_SAFE_INTEGER,o=0;o<e.length;o++){var n=e[o];n.isEncrypted&&(this.zipEntryTree.isEncrypted=!0,this.zipEntryTree.encryptionMode=n.encryptionMode),n.isZip64&&(this.zipEntryTree.isZip64=!0),n.filenameHasExtendedChar&&(this.zipEntryTree.filenameHasExtendedChar=!0),!n.directory&&0<n.compressedSize&&null!=n.encryptionMode&&""!=n.encryptionMode&&n.encryptionMode!=ze.App.ENCRYPTION_MODE_NONE&&n.encryptionMode!=ze.App.ENCRYPTION_MODE_UNKNOWN&&n.compressedSize<s&&(s=n.compressedSize,this.zipEntryTree.passwordCheckEntry=n),this.insertZipEntry(this.zipEntryTree,n)}},ze.App.prototype.insertZipEntry=function(e,t){var i=t.filename||"";t.error&&(i&&(i+=" "),i+="ERROR ["+ ++this.errorCounter+"]: "+ze.App.htmlEscape(t.error).replace("/","--")),ze.App.endsWith(i,"/")&&(i=i.substring(0,i.length-1));for(var r=i.split("/"),s=e,o=null,n=0;n<r.length;n++){var p=r[n],o=null===o?p:o+"/"+p,a=s.children[p];a||(n<r.length-1||t.directory?(a={directory:!0,children:{}},t.zipTreeEntry=a):a=t,a.state=ze.App.ESTATE.DEFAULT,a.path=o,a.name=p,(a.parentEntry=s).children[p]=a),s=a}},ze.App.prototype.addDocumentReferences=function(){for(var e=0;e<ze.App.DOCUMENT_REFERENCES.length;e++)this[ze.App.DOCUMENT_REFERENCES[e]]=document.getElementById(ze.App.DOCUMENT_REFERENCES[e])},ze.App.prototype.addEventListeners=function(){this.addButtonListeners(),this.openLocalZipFileInputEl.onchange=bindFn(this.handleOpenLocalZipFileInputElChange,this),this.addLocalFileInputEl.onchange=bindFn(this.handleAddLocalFileInputElChange,this),this.addLocalFolderInputEl.onchange=bindFn(this.handleAddLocalFolderInputElChange,this),this.openLocalZipPartFileInputEl.onchange=bindFn(this.handleOpenLocalZipPartFileInputElChange,this),this.selectAllCheckbox.onclick=bindFn(ze.App.handleCheckboxButtonClick,this,null,null),this.rootStatusIcon.onclick=bindFn(this.handleRootStatusIconClick,this),this.encryptionPromptCheckbox.onclick=bindFn(this.handleEncryptionPromptCheckboxClick,this),this.encryptionPromptText.onclick=bindFn(this.handleEncryptionPromptCheckboxClick,this),this.secondaryLabelLink.onclick=bindFn(this.handleSecondaryLabelLinkClick,this),this.profileImageImg.onclick=bindFn(this.handleProfileImageImgClick,this),document.addEventListener("keydown",bindFn(this.handleBodyKeydown,this)),this.zipPasswordInput.addEventListener("keydown",bindFn(this.handleZipPasswordKeyDown,this)),this.zipFilenameInput.addEventListener("keydown",bindFn(this.handleZipFilenameKeyDown,this)),this.zipPasswordInput.addEventListener("input",bindFn(this.handleZipFilenameInputChange,this)),window.addEventListener("beforeunload",bindFn(this.handleBeforeUnload,this)),this.zipFilenameInput.addEventListener("focus",bindFn(this.focusAndSmartSelectZipFilenameInput,this,!0)),this.zipFilenameInput.addEventListener("blur",bindFn(this.handleZipFilenameInputBlur,this)),this.mainContextMenu.addEventListener("mouseup",bindFn(this.handleContextMenuItemMouseUp,this,"main")),this.previewContextMenu.addEventListener("mouseup",bindFn(this.handleContextMenuItemMouseUp,this,"preview")),this.mainScrollableContent.ondragenter=bindFn(this.handleZipDropAreaDragEnter,this),this.mainScrollableContent.ondragleave=bindFn(this.handleZipDropAreaDragLeave,this),this.mainScrollableContent.ondragover=bindFn(this.handleZipDropAreaDragOver,this),this.mainScrollableContent.ondrop=bindFn(this.handleZipDropAreaDrop,this);var t="zipDropArea";window.addEventListener("dragenter",function(e){e.target.id!=t&&(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")},!1),window.addEventListener("dragleave",function(e){e.target.id!=t&&(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")},!1),window.addEventListener("dragover",function(e){e.target.id!=t&&(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")}),window.addEventListener("drop",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"})},ze.App.prototype.handleProfileImageImgClick=function(){this.switchAccount()},ze.App.prototype.isGapiLibraryLoaded=function(){return"gapi"in window},ze.App.prototype.switchAccount=function(){var t;isFirstAuthPending()||(logImpression("switch_account","auth","start. currentAuthUser="+CURRENT_AUTH_USER),this.isGapiLibraryLoaded()&&gapi.auth2?((t=this).setAuthText("Choose the Google account you would like to use with ZIP Extractor."),authorize(!1,function(){logImpression("switch_account","auth","success. currentAuthUser="+CURRENT_AUTH_USER),t.setAuthText("Signed in as "+getUserEmail()),t.updateUserInfoUi()},function(e){logImpression("switch_account","auth","error: "+e),"idpiframe_initialization_failed"==e?(t.setAuthText("Cookies are not enabled, but are required in order to authorize with a Google account"),t.showEnableCookiesInfoPage()):t.setAuthText("")},void 0,void 0,!0,"switchAccount")):logImpression("switch_account","auth","error: gapi_auth2_not_loaded"))},ze.App.prototype.showEnableCookiesInfoPage=function(){window.console.log("Showing Enable Cookies info."),logImpression("show_enable_cookies_info_text","misc"),this.enableCookiesImg1.src=this.enableCookiesImg1.dataset.src,this.enableCookiesImg2.src=this.enableCookiesImg2.dataset.src,this.enableCookiesImg3.src=this.enableCookiesImg3.dataset.src,this.showEl(this.mainScrollableContent,!1),this.showEl(this.enableCookiesContent,!0),revertUrlState()},ze.App.prototype.handleBeforeUnload=function(e){this.sendFinalSessionState();var t=this.appState==ze.App.APP_STATE.CHECKING_PASSWORD;if(!this.areAllStatesTerminal()||this.isSavingToDrive||this.isPreviewDecompressing||this.isCurrentlyInJumpToZipOperation||t){var i="ZIP Extraction is still in process. Are you sure you want to leave?";return e.returnValue=i}if(this.isZipDirty()&&!this.zipIsEmpty())return i='"'+this.zipFilename+'" has unsaved changes. Are you sure you want to leave ZIP Extractor?',e.returnValue=i},ze.App.prototype.sendFinalSessionState=function(){var e,t,i="session_state2";for(e in logImpression("final_state_recorded",i,!0,void 0,void 0,!0),logImpression(this.appStateLog,"app_state_log",void 0,void 0,void 0,!0),logImpression("recorded","final_app_state",!0,void 0,void 0,!0),logImpression(this.appState,"final_app_state",void 0,void 0,void 0,!0),ze.App.SESS_PROP)!ze.App.SESS_PROP.hasOwnProperty(e)||null!=(t=this.sessionPropMap[ze.App.SESS_PROP[e]])&&logImpression(ze.App.SESS_PROP[e],i,t,void 0,void 0,!0)},ze.App.prototype.handleContextMenuItemMouseUp=function(e,t){t&&t.target&&"mdc-list"==t.target.className||t&&t.target&&"mdc-list-divider"==t.target.className||(this.closeAndUnlistenContextMenus(),t&&t.target&&"mdc-list-item"==t.target.className&&(!t.target.attributes||(t=t.target.attributes["data-item"])&&this.executeContextMenuAction(e,t.value)))},ze.App.prototype.setupZipRenameUI=function(){this.zipFilenameInput.value=this.zipFilename,this.showEl(this.fileTableHeaderLabel,!1),this.showEl(this.zipFilenameInputContainer,!0),this.focusAndSmartSelectZipFilenameInput()},ze.App.prototype.focusAndSmartSelectZipFilenameInput=function(e){e||this.zipFilenameInput.focus();e=this.zipFilenameInput.value.indexOf(".");0<e&&this.zipFilenameInput.setSelectionRange(0,e)},ze.App.prototype.executeContextMenuAction=function(e,t){switch(console.log("executing context menu item: ",e,t),logImpression((e||"")+"-"+t,"context_menu"),t){case"renameZip":this.setupZipRenameUI();break;case"editZip":this.canResetZip()?this.resetZipAsync(!0):this.configureZipEditMode();break;case"resetZip":this.resetZipAsync();break;case"sendFeedback":this.sendFeedbackEmail(!0);break;case"extractionLocation":this.handleSecondaryLabelLinkClick();break;case"downloadZip":this.downloadZipButton.click();break;case"saveZipToDrive":this.isInZipEditMode&&this.closeZipEditMode(),this.saveZipToDrive(!0);break;case"locateZipInDrive":ze.App.locateItemInDrive(this.zipDriveFileId,this.zipParentId);break;case"locateInDrive":ze.App.locateEntryInDrive(this.previewedEntry,this.previewedEntry.parentId);break;case"previewInDrive":if(!this.previewedEntry)return;this.previewedEntry.forcePreviewInDrive?(this.previewedEntry.forcePreviewInDrive=!1,this.updateCurrentPreview(this.previewedEntry)):(this.previewedEntry.forcePreviewInDrive=!0,this.previewedEntry.driveFileId?this.updateCurrentPreview(this.previewedEntry):(this.hideAllPreviewDivs(),this.savePreviewedItemToDrive()));break;case"downloadAllToLocal":var i="Are you sure you want to download the selected files inside the "+this.currentArchiveTypeString+" to your computer? The files will be downloaded to your downloads folder, but subfolders cannot be created and any folder structure will not be preserved.";confirm(i)&&this.downloadAllItemsToLocal();break;case"createNewParentFolder":this.skipCreateParentFolderForSession=!this.skipCreateParentFolderForSession}},ze.App.prototype.handleZipFilenameInputBlur=function(e){""==this.zipFilenameInput.value?this.zipFilenameInput.value=ze.App.DEFAULT_ZIP_FILENAME:this.zipFilenameInput.value=this.zipFilenameInput.value.trim(),ze.App.endsWith(this.zipFilenameInput.value.toLowerCase(),".zip")||(this.zipFilenameInput.value+=".zip");var t,i=this.zipFilename==this.zipFilenameInput.value;this.zipFilename=this.zipFilenameInput.value,this.fileTableHeaderLabel.textContent=this.zipFilenameInput.value,ze.App.updatePageTitle(this.zipFilename),this.zipEntryTree&&(t=ze.App.getFolderName(this.zipFilename),this.zipEntryTree.name=t,this.zipEntryTree.path=t),i||(this.sessionPropMap[ze.App.SESS_PROP.DIDRENAMEZIP]=!0,this.zipDriveFileId?this.renameZipInDrive():this.zipIsDirty=!0),this.isElementShown(this.addFilesGeneralPromptButton)?this.addFilesGeneralPromptButton.focus():this.isElementShown(this.addFilesFromComputerButton)&&this.addFilesFromComputerButton.focus()},ze.App.prototype.renameZipInDrive=function(){logImpression("rename_file_start","rename");var e=ze.Dapi.generateCallbacks(bindFn(this.zipRenameComplete,this),bindFn(this.zipRenameError,this),bindFn(this.zipRenameProgress,this),bindFn(this.zipRenameAborted,this));this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.enableEl(this.zipFilenameInput,!1),ze.Dapi.updateFileNameInDrive(e,this.zipDriveFileId,this.zipFilename)},ze.App.prototype.zipRenameComplete=function(){logImpression("rename_file_success","rename"),this.enableEl(this.zipFilenameInput,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS)},ze.App.prototype.zipRenameError=function(e){logImpression("rename_file_error","rename",e),this.enableEl(this.zipFilenameInput,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)},ze.App.prototype.zipRenameProgress=function(){},ze.App.prototype.zipRenameAborted=function(e){logImpression("rename_file_aborted","rename",e)},ze.App.prototype.handleZipPasswordKeyDown=function(e){if("Escape"===e.key||"Esc"===e.key){if(""!=this.zipPasswordInput.value)return e.stopPropagation(),e.preventDefault(),this.zipPasswordInput.value="",this.zipPasswordInput.focus(),!1}else if("Enter"===e.key)return e.stopPropagation(),e.preventDefault(),this.isElementShown(this.zipPasswordInputContainer)&&(this.isElementShown(this.setPasswordButton)&&this.isElementEnabled(this.setPasswordButton)?this.setPasswordButton.click():this.isElementShown(this.checkPasswordButton)&&this.isElementEnabled(this.checkPasswordButton)&&this.checkPasswordButton.click()),!1},ze.App.prototype.handleZipFilenameInputChange=function(e){this.isElementShown(this.zipPasswordInputContainer)&&(this.isElementShown(this.setPasswordButton)?this.enableEl(this.setPasswordButton,0<this.zipPasswordInput.value.length):this.isElementShown(this.checkPasswordButton)&&this.enableEl(this.checkPasswordButton,0<this.zipPasswordInput.value.length))},ze.App.prototype.handleZipFilenameKeyDown=function(e){return"Escape"===e.key||"Esc"===e.key?(e.stopPropagation(),e.preventDefault(),""!=this.zipFilenameInput.value?this.zipFilenameInput.value="":(this.zipFilenameInput.value=this.zipFilename||"",this.zipFilenameInput.blur()),!1):"Enter"===e.key?(e.stopPropagation(),e.preventDefault(),this.zipFilenameInput.blur(),!1):void 0},ze.App.prototype.handleBodyKeydown=function(e){"Escape"===e.key||"Esc"===e.key?this.isAnyContextMenuShown()?(this.closeAndUnlistenContextMenus(),e.preventDefault()):this.isPreviewShown()?(e.preventDefault(),this.isElementShown(this.previewCancelButton)&&this.isElementEnabled(this.previewCancelButton)?this.handleCancelPreview():this.closePreview()):this.appState==ze.App.APP_STATE.ADDING_FILES_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED?(e.preventDefault(),this.addFilesToZipOrEncryptZipCancelRequested=!0,this.enableEl(this.cancelButton,!1)):this.isElementShown(this.zipPasswordInputContainer)&&this.isElementShown(this.setPasswordButton)?this.handleCancelAddPasswordToZip():this.isInZipEditMode?(e.preventDefault(),this.closeZipEditMode()):this.canCancel()?(e.preventDefault(),this.handleButtonClick("cancelButton")):this.isElementShown(this.doneButton)&&this.isElementEnabled(this.doneButton)?this.doneButton.click():this.canCloseSession()&&(e.preventDefault(),this.confirmIfNeededAndMaybeCloseSession()):"ArrowUp"===e.key||"Up"===e.key||"ArrowLeft"===e.key||"Left"===e.key?this.isPreviewShown()&&(e.preventDefault(),this.isElementShown(this.previewPrevButton)&&this.isElementEnabled(this.previewPrevButton)&&this.handlePreviewPrevButtonClick()):"ArrowDown"===e.key||"Down"===e.key||"ArrowRight"===e.key||"Right"===e.key?this.isPreviewShown()&&(e.preventDefault(),this.isElementShown(this.previewNextButton)&&this.isElementEnabled(this.previewNextButton)&&this.handlePreviewNextButtonClick()):"Enter"===e.key&&(this.isPreviewShown()&&this.isElementShown(this.previewDownloadButton)&&this.isElementEnabled(this.previewDownloadButton)&&!this.isElementShown(this.previewErrorContent)?(e.preventDefault(),this.handlePreviewDownloadButtonClick()):this.canRetry())},ze.App.prototype.addButtonListeners=function(){for(var e=0;e<ze.App.DOCUMENT_REFERENCES.length;e++){var t=ze.App.DOCUMENT_REFERENCES[e];t&&ze.App.endsWith(t,"MouseDownButton")?this[t].onmousedown=bindFn(this.handleButtonClick,this,t):t&&ze.App.endsWith(t,"Button")&&(this[t].onclick=bindFn(this.handleButtonClick,this,t))}},ze.App.prototype.showEl=function(e,t,i){var r;i?(i=this.isElementShown(e))&&!t?(e.style.opacity="0",r=this,ze.App.execLater(function(){r.showEl(e,!1)},void 0,150)):!i&&t&&(e.style.opacity="0",this.showEl(e,t),ze.App.execLater(function(){e.style.opacity="1"},void 0,0)):e.hidden=!t},ze.App.prototype.enableEl=function(e,t){e.disabled=!t},ze.App.prototype.isElementShown=function(e){return!e.hidden},ze.App.prototype.isElementEnabled=function(e){return!e.disabled},ze.App.prototype.handleButtonClick=function(e,t){switch(e){case"checkPasswordButton":if(0==this.zipPasswordInput.value.length)return this.zipPasswordInput.select(),void this.zipPasswordInput.focus();logImpression("check_password","pwd_flow"),this.setAppState(ze.App.APP_STATE.CHECKING_PASSWORD),this.checkPassword();break;case"authButton":logImpression("manual_authorize_button","user_button"),this.initiateManualAuth();break;case"addFilesFromComputerButton":logImpression("add_files_from_computer","user_button"),this.addLocalFileInputEl.click();break;case"addFolderButton":logImpression("add_folder_button","user_button"),this.addLocalFolderInputEl.click();break;case"addFilesToZipFromDriveButton":!isAuthorized()||isTokenExpired()?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),this.setResumeFlags(!1,!1,!1,!1,!1,!0),this.initiateManualAuth()):this.addFilesToZipFromDrive();break;case"downloadZipButton":this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADZIPTOLOCAL]=!0;var i=this.zipEntryTree?this.zipEntryTree.encryptionMode:"null zipEntryTree";logImpression("download_zip","create_zip","encryptionMode: "+i),this.downloadBlobToBrowser(this.zipFilename,new Blob([this.zipBlob],{type:"application/zip"})),this.zipIsDirty=!1;break;case"saveZipToDriveButton":this.saveZipToDrive(!0);break;case"openZipInDriveButton":null!=this.zipDriveFileId&&ze.App.openItemInDrive(this.zipDriveFileId);break;case"editZipButton":case"addFilesGeneralPromptButton":this.configureZipEditMode();break;case"doneButton":this.isInZipEditMode||this.appState!=ze.App.APP_STATE.EXTRACTION_COMPLETE&&this.appState!=ze.App.APP_STATE.EXTRACTION_CANCELED&&this.appState!=ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS?this.closeZipEditMode():this.resetZipAsync();break;case"previousZipButton":if(this.isZipDirty())if(!confirm('"'+this.zipFilename+'" has unsaved changes. Are you sure you want to return to the previous ZIP file?'))return;logImpression("previous_zip","user_button"),this.openPreviousParentZip();break;case"mainMoreActionsMouseDownButton":case"previewMoreActionsMouseDownButton":var r="mainMoreActionsMouseDownButton"==e,s=r?this.mainContextMenu:this.previewContextMenu,i=!this.isElementShown(s);i&&(r?this.configureMainContextMenu():this.configurePreviewContextMenu()),this.showEl(s,i,!0),i?(s.focus(),this.boundGlobalContextMenuClickListener&&console.log("warning: Expected this.boundGlobalContextMenuClickListener to be null;"),this.boundGlobalContextMenuClickListener=bindFn(this.globalContextMenuClickListener,this),document.addEventListener("mousedown",this.boundGlobalContextMenuClickListener)):this.unlistenContextMenus(),t?(t.preventDefault(),t.stopPropagation()):console.warn("Expected originalEvent to be defined");break;case"fixEncodingButton":this.fixEncoding();break;case"extractButton":!isAuthorized()||isTokenExpired()?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),this.setResumeFlags(!1,!0,!1,!1,!1,!1),this.initiateManualAuth()):(this.sessionHasBeenRetried=!1,this.doExtract(!1));break;case"viewFilesButton":logImpression("view_files","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDVIEWFILES]=!0;s=this.getNewParentId(),s=s?ze.App.createDriveFolderLink(s):ze.App.createDriveRecentLink(),s=window.open(s,"_blank");s&&s.focus&&s.focus();break;case"openSingleFileButton":logImpression("open_single_file","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDVIEWFILES]=!0;var o=this.getSingleTopLevelEntry(!1);o&&ze.App.openItemInDrive(o.driveFileId);break;case"locateFileInDriveButton":logImpression("locate_single_extracted_file_in_drive","user_button");o=this.getSingleTopLevelEntry(!1);o&&(ze.App.locateEntryInDrive(o,this.parentFolderId),this.locateFileInDriveButton.blur());break;case"sendFeedbackButton":logImpression("send_feedback","user_button"),this.sendFeedbackEmail();break;case"rateAppButton":logImpression("rate_app","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRATEAPP]=!0;var n="https://gsuite.google.com/marketplace/app/zip_extractor/824911851129?authuser="+CURRENT_AUTH_USER,n=window.open(n,"_blank");n&&n.focus&&n.focus();break;case"previewCancelButton":this.handleCancelPreview();break;case"cancelButton":this.appState==ze.App.APP_STATE.EXTRACTING?(logImpression("cancel_extraction","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDCANCELEXTRACTION]=!0,this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED),this.abortSession()):this.appState==ze.App.APP_STATE.DOWNLOADING_ALL_TO_LOCAL?(logImpression("cancel_download_all_to_local","user_button"),this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED,!0),this.abortSession(!0)):this.appState==ze.App.APP_STATE.DOWNLOADING||this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA?(logImpression("cancel_download","user_button","app_state: "+this.appState),this.sessionPropMap[ze.App.SESS_PROP.DIDCANCELDOWNLOAD]=!0,this.setAppState(ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED),ze.Dapi.abortDownload()):this.appState==ze.App.APP_STATE.ADDING_FILES_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED?(this.addFilesToZipOrEncryptZipCancelRequested=!0,this.enableEl(this.cancelButton,!1),this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED||ze.Dapi.abortDownload()):this.appState==ze.App.APP_STATE.CHECKING_PASSWORD?(this.enableEl(this.cancelButton,!1),this.wasCheckPasswordCancelled=!0):this.isSavingToDrive?(this.enableEl(this.cancelButton,!1),this.wasSaveToDriveCancelled=!0,ze.Dapi.abortAllRequests()):!this.isCurrentlyInJumpToZipOperation&&this.appState!=ze.App.APP_STATE.ZIP_READING||(this.enableEl(this.cancelButton,!1),this.wasArchiveDecompressionProcessCancelled=!0);break;case"closeButton":this.isElementShown(this.zipPasswordInputContainer)&&this.isElementShown(this.setPasswordButton)?this.handleCancelAddPasswordToZip():this.confirmIfNeededAndMaybeCloseSession();break;case"retryButton":this.showEl(this.doneButton,!1),this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS?(logImpression("retry_errors","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.doExtract(!1)):this.appState==ze.App.APP_STATE.EXTRACTION_CANCELED?this.abortedSessionWasForDownloadAllToLocal?(this.abortedSessionWasForDownloadAllToLocal=!1,this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.downloadAllItemsToLocal()):(logImpression("retry_after_extraction_canceled","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.doExtract(!1)):this.appState==ze.App.APP_STATE.DOWNLOAD_ERROR||this.appState==ze.App.APP_STATE.DOWNLOAD_CANCELED?(logImpression("retry_download","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYDOWNLOAD]=!0,this.hasDownloadBeenAutoRetried=!1,this.downloadFileById(this.lastDownloadId)):this.appState==ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH?(logImpression("retry_download_after_manual_auth","user_button"),this.initiateManualAuth(!0)):this.appState==ze.App.APP_STATE.AUTH_MISMATCH||this.appState==ze.App.APP_STATE.AUTH_ERROR?this.initiateManualAuth(!0):this.appState==ze.App.APP_STATE.ZIP_READ_CANCELLED&&this.readArchive(this.zipFilename,this.zipFileSize,this.zipMimeType,this.zipBlob,void 0,void 0);break;case"openZipFromDriveButton":logImpression("open_zip_from_drive","user_button","is_authorized="+isAuthorized()),!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!0,!1,!1,!1,!1,!1),this.initiateManualAuth()):ze.App.showPicker(bindFn(this.handlePickerZipFileSelected,this));break;case"openZipFromComputerButton":logImpression("open_zip_from_computer","user_button","is_authorized="+isAuthorized()),this.openLocalZipFileInputEl.click();break;case"createNewZipButton":logImpression("create_new_zip","user_button","is_authorized="+isAuthorized()),logImpression("create_new_zip_button_press","create_new_zip"),this.doCreateNewZip();break;case"addZipPartFromDriveButton":logImpression("add_zip_part_from_drive","user_button");n=ze.App.getBaseFilenameNoExtension(this.zipFilename);this.handleAddZipPartsFromDrive(n);break;case"addZipPartFromComputerButton":logImpression("add_zip_part_from_computer","user_button"),this.openLocalZipPartFileInputEl.click();break;case"addPasswordButton":var p=this.zipEntryTree&&this.zipEntryTree.originalEntries?this.zipEntryTree.originalEntries.length:-1;logImpression("add_password_button","encrypt_zip","entryCount: "+p),this.handleAddPasswordToZip();break;case"setPasswordButton":this.hideZipPasswordChars();p=ze.App.isCheckboxIconButtonChecked(this.encryptionPromptCheckbox);logImpression("set_password_button","encrypt_zip","useAes: "+p),this.encryptZip(p);break;case"showZipPasswordButton":this.showZipPasswordChars();break;case"hideZipPasswordButton":this.hideZipPasswordChars();break;case"previewCloseButton":this.handlePreviewCloseButtonClick();break;case"previewDownloadButton":this.handlePreviewDownloadButtonClick();break;case"previewOpenEmbeddedArchiveButton":this.handlePreviewOpenEmbeddedArchiveButtonClick();break;case"previewOpenInDriveButton":this.handlePreviewOpenInDriveButtonClick();break;case"previewSaveToDriveButton":this.handlePreviewSaveToDriveButtonClick();break;case"previewPrevButton":this.handlePreviewPrevButtonClick();break;case"previewNextButton":this.handlePreviewNextButtonClick()}},ze.App.prototype.showZipPasswordChars=function(){this.zipPasswordInput.type="text",this.showEl(this.hideZipPasswordButton,!0),this.showEl(this.showZipPasswordButton,!1)},ze.App.prototype.hideZipPasswordChars=function(){this.zipPasswordInput.type="password",this.showEl(this.hideZipPasswordButton,!1),this.showEl(this.showZipPasswordButton,!0)},ze.App.prototype.doCreateNewZip=function(e){this.isInZipEditMode=!0;this.createNewEmptyZip(void 0,e,!1)},ze.App.prototype.canCancel=function(){return this.isElementShown(this.cancelButton)&&this.isElementEnabled(this.cancelButton)},ze.App.prototype.canRetry=function(){return this.isElementShown(this.retryButton)&&this.isElementEnabled(this.retryButton)},ze.App.prototype.confirmIfNeededAndMaybeCloseSession=function(){if(this.isZipDirty()&&!confirm('"'+this.zipFilename+'" has not been saved or downloaded. Are you sure you want to close this ZIP file?'))return!1;return logImpression("close","user_button"),this.showEl(this.mainAppHeader,!1),this.showEl(this.mainScrollableContent,!0),this.closeSession(),this.configureStartPageForNewManualSession(),this.showEl(this.mainScrollableContent,!0),!(this.mainScrollableContent.scrollTop=0)},ze.App.prototype.canCloseSession=function(){return this.isElementShown(this.closeButton)},ze.App.prototype.configureMainContextMenu=function(){var e=this.appState==ze.App.APP_STATE.PASSWORD_REQUIRED||this.appState==ze.App.APP_STATE.PASSWORD_INCORRECT,t=this.mainContextMenu.querySelector("li[data-item='createNewParentFolder']"),i=!this.isInZipEditMode&&!e&&this.zipHasAtLeastOneEntry()&&this.appState==ze.App.APP_STATE.READY_TO_EXTRACT;this.showEl(t,i),t.firstElementChild.textContent=this.skipCreateParentFolderForSession?"block":"check";var r=this.mainContextMenu.querySelector("li[data-item='preserveModificationTimes']");ze.App.enableContextMenuItem(r,!1),this.showEl(r,!1);i=this.mainContextMenu.querySelector("li[data-item='extractionLocationDivider']"),t=this.mainContextMenu.querySelector("li[data-item='extractionLocation']"),r=!this.isInZipEditMode&&!e&&this.appState==ze.App.APP_STATE.READY_TO_EXTRACT;this.showEl(i,r),this.showEl(t,r);var s=this.mainContextMenu.querySelector("li[data-item='downloadAllToLocal']"),t=ze.App.isCheckboxIconButtonChecked(this.selectAllCheckbox),o=ze.App.isCheckboxIconButtonChecked(this.selectAllCheckbox,!1,!0),r=this.zipEntryTree&&this.zipEntryTree.originalEntries&&this.zipEntryTree.originalEntries.length<=50&&this.zipHasAtLeastOneEntry()&&t&&!e&&this.appState==ze.App.APP_STATE.READY_TO_EXTRACT||this.appState==ze.App.APP_STATE.EXTRACTION_CANCELED||this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE||this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS;ze.App.enableContextMenuItem(s,r);try{s.firstElementChild.nextSibling.textContent="Download "+(o?"selected":"all")+" files in ZIP"}catch(e){console.error(e)}t=this.mainContextMenu.querySelector("li[data-item='downloadZip']"),r=this.zipHasAtLeastOneEntry();ze.App.enableContextMenuItem(t,r);t=this.mainContextMenu.querySelector("li[data-item='editZip']"),r=this.zipEntryTree&&!e&&this.currentArchiveTypeString==ze.App.ARCHIVE_TYPE.ZIP,e=!this.isInZipEditMode;ze.App.enableContextMenuItem(t,r),this.showEl(t,e);t=this.mainContextMenu.querySelector("li[data-item='renameZip']"),e=this.currentArchiveTypeString==ze.App.ARCHIVE_TYPE.ZIP;ze.App.enableContextMenuItem(t,e);t=this.mainContextMenu.querySelector("li[data-item='resetZip']");this.showEl(t,this.canResetZip());e=this.mainContextMenu.querySelector("li[data-item='saveZipToDrive']"),this.mainContextMenu.querySelector("li[data-item='saveZipToDriveDivider']"),t=(!this.zipDriveFileId||this.zipIsDirty)&&this.zipHasAtLeastOneEntry();ze.App.enableContextMenuItem(e,t);e=this.mainContextMenu.querySelector("li[data-item='locateZipInDrive']"),t=!!this.zipDriveFileId;this.showEl(e,t)},ze.App.prototype.configurePreviewContextMenu=function(){var e=this.previewContextMenu.querySelector("li[data-item='locateInDrive']");ze.App.enableContextMenuItem(e,!!this.previewedEntry.driveFileId)},ze.App.enableContextMenuItem=function(e,t){e.classList[t?"remove":"add"]("mdc-list-item--disabled")},ze.App.prototype.openPreviousParentZip=function(){var e,t,i=this.previousZipBlobs.pop(),r=this.previousZipFilenames.pop();i?(e=this.previousZipBlobs,t=this.previousZipFilenames,this.closeSession(),this.closePreview(),this.previousZipBlobs=e,this.previousZipFilenames=t,this.readArchiveWithInferredMimetype(r,i)):console.log("Error: previousZipBlob was undefined")},ze.App.prototype.configureZipEditMode=function(e,t,i){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.doConfigureZipEditMode,this,e,t,i))},ze.App.prototype.doConfigureZipEditMode=function(e,t,i){this.sessionPropMap[ze.App.SESS_PROP.DIDEDITZIP]=!0,this.isInZipEditMode=!0,this.wasZipFileCreatedLocallyOrEdited=!0,this.zipFilenameInput.value=this.zipFilename,this.currentAutodetectedEncoding=null,this.setAppState(ze.App.APP_STATE.EDIT_ZIP,e,t,i),this.refreshZipEntryTreeIconsFromCurrentState(!1,!0,!0),this.isElementShown(this.addFilesFromComputerButton)&&this.addFilesFromComputerButton.focus()},ze.App.prototype.closeZipEditMode=function(){this.isInZipEditMode=!1,this.setAppState(ze.App.APP_STATE.READY_TO_EXTRACT,void 0,this.wasZipFileCreatedLocallyOrEdited);var e=!this.zipIsEmpty();this.refreshZipEntryTreeIconsFromCurrentState(e,!1,!0),this.isElementShown(this.addFilesGeneralPromptButton)?this.addFilesGeneralPromptButton.focus():this.wasZipFileCreatedLocallyOrEdited&&this.isElementShown(this.saveZipToDriveButton)&&this.isElementEnabled(this.saveZipToDriveButton)?this.saveZipToDriveButton.focus():this.isElementShown(this.extractButton)&&this.extractButton.focus();var t=this.zipIsEmpty();this.showEl(this.saveZipToDriveButton,this.zipIsDirty&&!t),this.showEl(this.downloadZipButton,this.zipIsDirty&&!t);e=null!=this.zipDriveFileId;this.showEl(this.openZipInDriveButton,e&&!this.isElementShown(this.saveZipToDriveButton)&&!t)},ze.App.prototype.handleCancelPreview=function(){logImpression("preview_cancel","user_button","isPreviewDecompressing: "+this.isPreviewDecompressing),this.enableEl(this.previewCancelButton,!1),this.isSavingToDrive&&(this.wasSaveToDriveCancelled=!0,ze.Dapi.abortAllRequests()),this.isPreviewDecompressing&&(this.wasPreviewDecompressionCancelled=!0)},ze.App.prototype.updateViewFromAppState=function(e,t,i,r){if(this.isInitialized)switch(this.appState){case ze.App.APP_STATE.API_LOADED:break;case ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP:var s="phone"==detectDevice()?"Add password":"Add password to ZIP file";this.updateLabelsAndProgress(s,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SECURITY),this.showEl(this.secondaryLabelLinkCombo,!1),ze.App.setCheckboxIconButtonChecked(this.encryptionPromptCheckbox,!1),this.enableEl(this.zipPasswordInput,!0),this.showEl(this.zipPasswordInputContainer,!0),this.showEl(this.setPasswordButton,!0),this.hideZipPasswordChars(),this.enableEl(this.setPasswordButton,!1),this.showEl(this.encryptionPrompt,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.doneButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0);break;case ze.App.APP_STATE.ENCRYPTING_ZIP:var o="phone"==detectDevice()?"Encrypting ZIP file...":"Encrypting ZIP file with password...";this.updateLabelsAndProgress(o,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.showEl(this.addPasswordButton,!1),this.showEl(this.setPasswordButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.doneButton,!1),this.showEl(this.zipPasswordInputContainer,!1),this.showEl(this.encryptionPrompt,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1);break;case ze.App.APP_STATE.MULTI_PART_ZIP:this.showOrHideOpenZipPartButtons(!0),this.showEl(this.extractButton,!1),this.updateLabelsAndProgress("Multi-part ZIP file detected; please add additional ZIP parts","ZIP parts required: "+e),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.MULTIPART);var n=0<this.previousZipBlobs.length;this.showEl(this.previousZipButton,n);break;case ze.App.APP_STATE.DOWNLOADING_MULTIPLE_METADATA:this.updateLabelsAndProgress("Adding additional files to ZIP...","Reading file data from Google Drive...");break;case ze.App.APP_STATE.ADDING_FILES_TO_ZIP:o=!!e,n=o?"folder":"files";o&&t&&(n+=' "'+t+'"'),this.updateLabelsAndProgress("Adding "+n+" to ZIP...","Preparing files..."),this.setProgressBarPercent(0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.doneButton,!1),this.showEl(this.openZipInDriveButton,!1),this.refreshZipTableBannerHeading(!0);break;case ze.App.APP_STATE.ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE:var p=e?"Password set":this.getFilesChangedStatusString(t,i,r);null==p&&(p="Files added to ZIP"),this.updateLabelsAndProgress(p,"",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.addFilesButtonContainer,!0);break;case ze.App.APP_STATE.FILES_ADDED_TO_ZIP:var p=e,a=t;this.zipEntryTree=null,ze.App.clearTable(this.fileTableItems),this.readArchive(this.zipFilename,p.size,ze.App.CANONICAL_MIME_TYPES.ZIP,p,void 0,a);break;case ze.App.APP_STATE.ZIP_WRITE_ERROR:var l=e||"";(z=e?ze.App.getStackInfoFromErrorObj(e):"")&&(l+=" ("+z+")");var h="Error when editing ZIP file";this.updateLabelsAndProgress(h,"Details: "+l,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.showEl(this.sendFeedbackButton,!0),this.maybeShowAddPasswordButton(),this.showEl(this.extractButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.addFilesButtonContainer,!1),ze.App.maybeReportTestError(l),this.refreshZipTableBannerHeading();break;case ze.App.APP_STATE.ZIP_WRITE_CANCELLED:this.updateLabelsAndProgress("Adding to ZIP was canceled","",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.enableEl(this.cancelButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.refreshZipTableBannerHeading();break;case ze.App.APP_STATE.ZIP_ENCRYPTION_ERROR:this.updateLabelsAndProgress("Error when adding password to ZIP",e,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.showEl(this.extractButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1);break;case ze.App.APP_STATE.ZIP_ENCRYPTION_CANCELLED:this.updateLabelsAndProgress("Adding password to ZIP was canceled","",100);break;case ze.App.APP_STATE.EDIT_ZIP:var d=this.getFilesChangedStatusString(e,t,i),a=this.zipHasAtLeastOneEntry();null==d&&(d=a?"Editing ZIP file":"Creating new ZIP file"),this.setMainIcon(a?ze.App.MAIN_ICON_TYPE.EDIT:ze.App.MAIN_ICON_TYPE.ADD),this.updateLabelsAndProgress(d,"",100),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.showEl(this.extractButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.doneButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.downloadZipButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.zipFilenameInputContainer,!0),this.showEl(this.fileTableHeaderLabel,!1),""==this.zipFilenameInput.value?(this.zipFilename=this.zipFilenameInput.value,this.focusAndSmartSelectZipFilenameInput()):this.zipFilenameInput.value==ze.App.DEFAULT_ZIP_FILENAME&&this.focusAndSmartSelectZipFilenameInput();break;case ze.App.APP_STATE.PASSWORD_REQUIRED:var E=e,d="This "+this.currentArchiveTypeString+" file requires a password";"phone"!=detectDevice()&&(d+=" to open"),this.updateLabelsAndProgress(d,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SECURITY),this.showPasswordPrompt(),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.hideZipPasswordChars(),this.enableEl(this.checkPasswordButton,!1),this.enableEl(this.zipPasswordInput,!0),E&&(this.fileTableSubHeaderLabel.textContent="Filenames in this "+this.currentArchiveTypeString+" file are encrypted and can only be shown with a correct password",this.showEl(this.fileTableSubHeader,!0),this.rootStatusIcon.textContent="lock",this.rootStatusIcon.style.color="#DCA93B");break;case ze.App.APP_STATE.PASSWORD_INCORRECT:this.updateLabelsAndProgress("Incorrect password. Please try again",void 0,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showPasswordPrompt(),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.zipPasswordInput.select(),this.zipPasswordInput.focus(),this.flashElement(this.zipPasswordInput,"#d00000",2,100),this.enableEl(this.checkPasswordButton,!0),this.enableEl(this.zipPasswordInput,!0),this.zipPasswordInput.select(),this.zipPasswordInput.focus(),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0);break;case ze.App.APP_STATE.CHECK_PASSWORD_CANCELLED:this.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED),this.enableEl(this.checkPasswordButton,!0),this.enableEl(this.zipPasswordInput,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1);break;case ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED:this.updateLabelsAndProgress("Unsupported ZIP password format","ZIP Extractor can't open this password-protected ZIP format yet. Extraction cannot proceed"),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showEl(this.mainMoreActionsMouseDownButton,!1);break;case ze.App.APP_STATE.PASSWORD_VERIFIED:this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.checkPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.setReadyToExtract(!0),this.refreshZipTableBannerHeading(),this.refreshZipEntryTreeItemState(void 0,!0,void 0,!0);break;case ze.App.APP_STATE.AUTH_PENDING_AUTO:break;case ze.App.APP_STATE.AUTH_PENDING_USER:this.setAuthText('Authorization is pending your approval. Click "Allow" in the popup window to use ZIP Extractor.');break;case ze.App.APP_STATE.AUTH_MISMATCH:var A="The account you authorized ("+getUserEmail()+") does not match the account you used to open the file. Please try again.";this.setAuthText(A),this.updateUiForDownloadError(A,!0);break;case ze.App.APP_STATE.AUTH_ERROR:var c=!1,u="";"popup_closed_by_user"==e?u="You closed the popup window before completing authorization. Please try again.":("idpiframe_initialization_failed"==e?(u="There was a problem showing the authorization screen; please try again.",c=!0):"popup_blocked_by_browser"==e?u="Your web browser blocked the Google authorization popup window. Please enable popups.":"access_denied"==e?(u="You chose not grant access to ZIP Extractor. You may try again with the button above.",t=""):u="General authorization error; please try again.",t&&(u+=" (Details: "+t+")")),this.setAuthText(u),this.doResumeOpenFromDriveAfterManualAuth?this.doResumeOpenFromDriveAfterManualAuth=!1:this.doResumeExtractToDriveAfterManualAuth?(this.doResumeExtractToDriveAfterManualAuth=!1,this.enableEl(this.extractButton,!0)):this.doResumeSavePreviewItemToDriveAfterManualAuth?(this.doResumeSavePreviewItemToDriveAfterManualAuth=!1,this.enableEl(this.previewSaveToDriveButton,!0)):this.doResumeSaveZipToDriveAfterManualAuth?(this.doResumeSaveZipToDriveAfterManualAuth=!1,this.enableEl(this.saveZipToDriveButton,!0)):this.doResumeChooseFolderLocationAfterManualAuth?this.doResumeChooseFolderLocationAfterManualAuth=!1:this.doResumeAddFilesToZipFromDriveAfterManualAuth?(this.doResumeAddFilesToZipFromDriveAfterManualAuth=!1,this.enableEl(this.addFilesToZipFromDriveButton,!0)):(this.showEl(this.authButton,!0),this.showEl(this.authButtonDetails,!0)),c&&this.showEnableCookiesInfoPage();break;case ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED:this.enableEl(this.cancelButton,!1);break;case ze.App.APP_STATE.DOWNLOAD_CANCELED:this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.retryButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.updateLabelsAndProgress("Opening canceled","Click Retry to open this file again"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.setProgressBarPercent(100);break;case ze.App.APP_STATE.DOWNLOADING_METADATA:this.showEl(this.buttonContainer,!0);this.updateDownloadingFilename(""),this.showEl(this.selectAllCheckbox,!1),this.showEl(this.rootStatusSpinner,!0),this.showEl(this.rootStatusIconContainer,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.retryButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.updateLabelsAndProgress("Checking file in Google Drive...","This may take a few moments"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED:case ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP:this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);var T=e?'Downloading: "'+e+'"':"Downloading file data...";null!=t&&0!==t&&(T+=" ("+ze.App.formatSize(t)+")"),this.updateLabelsAndProgress("Adding files to ZIP...",T);break;case ze.App.APP_STATE.DOWNLOADING:e&&(this.updateDownloadingFilename(e,t),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="downloading",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0));break;case ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED:break;case ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED:this.updateLabelsAndProgress("Opening file from Google Drive..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.DOWNLOADED:this.showEl(this.cancelButton,!1),this.updateLabelsAndProgress("File downloaded",null,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.rootStatusIcon.textContent="file_download_done",this.rootStatusIcon.style.color="";break;case ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP:this.showEl(this.cancelButton,!1);break;case ze.App.APP_STATE.DOWNLOAD_ERROR:this.updateUiForDownloadError(e);break;case ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH:this.updateUiForDownloadError(e,!0);break;case ze.App.APP_STATE.INIT:break;case ze.App.APP_STATE.ZIP_READ_CANCELLED:this.updateLabelsAndProgress("Opening canceled","Click Retry to open this file again",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.enableEl(this.retryButton,!0),this.showEl(this.retryButton,!0);break;case ze.App.APP_STATE.MODULE_LOAD_ERROR:case ze.App.APP_STATE.ZIP_READ_ERROR:E=e,A=t,u=i,c=r;(l=e)&&l.target&&l.target.toString&&(l=(T=l.target.toString())&&-1!=T.indexOf("Worker")?"ZIP Worker Error":l&&"error"==l.type&&l.target&&l.target.src?"Target source: "+l.target.src:T);var z,h=null;h=this.appState==ze.App.APP_STATE.MODULE_LOAD_ERROR?"Error Loading Code Module":"Error reading "+this.currentArchiveTypeString+" file",(z=ze.App.getStackInfoFromErrorObj(E))&&(l+=" ("+z+")"),this.updateLabelsAndProgress(h,"Error details: "+l),this.showEl(this.buttonContainer,!0),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.extractButton,!1),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.setProgressBarPercent(100),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="warning",this.rootStatusIcon.style.color="#d00000",this.showEl(this.rootStatusIconContainer,!0),this.showEl(this.sendFeedbackButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!1),ze.App.maybeReportTestError(l),A&&this.maybeDisplayAlternateViewOfMistypedZip(c,u),this.manualUpdateFileTableHeaderFromEmbedded(),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.zipIsDirty=!1,this.showEl(this.doneButton,!1);break;case ze.App.APP_STATE.MODEL_BUILDING:this.updateLabelsAndProgress("Loading...","Processing '"+this.zipFilename+"'");break;case ze.App.APP_STATE.SESSION_CANCELED:break;case ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED:this.updateUiForExtractionCancelRequested(e);break;case ze.App.APP_STATE.EXTRACTION_CANCELED:this.zipIsDirty=!1,this.updateUiForExtractionComplete(!0,e);break;case ze.App.APP_STATE.RENDER_ZIP_UI:this.updateLabelsAndProgress("Loading...","Displaying '"+this.zipFilename+"'");break;case ze.App.APP_STATE.READY_TO_EXTRACT:this.promptToExtract(e,t);break;case ze.App.APP_STATE.ZIP_READING:this.updateLabelsAndProgress("Loading...","Reading '"+this.zipFilename+"'"),this.showEl(this.buttonContainer,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.EXTRACTING:this.updateUiForExtractionStart(),this.handleProgress(0,100);break;case ze.App.APP_STATE.DOWNLOADING_ALL_TO_LOCAL:this.showEl(this.extractButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.doneButton,!1),this.showEl(this.openSingleFileButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.locateFileInDriveButton,!1),this.updateUiForExtractionStart(!0),this.handleProgress(0,100);break;case ze.App.APP_STATE.LIBRARY_LOADING:this.updateLabelsAndProgress("Loading code module..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.CREATING_NEW_ZIP:this.updateLabelsAndProgress("Creating new ZIP file..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.NEW_SESSION:break;case ze.App.APP_STATE.EXTRACTION_COMPLETE:case ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS:this.zipIsDirty=!1,this.updateUiForExtractionComplete(!1,e);break;case ze.App.APP_STATE.CHECKING_PASSWORD:this.updateLabelsAndProgress("Checking password..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.hideZipPasswordChars(),this.enableEl(this.checkPasswordButton,!1),this.enableEl(this.zipPasswordInput,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.cancelButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1);break;default:throw new Error("Unexpected state: "+this.appState)}},ze.App.prototype.showOrHideOpenZipPartButtons=function(e){"drive"==this.zipBlobSource?this.showEl(this.addZipPartFromDriveButton,e):this.showEl(this.addZipPartFromComputerButton,e)},ze.App.prototype.manualUpdateFileTableHeaderFromEmbedded=function(){var e=0<this.previousZipBlobs.length;this.showEl(this.previousZipButton,e),this.fileTableHeaderLabel.textContent=this.zipFilename,null!=this.zipFileSize&&(this.fileTableHeaderSize.textContent=ze.App.formatSize(this.zipFileSize)),this.showEl(this.selectAllCheckbox,!1),this.showEl(this.rootStatusIconContainer,!0),this.showEl(this.fileTableContainer,!0)},ze.App.prototype.maybeDisplayAlternateViewOfMistypedZip=function(e,t){t&&ze.App.startsWith(t,"image/")&&(e=(window.URL||window.webkitURL).createObjectURL(e),this.cachedMistypedZipImageUri=e,this.fileTableAlternateImageImg.src=e,this.showEl(this.fileTableAlternateImage,!0),this.showEl(this.fileTableContainer,!0))},ze.App.prototype.getFilesChangedStatusString=function(e,t,i){i=i?"Creating new ZIP: ":"Editing ZIP file: ";return null!=e?i+(1==e?" 1 file added":e+" files added"):null!=t?i+(1==t?"1 file removed":t+" files removed"):null},ze.App.prototype.showPasswordPrompt=function(){this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.zipPasswordInputContainer,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.checkPasswordButton,!0),this.setProgressBarPercent(0)},ze.App.prototype.maybeShowAddPasswordButton=function(){this.zipEntryTree&&this.zipEntryTree.isEncrypted||this.showEl(this.addPasswordButton,!0)},ze.App.prototype.setMainIcon=function(e){e==ze.App.MAIN_ICON_TYPE.SPINNER?(this.mainLabel.style.color="",this.showEl(this.mainIcon,!1),this.showEl(this.mainSpinner,!0),this.mainAppHeaderContent.style.backgroundColor=""):(e=this.getMainHeaderConfigByType(e),this.mainIcon.textContent=e.iconKey,this.mainIcon.style.color=e.color,this.mainLabel.style.color=e.color,this.mainAppHeaderContent.style.backgroundColor=e.backgroundColor||"",this.showEl(this.mainIcon,!0),this.showEl(this.mainSpinner,!1))},ze.App.prototype.getMainHeaderConfigByType=function(e){var t={};switch(e){case ze.App.MAIN_ICON_TYPE.WARNING:t.iconKey="warning",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.MULTIPART:t.iconKey="auto_awesome_motion",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.ERROR:t.iconKey="error_outline",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.CANCEL:t.iconKey="warning",t.color="#d00000";break;case ze.App.MAIN_ICON_TYPE.SUCCESS:t.iconKey="check_circle",t.color="#1a73e8";break;case ze.App.MAIN_ICON_TYPE.SECURITY:t.iconKey="security",t.color="#1a73e8",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.LOCKED:t.iconKey="lock",t.color="",t.backgroundColor="";break;case ze.App.MAIN_ICON_TYPE.UNLOCKED:t.iconKey="lock_open",t.color="",t.backgroundColor="";break;case ze.App.MAIN_ICON_TYPE.ADD:t.iconKey="add_box",t.backgroundColor="",t.color="";break;case ze.App.MAIN_ICON_TYPE.EDIT:t.iconKey="edit",t.backgroundColor="",t.color="";break;case ze.App.MAIN_ICON_TYPE.INFO:t.iconKey="info_outline",t.backgroundColor="",t.color="";break;default:t.iconKey="info_outline",t.color="",t.backgroundColor=""}return t},ze.App.prototype.handleProgress=function(e,t){return this.handleGenericMainProgress(e,t)},ze.App.prototype.updateUiForFileComplete=function(e){e.root||(ze.App.getFilenameCell(e).style.color="#1a73e8",(e=ze.App.getIconCell(e)).style.color="#1a73e8",e.style.opacity="0.8")},ze.App.prototype.handleEncryptionPromptCheckboxClick=function(){var e=ze.App.isCheckboxIconButtonChecked(this.encryptionPromptCheckbox);ze.App.setCheckboxIconButtonChecked(this.encryptionPromptCheckbox,!e)},ze.App.prototype.handleSecondaryLabelLinkClick=function(){logImpression("choose_folder","user_button","app_state: "+this.appState),!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!1,!1,!1,!1,!0,!1),this.initiateManualAuth()):ze.App.showPicker(bindFn(this.handlePickerFolderSelected,this),!0)},ze.App.prototype.setProgressBarPercent=function(e){ze.App.doSetProgressBarPercent(e,this.mainProgressBar)},ze.App.prototype.setPreviewProgressBarPercent=function(e){ze.App.doSetProgressBarPercent(e,this.previewProgressBar)},ze.App.doSetProgressBarPercent=function(e,t){-1===e||(t.firstElementChild.style.width=e.toString()+"%")},ze.App.prototype.setAuthText=function(e){e=!!(this.authButtonDetails.textContent=e);this.showEl(this.authButtonDetails,e),this.showEl(this.authButtonContainer,e)},ze.App.prototype.updateLabelsAndProgress=function(e,t,i,r){null!=e&&(this.showEl(this.mainAppHeader,!0),this.mainLabel.textContent=e),null!=t&&""!==(this.secondaryLabel.childNodes[0].nodeValue=t)||this.setSecondaryLabelLinkText(""),null!=i&&this.setProgressBarPercent(i),r&&this.showEl(this.secondaryLabelLink,!1)},ze.App.prototype.updateDownloadingFilename=function(e,t){this.fileTableHeaderLabel.textContent=e,this.showEl(this.fileTableHeaderLabel,!0);t=null!=t&&""!==t?ze.App.formatSize(t):"";this.fileTableHeaderSize.textContent=t,this.showEl(this.fileTableContainer,!0)},ze.App.prototype.isTableEntrySelected=function(e){return!!e.root||ze.App.isChecked(e)},ze.App.prototype.renderZipTableUi=function(e){var t;this.setAppState(ze.App.APP_STATE.RENDER_ZIP_UI),this.fileTableHeaderLabel.textContent=this.zipFilename,null!=this.zipFileSize?(t=1==(t=this.zipEntryTree.originalEntries.length)?t+" file":t+" files",this.fileTableHeaderSize.textContent=t+", "+ze.App.formatSize(this.zipFileSize)):this.fileTableHeaderSize.textContent="",ze.App.generateZipTable(this.fileTableItems,this.zipEntryTree,bindFn(this.zipTableUiRendered,this,e),this.isInZipEditMode,this.zipEntryTree.isEncrypted)},ze.App.prototype.configurePasswordPrompt=function(){var e,t=this.isArchivePasswordFormatSupported(this.zipEntryTree.encryptionMode);logImpression("render_password_prompt","crypto","supported="+t+"; mode="+this.zipEntryTree.encryptionMode),t?this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_WINZIPAES||this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_RAR||this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_7ZAES?(e=this,ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){e.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED)})):this.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED):(this.setAppState(ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED,this.zipEntryTree.encryptionMode),ze.App.maybeReportTestError("PASSWORD_FORMAT_NOT_SUPPORTED")),this.refreshZipEntryTreeItemState(ze.App.ESTATE.DEFAULT,!1,void 0,!0)},ze.App.prototype.isArchivePasswordFormatSupported=function(e){return e==ze.App.ENCRYPTION_MODE_PKZIPSTANDARD||e==ze.App.ENCRYPTION_MODE_RAR||e==ze.App.ENCRYPTION_MODE_WINZIPAES||e==ze.App.ENCRYPTION_MODE_7ZAES},ze.App.prototype.zipTableUiRendered=function(e){this.showEl(this.fileTableContainer,!0),this.fileTableContainer.scrollTop=0,this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!1),this.showEl(this.selectAllCheckbox,!0),e&&e()},ze.App.prototype.getEntriesByState=function(e){return this.zipEntryStateMap[e]},ze.App.prototype.getFirstEntryByState=function(e){var t=this.getEntriesByState(e);if(t){e=Object.keys(t);if(e&&0<e.length)return t[e[0]]}return null},ze.App.prototype.getNumEntriesByState=function(e){e=this.getEntriesByState(e);if(e){e=Object.keys(e);if(e&&null!=e.length)return e.length}return 0},ze.App.prototype.getNumFilesExtracted=function(e){var t=e?ze.App.ESTATE.DOWNLOAD_COMPLETE:ze.App.ESTATE.UPLOAD_COMPLETE,e=e?0:1;return Math.max(this.getNumEntriesByState(t)-e,0)},ze.App.prototype.getNumFilesWithUploadErrors=function(){return this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_ERROR)},ze.App.prototype.getFirstErrorInfo=function(){var e=this.getFirstEntryByState(ze.App.ESTATE.UPLOAD_ERROR);if(e=e||this.getFirstEntryByState(ze.App.ESTATE.DECOMPRESSION_ERROR)){var t=e.error||"",e=e.message;return e&&(t+=" - "+e),t}return""},ze.App.prototype.getNumFilesWithDecompressionErrors=function(){return this.getNumEntriesByState(ze.App.ESTATE.DECOMPRESSION_ERROR)},ze.App.prototype.getNumFilesSkipped=function(){return this.getNumEntriesByState(ze.App.ESTATE.SKIPPED)+this.getNumEntriesByState(ze.App.ESTATE.PARSE_ERROR)+this.getNumEntriesByState(ze.App.ESTATE.ENTRY_DISK_MISSING)},ze.App.prototype.getNumFilesCanceled=function(){return this.getNumEntriesByState(ze.App.ESTATE.CANCELED)+this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_ABORTED)+this.getNumEntriesByState(ze.App.ESTATE.DECOMPRESSION_CANCELED)},ze.App.prototype.updateUiForExtractionComplete=function(e,t){var i,r,s,o,n,p,a,l,h,d,E,A,c,u,T;null!=this.zipEntryTree&&(this.sessionPropMap[ze.App.SESS_PROP.DIDZIPEXTRACT]=!0,this.setProgressBarPercent(100),this.fileTableContainer.scrollTop=0,i=this.getNumFilesExtracted(t),T=this.getNumFilesWithUploadErrors(),u=this.getNumFilesWithDecompressionErrors(),r=this.getNumFilesCanceled(),o=0<(s=this.getNumFilesSkipped()),n=0<r,a=0<(p=T+u),l=0<T,d=h="",this.updateRootEntryUi(this.zipEntryTree),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),t||(A=null!=this.getSingleTopLevelEntry(!1),E=this.getSingleTopLevelEntry(!0),c=!1,E&&E.driveFileId?c=!1:A&&!this.zipEntryTree.driveFileId?c=!0:this.parentFolderId&&(c=!1),this.showEl(this.viewFilesButton,!c),this.showEl(this.openSingleFileButton,c),this.showEl(this.locateFileInDriveButton,c)),T=(u=getUserLocale())&&ze.App.startsWith(u.toLowerCase(),"en"),E="adLoadedDuringInit"in window&&!!adLoadedDuringInit,A="adsenseScriptLoadError"in window&&!!adsenseScriptLoadError,c="computer"==detectDevice(),u=!E||A,!a&&!n&&!e&&c&&E&&A&&T&&!t?this.showEl(this.rateAppButton,!0):(a||n)&&u&&T&&this.showEl(this.sendFeedbackButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.downloadZipButton,!1),u=t?"Download":"Extraction",T=t?"downloaded to your computer":"extracted to Google Drive",e?(h=u+" canceled",this.showEl(this.retryButton,!0),this.showEl(this.doneButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)):(h=a?u+" complete, but with errors":u+" complete",this.showEl(this.extractButton,!1),this.showEl(this.retryButton,l),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),t&&(this.showEl(this.doneButton,!0),this.doneButton.focus()),this.rootStatusIcon.textContent=t?"done_all":"cloud_done"),d=1==i?"1 file "+T+". ":i+" files "+T+". ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS),n&&(d+=1==r?"1 file was canceled. ":r+" files were canceled. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)),a&&(d+=1==p?"1 file had an error. ":p+" files had errors. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)),o&&(d+=1==s?"1 file was skipped. ":s+" files were skipped. "),d=d.trim(),ze.App.endsWith(d,".")&&(d=d.substring(0,d.length-1)),this.updateLabelsAndProgress(h,d),a?ze.App.maybeReportTestError(u+" completed with "+p+" errors"):o?ze.App.maybeReportTestError(u+" completed with no errors but with "+s+" skipped items"):ze.App.maybeReportTestSuccess(u+" complete with "+i+" item(s) "+T),this.isElementShown(this.viewFilesButton)?this.viewFilesButton.focus():this.isElementShown(this.openSingleFileButton)&&this.openSingleFileButton.focus())},ze.App.prototype.updateUiForExtractionStart=function(e){this.showEl(this.extractButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.openSingleFileButton,!1),this.showEl(this.locateFileInDriveButton,!1),this.showEl(this.rateAppButton,!1),this.showEl(this.sendFeedbackButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.fixEncodingButton,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),this.setSecondaryLabelLinkText(""),e?this.updateLabelsAndProgress("Downloading all items from "+this.currentArchiveTypeString+" to your computer...","",0):this.updateLabelsAndProgress("Extracting "+this.currentArchiveTypeString+" file to Google Drive...","",0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER)},ze.App.prototype.updateSecondaryProgressString=function(e,t,i){this.updateLabelsAndProgress(void 0,this.getNumItemsUploadedString(e,t,i))},ze.App.prototype.getItemsRemainingString=function(e,t,i){i=this.getNumItemsRemaining(t,i),i=i.toString()+" "+(1==i?"file":"files")+" remaining";return null!=e&&-1!=e&&(i+=" ("+e+"%)"),i},ze.App.prototype.getNumItemsUploadedString=function(e,t,i){var r=t?ze.App.ESTATE.DOWNLOAD_COMPLETE:ze.App.ESTATE.UPLOAD_COMPLETE,r=this.getNumEntriesByState(r);!t&&this.zipEntryTree&&null!=this.zipEntryTree.driveFileId&&r--;i=r+this.getNumItemsRemaining(t,i),t=t?"downloaded":"extracted",t=r.toString()+" of "+i+" "+(1==i?"file":"files")+" "+t;return null!=e&&-1!=e&&(t+=" ("+e+"%)"),t},ze.App.prototype.getNumItemsRemaining=function(e,t){var i=Object.keys(this.zipEntriesInProcessMap).length;return e||t||!this.zipEntryTree||null!=this.zipEntryTree.driveFileId?i:i-1},ze.App.prototype.startNewManualSession=function(){this.setAppState(ze.App.APP_STATE.NEW_SESSION),this.showEl(this.zipTable,!1),this.fileTableContainer.scrollTop=0,this.zipPasswordInput.value="",this.zipFilenameInput.value="",this.showEl(this.extractButton,!1),this.enableEl(this.extractButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.openSingleFileButton,!1),this.showEl(this.locateFileInDriveButton,!1),this.showEl(this.rateAppButton,!1),this.showEl(this.sendFeedbackButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.fileTableSubHeader,!1),this.showEl(this.secondaryLabelLink,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.previewMoreActionsMouseDownButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.addZipPartFromComputerButton,!1),this.showEl(this.addZipPartFromDriveButton,!1),this.showEl(this.checkPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.addFilesGeneralPromptButton,!1),this.showEl(this.doneButton,!1),this.showEl(this.previousZipButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.fixEncodingButton,!1),this.showEl(this.fileTableAlternateImage,!1),this.secondaryLabel.childNodes[0].nodeValue="",this.mainLabel.textContent="",this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.fileTableContainer,!1),this.showEl(this.buttonContainer,!1),this.showEl(this.selectAllCheckbox,!1),ze.App.setCheckboxIconButtonChecked(this.selectAllCheckbox,!0),this.setProgressBarPercent(0),this.highestZipEntryIndexUploadedInSession=0},ze.App.prototype.promptToExtract=function(e,t){this.showEl(this.closeButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.doneButton,!1),this.showEl(this.retryButton,!1);var i=this.zipHasAtLeastOneEntry();this.showEl(this.extractButton,!0),this.enableEl(this.extractButton,!0),this.updateExtractButtonEnablement(),this.showEl(this.sendFeedbackButton,!1),this.wasZipFileCreatedLocallyOrEdited?(r=null!=this.zipDriveFileId,this.showEl(this.extractButton,i),this.showEl(this.downloadZipButton,i),this.showEl(this.saveZipToDriveButton,!r&&i),this.showEl(this.openZipInDriveButton,r&&!this.isElementShown(this.saveZipToDriveButton))):(this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.extractButton,!0),i||(t=!0)),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.doneButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0);var r=null!=this.getSingleTopLevelEntry(!1);this.skipCreateParentFolderForSession=r,this.showEl(this.buttonContainer,!0),this.showEl(this.addFilesGeneralPromptButton,!!t&&!i),this.showEl(this.editZipButton,!!t&&i),this.cancelButton.style.visibility="",this.updateLabelsForReadyToExtract(e),i||(this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="remove",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0)),this.wasZipFileCreatedLocallyOrEdited&&this.isElementShown(this.saveZipToDriveButton)&&this.isElementEnabled(this.saveZipToDriveButton)?this.saveZipToDriveButton.focus():this.isElementShown(this.extractButton)&&this.isElementEnabled(this.extractButton)?this.extractButton.focus():this.isElementShown(this.addFilesGeneralPromptButton)?this.addFilesGeneralPromptButton.focus():this.isElementShown(this.doneButton)&&this.isElementEnabled(this.doneButton)&&this.doneButton.focus()},ze.App.prototype.hideWelcomeText=function(){this.showEl(this.generalButtonContainer,!1),this.showEl(this.authButtonContainer,!1),this.showEl(this.startPagePrompt,!1)},ze.App.prototype.updateLabelsForReadyToExtract=function(e){var t=e?"Password correct. ":"",i=this.wasZipFileCreatedLocallyOrEdited?"Ready to extract, download, or save ":"Ready to extract ",r=detectDevice();"phone"==r&&e||(i+=this.currentArchiveTypeString+" file"),this.zipIsEmpty()&&(i+=" (file is empty)"),"phone"!=r&&this.currentAutodetectedEncoding&&(i+=' (encoding: "'+this.currentAutodetectedEncoding+'")'),this.restoreSecondaryLabelExtractionLocationText(t+i),e?this.setMainIcon(ze.App.MAIN_ICON_TYPE.UNLOCKED):this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO)},ze.App.prototype.restoreSecondaryLabelExtractionLocationText=function(e){this.updateLabelsAndProgress(e,"Location for extracted files: ",100),this.setSecondaryLabelLinkText(this.currentExtractionLocation||ze.App.DEFAULT_DRIVE_EXTRACTION_LOCATION,!0)},ze.App.prototype.setSecondaryLabelLinkText=function(e,t){e?(this.currentExtractionLocation=e,this.secondaryLabelLink.textContent=e,this.showEl(this.secondaryLabelLink,!0),t&&this.showEl(this.secondaryLabelLinkCombo,!0)):(this.secondaryLabelLink.textContent="",this.showEl(this.secondaryLabelLink,!1))},ze.App.prototype.updateUiForExtractionCancelRequested=function(e){this.enableEl(this.cancelButton,!1);e="Canceling "+(e?"download":"extraction");this.updateLabelsAndProgress(e),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER)},ze.App.prototype.updateUiForDownloadError=function(e,t){this.showEl(this.cancelButton,!1),this.showEl(this.retryButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.fileTableContainer,!1);e=e||"Unknown error";this.updateLabelsAndProgress("Unable to open ZIP file",e),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)},ze.App.prototype.handlePreviewCloseButtonClick=function(){this.closePreview()},ze.App.prototype.isPreviewShown=function(){return null!=this.previewedEntry},ze.App.prototype.closePreview=function(){this.showEl(this.previewDownloadButton,!1),this.showEl(this.previewSaveToDriveButton,!1),this.showEl(this.previewOpenInDriveButton,!1),this.showEl(this.previewOpenEmbeddedArchiveButton,!1),this.showEl(this.preview,!1),this.mainScrollableContent.scrollTop=0,this.showEl(this.zipTable,!0),this.resetPreview(),this.wasZipFileCreatedLocallyOrEdited&&this.isElementShown(this.saveZipToDriveButton)&&this.isElementEnabled(this.saveZipToDriveButton)?this.saveZipToDriveButton.focus():this.isElementShown(this.extractButton)&&this.extractButton.focus()},ze.App.prototype.openEmbeddedArchive=function(e){this.previewedEntry=e,this.isCurrentlyInJumpToZipOperation=!0,this.showEl(this.secondaryLabelLink,!1),this.showEl(this.extractButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.editZipButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.enableEl(this.previousZipButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.updateLabelsAndProgress("Opening "+e.name+"...","Decompressing..."),this.setProgressBarPercent(0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.previousZipBlobs.push(this.zipBlob),this.previousZipFilenames.push(this.zipFilename),ze.App.decompressArchiveEntry(this.zipBlob,e,!0,bindFn(this.jumpToZipSuccess,this,e),bindFn(this.jumpToZipErrorOrCancel,this,e),bindFn(this.handleJumpToZipDecompressProgress,this),bindFn(this.generalDecompressionCheckCancelFn,this),this.getZipPasswordCharCodeByteArray(),void 0,e.name)},ze.App.prototype.handlePreviewOpenEmbeddedArchiveButtonClick=function(){logImpression("open_embedded","user_button"),this.previewedEntry&&this.openEmbeddedArchive(this.previewedEntry)},ze.App.prototype.handlePreviewDownloadButtonClick=function(){logImpression("preview_download","user_button","previewed_entry_is_null: "+(null==this.previewedEntry)),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADPREVIEWEDITEM]=!0;var e=this;this.previewedBlob?(this.enableEl(this.previewDownloadButton,!1),this.downloadBlobToBrowser(this.previewedEntry.name,new Blob([this.previewedBlob],{type:"application/octet-stream"})),this.enableEl(this.previewDownloadButton,!0)):(this.willDownloadAfterDecompression=!0,this.decompressPreviewedBlob(this.previewedEntry,function(){e.isPreviewDecompressing=!1,e.wasPreviewDecompressionCancelled=!1,e.willDownloadAfterDecompression=!1,e.updatePreviewFilenameLabel(),e.downloadBlobToBrowser(e.previewedEntry.name,new Blob([e.previewedBlob],{type:"application/octet-stream"})),e.configurePreviewActionButtonsForWorkingOperation(!1)},bindFn(this.previewDecompressionErrorOrCancel,this,this.previewedEntry),bindFn(this.previewDecompressionProgressFunction,this,this.previewedEntry,!0),bindFn(this.generalDecompressionCheckCancelFn,this)))},ze.App.prototype.updatePreviewFilenameLabel=function(){this.previewZipFilenameAndStatus.textContent=this.zipFilename},ze.App.prototype.storeDecompressedPreviewedBlob=function(e,t){var i={};"pdf"==ze.App.getFileExtension(e.name)&&(i.type="application/pdf"),this.previewedBlob=new Blob([t],i)},ze.App.prototype.decompressPreviewedBlob=function(t,i,e,r,s){this.configurePreviewActionButtonsForWorkingOperation(!0,!0),t.isEncrypted&&r?this.previewZipFilenameAndStatus.textContent="Decrypting...":this.previewZipFilenameAndStatus.textContent="Decompressing...",this.isPreviewDecompressing=!0,this.wasPreviewDecompressionCancelled=!1;var o=this;ze.App.decompressArchiveEntry(this.zipBlob,t,!0,function(e){o.isPreviewDecompressing=!1,o.wasPreviewDecompressionCancelled=!1,o.storeDecompressedPreviewedBlob(t,e),i()},e,r,s,this.getZipPasswordCharCodeByteArray())},ze.App.prototype.handlePreviewNextButtonClick=function(){var e;this.previewedEntry?(this.previewNextButton.blur(),(e=this.getNextOrPrevEntry(this.previewedEntry,!0))&&this.updateCurrentPreview(e)):this.previewNextButton.blur()},ze.App.prototype.handlePreviewPrevButtonClick=function(){var e;this.previewedEntry?(this.previewPrevButton.blur(),(e=this.getNextOrPrevEntry(this.previewedEntry,!1))&&this.updateCurrentPreview(e)):this.previewPrevButton.blur()},ze.App.prototype.getNextOrPrevEntry=function(e,t){var i=e.tableRow;if(i){var r=t?i.nextElementSibling:i.previousElementSibling;if(r){r=r.entry;return r.directory?this.getNextOrPrevEntry(r,t):r}i=t?i.parentElement.firstElementChild:i.parentElement.lastElementChild;if(i&&i.entry!=e){i=i.entry;return i.directory?this.getNextOrPrevEntry(i,t):i}return null}return null},ze.App.prototype.updateCurrentPreview=function(e){this.resetPreview(),this.previewEntry(e)},ze.App.prototype.handlePreviewSaveToDriveButtonClick=function(){logImpression("preview_save_to_drive","user_button"),this.savePreviewedItemToDrive()},ze.App.prototype.savePreviewedItemToDrive=function(){!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!1,!1,!0,!1,!1,!1),this.initiateManualAuth()):this.previewedBlob?this.savePreviewedBlobToDrive():(this.willSaveToDriveAfterDecompression=!0,this.decompressPreviewedBlob(this.previewedEntry,bindFn(this.savePreviewedBlobToDrive,this,this.previewedEntry),bindFn(this.previewDecompressionErrorOrCancel,this,this.previewedEntry),bindFn(this.previewDecompressionProgressFunction,this,this.previewedEntry,!0),bindFn(this.generalDecompressionCheckCancelFn,this)))},ze.App.prototype.configurePreviewActionButtonsForWorkingOperation=function(e,t,i){t?(this.showEl(this.previewCancelButton,e),this.enableEl(this.previewCancelButton,e)):this.showEl(this.previewCancelButton,!1),this.showEl(this.previewDownloadButton,!e),this.showEl(this.previewNextButton,!e),this.showEl(this.previewPrevButton,!e),this.showEl(this.previewCloseButton,!e),this.showEl(this.previewMoreActionsMouseDownButton,!e),this.showEl(this.previewSpinner,e),this.showEl(this.previewItemIcon,!e);t=this.previewType&&ze.App.startsWith(this.previewType,"archive-");this.showEl(this.previewOpenEmbeddedArchiveButton,!e&&t),this.showEl(this.previewOpenInDriveButton,!e&&!!i),this.showEl(this.previewSaveToDriveButton,!e&&!i)},ze.App.prototype.fixEncoding=function(){this.enableEl(this.fixEncodingButton,!1),ze.App.ensureLibLoadedAndCallback(ze.App.LIB_JSCHARDET_WINDOW_OBJECT_CHECK,ze.App.LIB_JSCHARDET_SCRIPT_NAME,bindFn(this.doFixEncoding,this))},ze.App.prototype.doFixEncoding=function(){logImpression("fix_encoding","encoding"),this.updateLabelsAndProgress("Detecting encoding..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);var e,t,i,r,s,o,n,p,a=this.autodetectEncoding();logImpression("detected_encoding","encoding",a||"{null}"),null!=a?(e=this.zipFilename,t=this.zipBlob,i=this.isTarFile,r=this.parentFolderId,s=this.zipParentId,o=this.previousZipBlobs,n=this.previousZipFilenames,p=null,this.appState!=ze.App.APP_STATE.PASSWORD_REQUIRED&&(p=this.zipPasswordInput.value),this.closeSession(),this.parentFolderId=r,this.zipParentId=s,this.previousZipBlobs=o,this.previousZipFilenames=n,p&&(this.zipPasswordInput.value=p,this.enableEl(this.checkPasswordButton,!0),this.enableEl(this.zipPasswordInput,!0),p=""),this.currentAutodetectedEncoding=a,a=null,i&&(a=ze.App.CANONICAL_MIME_TYPES.TAR),this.loadArchiveSessionFromManualBlobs(e,t,void 0,void 0,a,this.getZipPasswordCharCodeByteArray())):(this.updateLabelsAndProgress("Unable to autodetect encoding"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.showEl(this.fixEncodingButton,!1),this.enableEl(this.fixEncodingButton,!1),this.zipEntryTree.filenameHasExtendedChar=!1,this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.secondaryLabelLinkCombo,!0),this.refreshZipTableBannerHeading())},ze.App.prototype.autodetectEncoding=function(){if(!this.zipHasAtLeastOneEntry())return null;for(var e="",t=0;t<this.zipEntryTree.originalEntries.length;t++){var i=this.zipEntryTree.originalEntries[t];if(i.rawFilenameBytes)for(var r=0;r<i.rawFilenameBytes.length;r++)e+=String.fromCharCode(i.rawFilenameBytes[r]);else e+=i.filename;e+=" "}var s=jschardet.detect(e);return window.console.log(s),s&&s.encoding?s.encoding.toLowerCase():null},ze.App.prototype.setResumeFlags=function(e,t,i,r,s,o){this.doResumeOpenFromDriveAfterManualAuth=e,this.doResumeExtractToDriveAfterManualAuth=t,this.doResumeSavePreviewItemToDriveAfterManualAuth=i,this.doResumeSaveZipToDriveAfterManualAuth=r,this.doResumeChooseFolderLocationAfterManualAuth=s,this.doResumeAddFilesToZipFromDriveAfterManualAuth=o},ze.App.prototype.handleAddZipPartsFromDrive=function(e){ze.App.showPicker(bindFn(this.handleAddZipPartsFromDrivePickerCallback,this,e),!1,void 0,"Select parts to add to ZIP (.z01, .z02, etc.)...",!0,!0,e)},ze.App.prototype.handleAddZipPartsFromDrivePickerCallback=function(e,t){var i=ze.App.getArchiveFilesProperties(t,e),r=null;if(i.hasMultiPartArchiveParts){r=[];for(var s=0;s<i.multiPartArchivePartsIdx.length;s++)r.push(t[i.multiPartArchivePartsIdx[s]])}if(console.log("Picked multiple file parts from drive! ",r),r&&0<r.length){for(var o=[],n=0;n<r.length;n++)o.push(r[n].id);this.downloadAndAddMultipleFilePartIdsToExistingArchive(o)}else console.log("No viable matching Zip Parts selected.")},ze.App.prototype.downloadAndAddMultipleFilePartIdsToExistingArchive=function(e){var r=this;this.downloadMultipleFileIds(e,function(e,t){for(var i=0;i<e.length;i++)e[i].name=t[i].name;r.addZipPartBlobsToExistingMultiPartArchive(e)},function(e){console.trace(),console.log("download multipart ERROR",e),r.updateLabelsAndProgress(void 0,"Multi-Download Error (B): "+e,100)})},ze.App.prototype.downloadMultipleFileIds=function(e,t,i,r){this.doDownloadMultipleFileIds(e,0,[],[],t,i)},ze.App.prototype.doDownloadMultipleFileIds=function(t,i,r,s,o,n,p){try{if(i>=t.length)return logImpression("add_parts_from_drive","multipart","success"),void o(r,s);var a=t[i],l=this,e=ze.Dapi.generateCallbacks(function(e){s.push(e),p?l.doDownloadMultipleFileIds(t,i+1,r,s,o,n):(e=ze.Dapi.generateCallbacks(function(e){r.push(e),l.doDownloadMultipleFileIds(t,i+1,r,s,o,n)},n,bindFn(l.onDownloadProgress,l,!0,e.name,e.size),n),l.lastDownloadId=a,ze.Dapi.downloadFileBytes(a,e))},n,void 0,n);this.updateLabelsAndProgress(void 0,"Downloading ZIP part...",0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),ze.Dapi.get(a,e)}catch(e){this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),n(e)}},ze.App.prototype.downloadMultiPartZipPart=function(i,r,e){var t=i[r],s=ze.App.getProcessedSizeFromDriveFileObj(t),o=t.name.trim(),n=t.mimeType,p=this,s=ze.Dapi.generateCallbacks(function(e){e=new Blob([e],{type:n});e.name=o,p.addFilesToZip([e],!0,function(){p.doAddFileOrFileStubToZipFromDrive(i,r+1,numFilesAdded+1,opt_isForCreate)})},function(e,t){p.addFilesToZipOrEncryptZipCancelRequested?p.handleZipWriteError("Adding files to ZIP canceled",!0):(p.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),p.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),p.configureZipEditMode(void 0,void 0,opt_isForCreate),p.doAddFileOrFileStubToZipFromDrive(i,r+1,numFilesAdded,opt_isForCreate))},bindFn(this.onDownloadProgress,this,!0,o,s),function(e){p.addFilesToZipOrEncryptZipCancelRequested?p.handleZipWriteError("Adding files to ZIP canceled",!0):(p.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),p.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),p.configureZipEditMode(),p.doAddFileOrFileStubToZipFromDrive(i,r+1,numFilesAdded,opt_isForCreate))});this.lastDownloadId=t.id,ze.Dapi.downloadFileBytes(t.id,s)},ze.App.prototype.addFilesToZipFromDrive=function(e){ze.App.showPicker(bindFn(this.handleAddFilesToZipFromDrivePickerCallback,this),!1,e,"Select files to add to ZIP...",!0,!0)},ze.App.prototype.handleAddFilesToZipFromDrivePickerCallback=function(e){logImpression("add_files_from_drive_picker","create_zip","start. count: "+e.length);var t=this.zipIsEmpty();this.doAddFileOrFileStubToZipFromDrive(e,0,0,t)},ze.App.prototype.doAddFileOrFileStubToZipFromDrive=function(i,r,s,o){if(r>=i.length)return logImpression("add_files_from_drive","create_zip","success"),this.numFilesRecentlyAdded=s,this.numFilesRecentlyRemoved=null,void this.setAppState(ze.App.APP_STATE.ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE,void 0,s,void 0,o);this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1;var n,e,t=i[r];t.needsMetadata?(this.setAppState(ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP),n=this,e=ze.Dapi.generateCallbacks(function(e){t.size=e.size,t.name=e.name,t.mimeType=e.mimeType,n.doAddFileToZipFromDriveWithFullMetadata(i,r,s,o)},function(e,t){n.doAddFileOrFileStubToZipFromDrive(i,r+1,s,o)},void 0,function(e){n.doAddFileOrFileStubToZipFromDrive(i,r+1,s,o)}),ze.Dapi.get(t.id,e)):this.doAddFileToZipFromDriveWithFullMetadata(i,r,s,o)},ze.App.prototype.doAddFileToZipFromDriveWithFullMetadata=function(i,r,s,o){var e=i[r],t=ze.App.getProcessedSizeFromDriveFileObj(e),n=e.name.trim();this.setAppState(ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP,n,t);var p=e.mimeType,a=this,t=ze.Dapi.generateCallbacks(function(e){a.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP);e=new Blob([e],{type:p});e.name=n,a.addFilesToZip([e],!0,function(){a.doAddFileOrFileStubToZipFromDrive(i,r+1,s+1,o)})},function(e,t){a.addFilesToZipOrEncryptZipCancelRequested?a.handleZipWriteError("Adding files to ZIP canceled",!0):(a.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),a.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),a.configureZipEditMode(void 0,void 0,o),a.doAddFileOrFileStubToZipFromDrive(i,r+1,s,o))},bindFn(this.onDownloadProgress,this,!0,n,t),function(e){a.addFilesToZipOrEncryptZipCancelRequested?a.handleZipWriteError("Adding files to ZIP canceled",!0):(a.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),a.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),a.configureZipEditMode(),a.doAddFileOrFileStubToZipFromDrive(i,r+1,s,o))});this.lastDownloadId=e.id,ze.App.isExportableGoogleDocsMimeType(e.mimeType)?(n+=".pdf",ze.Dapi.exportGoogleDocFileBytes(e.id,t)):ze.Dapi.downloadFileBytes(e.id,t)},ze.App.prototype.saveZipToDrive=function(e){var t,i;this.sessionPropMap[ze.App.SESS_PROP.DIDSAVEZIPTODRIVE]=!0,!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!1,!1,!1,!0,!1,!1),this.initiateManualAuth()):(i=this.zipEntryTree?this.zipEntryTree.encryptionMode:"null zipEntryTree",logImpression("save_zip_to_drive","create_zip","start. encryptionMode: "+i),this.updateLabelsAndProgress("Saving "+this.currentArchiveTypeString+" file to Google Drive...","Saving...",void 0,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.isSavingToDrive=!0,this.wasSaveToDriveCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.showEl(this.doneButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.openSingleFileButton,!1),this.showEl(this.locateFileInDriveButton,!1),this.showEl(this.rateAppButton,!1),this.showEl(this.sendFeedbackButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.extractButton,!1),this.showEl(this.mainMoreActionsMouseDownButton,!1),this.showEl(this.editZipButton,!1),this.setProgressBarPercent(0),t=ze.Dapi.generateCallbacks(bindFn(this.saveZipToDriveUploadComplete,this),bindFn(this.saveZipToDriveUploadError,this),bindFn(this.saveZipToDriveUploadProgress,this,this.zipBlob.size),bindFn(this.saveZipToDriveUploadAborted,this)),i=STATE.folderId||this.parentFolderId,e=e?this.zipDriveFileId:null,ze.Dapi.uploadFile(t,this.zipFilename,this.zipBlob,i,e))},ze.App.prototype.saveZipToDriveUploadComplete=function(e){logImpression("save_zip_to_drive","create_zip","success"),this.setProgressBarPercent(100),this.zipParentId=ze.App.getParentIdOfDriveFile(e),this.zipDriveFileId=e.id,this.isSavingToDrive=!1,this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.extractButton,!0),this.zipIsDirty=!1,this.wasZipFileCreatedLocallyOrEdited&&this.showEl(this.downloadZipButton,!0),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!0),this.openZipInDriveButton.focus(),this.restoreSecondaryLabelExtractionLocationText(this.currentArchiveTypeString+" file saved to Google Drive"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS)},ze.App.prototype.saveZipToDriveUploadProgress=function(e,t,i){e=null!=i&&0!==i?i:e;this.handleGenericMainProgress(t,e,!0,"Saving")},ze.App.prototype.saveZipToDriveUploadError=function(e,t,i){logImpression("save_zip_to_drive","create_zip","error: "+t),this.showEl(this.saveZipToDriveButton,!0),this.setProgressBarPercent(100),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.showEl(this.cancelButton,!1),this.showEl(this.doneButton,!0),this.saveZipToDriveButton.focus(),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.updateLabelsAndProgress("Error when saving ZIP file"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.updateLabelsAndProgress(null,"Error details: "+(t||""))},ze.App.prototype.saveZipToDriveUploadAborted=function(e,t){logImpression("save_zip_to_drive","create_zip","aborted. message: "+(t||"")),this.showEl(this.saveZipToDriveButton,!0),this.setProgressBarPercent(100),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.showEl(this.doneButton,!0),this.saveZipToDriveButton.focus();var i=this.wasSaveToDriveCancelled?"Saving "+this.currentArchiveTypeString+" to Drive was canceled":"Error when saving "+this.currentArchiveTypeString+" file. ",t=this.wasSaveToDriveCancelled?'You may try again with the "Save '+this.currentArchiveTypeString+' to Drive" button. ':"There was a network problem. "+(t||"");this.updateLabelsAndProgress(i,t);t=this.wasSaveToDriveCancelled?ze.App.MAIN_ICON_TYPE.WARNING:ze.App.MAIN_ICON_TYPE.ERROR;this.setMainIcon(t)},ze.App.prototype.savePreviewedBlobToDrive=function(e){logImpression("preview_upload_file","preview","start"),null!=this.previewedEntry&&null!=this.previewedBlob&&(null!=e&&e!=this.previewedEntry||(this.configurePreviewActionButtonsForWorkingOperation(!0,!0),this.previewZipFilenameAndStatus.textContent="Saving to Drive...",this.isSavingToDrive=!0,this.wasSaveToDriveCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.setPreviewProgressBarPercent(0),e=ze.Dapi.generateCallbacks(bindFn(this.previewFileUploadComplete,this,this.previewedEntry),bindFn(this.previewFileUploadError,this,this.previewedEntry),bindFn(this.previewFileUploadProgress,this,this.previewedEntry,!0,this.previewedBlob.size),bindFn(this.previewFileUploadAborted,this,this.previewedEntry)),ze.Dapi.uploadFile(e,this.previewedEntry.name,this.previewedBlob,null)))},ze.App.prototype.previewFileUploadComplete=function(e,t){logImpression("preview_upload_file","preview","success"),this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1),this.updatePreviewFilenameLabel(),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,e.driveFileId=t.id,this.showEl(this.previewOpenInDriveButton,!0),this.showEl(this.previewSaveToDriveButton,!1),this.previewOpenInDriveButton.focus(),this.previewType&&ze.App.startsWith(this.previewType,"drive")||e.forcePreviewInDrive?(this.showEl(this.previewDriveSaveToDriveFirst,!1),this.showEl(this.previewSaveToDriveDetails,!1),e.forcePreviewInDrive&&(this.hideAllPreviewDivs(),this.showEl(this.previewDriveContent,!0)),this.doEmbeddedDrivePreview(e.driveFileId)):(this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0))},ze.App.prototype.previewFileUploadError=function(e,t,i){logImpression("preview_upload_file_error","preview","error: "+i),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.previewZipFilenameAndStatus.textContent="Save to Drive error: "+i,this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1),this.isElementShown(this.previewSaveToDriveButton)&&this.isElementEnabled(this.previewSaveToDriveButton)&&this.previewSaveToDriveButton.focus()},ze.App.prototype.previewFileUploadAborted=function(e,t,i){logImpression("preview_upload_file_aborted","preview","message: "+i),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.wasSaveToDriveCancelled?this.updatePreviewFilenameLabel():this.previewZipFilenameAndStatus.textContent="Save to Drive error (network problem)",this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1),this.isElementShown(this.previewSaveToDriveButton)&&this.isElementEnabled(this.previewSaveToDriveButton)&&this.previewSaveToDriveButton.focus()},ze.App.prototype.previewFileUploadProgress=function(e,t,i,r,s){i=null!=s&&0!==s?s:i;this.handleGenericPreviewProgress(r,i,t,"Saving to Drive...")},ze.App.prototype.handlePreviewOpenInDriveButtonClick=function(){null!=this.previewedEntry.driveFileId&&ze.App.openEntryInDrive(this.previewedEntry)},ze.App.prototype.downloadBlobToBrowser=function(e,t,i){i||logImpression("download_blob_to_browser_start","download_blob_to_browser");var r=window.URL||window.webkitURL,s=this.downloadAnchorEl,t=r.createObjectURL(t);s.setAttribute("href",t),s.setAttribute("download",e),s.setAttribute("target","_blank"),s.textContent=e;try{s.click(),i||logImpression("download_blob_to_browser_success","download_blob_to_browser")}catch(e){i||logImpression("download_blob_to_browser_error","download_blob_to_browser",e)}},ze.App.prototype.downloadZipToBrowser_newWindowMethod=function(t,e){var i=new FileReader,e=new Blob([e],{type:"application/zip"});i.onload=function(e){window.open(t,"_self").location.href=i.result},i.readAsDataURL(e)},ze.App.prototype.handlePickerZipFileSelected=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKDRIVEZIP]=!0,this.closeSession(),this.zipBlobSource="drive",this.downloadFileById(e.id)},ze.App.prototype.handlePickerFolderSelected=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKEXTRACTLOCATION]=!0,this.parentFolderId=e.id,this.setSecondaryLabelLinkText(e.name)},ze.App.prototype.handleAddLocalFileInputElChange=function(e){this.isProcessingAddLocalFileInputEl||(this.isProcessingAddLocalFileInputEl=!0,(e=e.target.files)&&0<e.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP]=!0,this.addFilesToZip(e,void 0,void 0,!0)),this.addLocalFileInputEl.value="",this.isProcessingAddLocalFileInputEl=!1)},ze.App.prototype.handleAddLocalFolderInputElChange=function(e){var t,i,r,s;this.isProcessingAddLocalFolderInputEl||(this.isProcessingAddLocalFolderInputEl=!0,(t=e.target.files)&&0<t.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFOLDERSTOZIP]=!0,r=i=null,!(s=t[0].relativePath||t[0].webkitRelativePath)||-1!=(e=s.indexOf("/"))&&(i=(r=s.substring(0,e))+".zip"),this.addFilesToZip(t,void 0,void 0,!0,!0,i,r)),this.addLocalFolderInputEl.value="",this.isProcessingAddLocalFolderInputEl=!1)},ze.App.prototype.addZipPartBlobsToExistingMultiPartArchive=function(e){var t,i,r,s,o;this.addZipPartFilesToMapAndCreateMaskIndex(e,this.zipFilename),0<this.numExtraZipParts&&this.areAdditionalZipPartsRequired()?(s=this.getAdditionalZipPartsRequiredExtensionString(),this.setAppState(ze.App.APP_STATE.MULTI_PART_ZIP,s),logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","partial. numExtraParts: "+this.numExtraZipParts+"; partsRequiredString: "+s),this.refreshZipEntryMissingDiskStatusFromCurrentState()):(logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","success. numExtraParts: "+this.numExtraZipParts),t=this.zipFilename,o=this.zipBlob,i=this.extraZipPartsMap,r=this.numExtraZipParts,e=this.zipPartsLoadedMask,s=this.parentFolderId,this.closeSession(),this.extraZipPartsMap=i,this.numExtraZipParts=r,this.zipPartsLoadedMask=e,this.parentFolderId=s,s=o.size,o=this.getConsolidatedZipBlobFromZipPartsMap(o),this.loadArchiveSessionFromManualBlobs(t,o,void 0,s))},ze.App.prototype.handleOpenLocalZipPartFileInputElChange=function(e){this.isProcessingOpenLocalZipPartFileInputEl||(this.isProcessingOpenLocalZipPartFileInputEl=!0,(e=e.target.files)&&0<e.length&&this.addZipPartBlobsToExistingMultiPartArchive(e),this.isProcessingOpenLocalZipPartFileInputEl=!1)},ze.App.prototype.handleOpenLocalZipFileInputElChange=function(e){this.isProcessingOpenLocalZipFileInputEl||(this.isProcessingOpenLocalZipFileInputEl=!0,(e=e.target.files)&&0<e.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDPICKLOCALZIP]=!0,this.closeSession(),this.maybeCreateLocalSessionFromFiles(e,!1)),this.openLocalZipFileInputEl.value="",this.isProcessingOpenLocalZipFileInputEl=!1)},ze.App.prototype.loadArchiveSessionFromManualBlobs=function(e,t,i,r,s,o){this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.updateDownloadingFilename(e,t.size),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="downloading",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0);var n=this;this.readArchiveWithInferredMimetype(e,t,r,o,function(e){e&&(i&&0<i.length&&n.addZipPartBlobsToExistingMultiPartArchive(i),o&&o.length&&0<o.length&&(n.zipEntryTree.isEncrypted=!1,n.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED),n.refreshZipTableBannerHeading()))},s)},ze.App.getArchiveFilesProperties=function(e,t){for(var i=Math.min(1e4,e.length),r={primaryArchiveIdx:-1,secondaryArchivesIdx:[],otherFilesIdx:[],multiPartArchivePartsIdx:[],isDirectoryTree:!1},s=0;s<i;s++){var o=e[s];if(0!=s&&o.isDirectory)return r.isDirectoryTree=!0,r;var n=o.name.trim(),o=ze.App.getFileExtension(n);o&&""!=o&&-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(o)&&(!(r.hasPrimaryArchive||t&&ze.App.getBaseFilenameNoExtension(n)!=t)?(r.hasPrimaryArchive=!0,r.primaryArchiveBaseName=ze.App.getBaseFilenameNoExtension(n),r.primaryArchiveIdx=s):(r.hasSecondaryArchives=!0,r.secondaryArchivesIdx.push(s)))}for(var p,a,l=t||r.primaryArchiveBaseName,h=0;h<i;h++)h!=r.primaryArchiveIdx&&(p=e[h].name.trim(),a=!1,null!=ze.App.translateZipPartFilenameToIndex(p)&&null!=l&&l==ze.App.getBaseFilenameNoExtension(p)&&(a=!0),a?(r.hasMultiPartArchiveParts=!0,r.multiPartArchivePartsIdx.push(h)):(r.hasOtherFiles=!0,r.otherFilesIdx.push(h)));return r},ze.App.prototype.readArchiveWithInferredMimetype=function(t,i,r,s,o,e){var n,p;null!=e&&""!=e?this.readArchive(t,p,e,i,r,o,s):(n=this,p=i.size,ze.App.inferArchiveMimetypeFromMagicBlobAsync(i,function(e){n.readArchive(t,p,e,i,r,o,s)},function(e){logImpression("error_inferring_mimetype","misc",e),n.readArchive(t,p,null,i,r,o,s)}))},ze.App.prototype.createNewZipFromFile=function(e,t,i,r){var s=null,s=r&&ze.App.isExportableGoogleDocsMimeType(r)?"Google Docs":ze.App.getFileExtension(e).toUpperCase();this.mainAppSubTitle.textContent="Create ZIP file from "+s+" file",logImpression("create_new_zip_from_file","create_zip",s),this.createZipFromFileAssociatedExtension=s,ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.doCreateNewZipFromFile,this,e,t,i,r))},ze.App.prototype.doCreateNewZipFromFile=function(e,t,i,r){logImpression("create_new_zip_from_file","create_zip","init + lib_loaded");var s=ze.App.getZipExtractorCreateZipCommentString(),o=e+".zip",s=zeZipWriter.createEmptyZipBlob(s);this.zipFilenameInput.value=o,this.fileTableHeaderLabel.textContent=o;t={filename:ze.App.sanitizeDriveFilename(e),uncompressedFileBlob:t,mimeType:r};this.wasZipFileCreatedLocallyOrEdited=!0,this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.isInZipEditMode=!0,this.readArchive(o,s.size,ze.App.CANONICAL_MIME_TYPES.ZIP,s,void 0,bindFn(this.addManualItemToEmptyZip,this,s,[t],i,r))},ze.App.prototype.addManualItemToEmptyZip=function(e,t,i,r){this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1,this.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP,!1,void 0,!0),zeZipWriter.serializeZipFromEntries([],e,t,bindFn(this.renderCreatedZip,this,!1,i,t[0].name,!1,!1,1,void 0,!0,bindFn(this.maybeAddAdditionalFilesToNewlyCreatedZip,this)),bindFn(this.handleZipWriteError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipWriteError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,void 0,void 0,this.currentAutodetectedEncoding)},ze.App.prototype.maybeAddAdditionalFilesToNewlyCreatedZip=function(){console.log("In: maybeAddAdditionalFilesToNewlyCreatedZip");var e=[],t=STATE&&STATE.ids&&0<STATE.ids.length;if(STATE&&STATE.ids&&1<STATE.ids.length)for(var i=1;i<STATE.ids.length;i++){var r={};r.id=STATE.ids[i],r.needsMetadata=!0,e.push(r)}t=t?0:1;if(STATE&&STATE.exportIds&&STATE.exportIds.length>t)for(var s=t;s<STATE.exportIds.length;s++){var o={};o.id=STATE.exportIds[s],o.needsMetadata=!0,e.push(o)}0<e.length&&(logImpression("add_files_from_drive_multi_open_with","create_zip","start. count: "+e.length),this.doAddFileOrFileStubToZipFromDrive(e,0,1,!0))},ze.App.prototype.createNewEmptyZip=function(e,t,i){this.sessionPropMap[ze.App.SESS_PROP.DIDCREATENEWEMPTYZIP]=!0,this.closeSession(),this.wasZipFileCreatedLocallyOrEdited=!0,this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.doCreateNewEmptyZip,this,e,t,i))},ze.App.prototype.doCreateNewEmptyZip=function(e,t,i){this.setAppState(ze.App.APP_STATE.CREATING_NEW_ZIP);var r=ze.App.getZipExtractorCreateZipCommentString(i),i=zeZipWriter.createEmptyZipBlob(r,i);this.isInZipEditMode=!0;var s=this;this.readArchive(e||ze.App.DEFAULT_ZIP_FILENAME,i.size,ze.App.CANONICAL_MIME_TYPES.ZIP,i,void 0,function(){s.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP,!1,void 0,!0),s.updateButtonEnablementAfterZipEntryTreeRender(),t&&t()})},ze.App.prototype.addFilesToZip=function(e,t,i,r,s,o,n){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.doAddFilesToZip,this,e,t,i,r,s,o,n))},ze.App.prototype.doAddFilesToZip=function(e,t,i,r,s,o,n){if(null!=this.zipEntryTree){this.zipHasAtLeastOneEntry()?logImpression("create_zip_add_entries","create_zip","num_files_to_add: "+e.length):logImpression("create_zip_start_new","create_zip","num_files_to_add: "+e.length),this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP,s,n),this.addFilesToZipOrEncryptZipCancelRequested=!1;for(var p=[],a=0;a<e.length;a++){var l,h=e[a],d=h.fullPath||h.webkitRelativePath||h.relativePath||h.name,E=r?d:ze.App.sanitizeDriveFilename(d);null==this.zipEntryTree.children[E]&&(l=!!h.isDirectory,d=ze.App.getFileExtension(E).toLowerCase(),ze.App.isSystemFile(E,d,l)?console.log("skipping adding system file: ",E):(l={filename:E,lastModDate:h.lastModifiedDate,uncompressedFileBlob:l?null:h,directory:l},p.push(l)))}n=this.zipIsEmpty();o&&(""!=this.zipFilenameInput.value&&this.zipFilenameInput.value!=ze.App.DEFAULT_ZIP_FILENAME||(this.zipFilenameInput.value=o.trim(),this.zipFilename=this.zipFilenameInput.value)),zeZipWriter.serializeZipFromEntries(this.zipEntryTree.originalEntries,this.zipBlob,p,bindFn(this.renderCreatedZip,this,!1,null,null,!1,t,p.length,void 0,n,i),bindFn(this.handleZipWriteError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipWriteError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,this.zipEntryTree.encryptionMode,this.getZipPasswordCharCodeByteArray(),this.currentAutodetectedEncoding,this.zipEntryTree.isZip64)}},ze.App.prototype.checkAndHandleCreateOrEncryptZipFileCancelled=function(e){return!!this.addFilesToZipOrEncryptZipCancelRequested&&(e("Adding files to ZIP canceled",!0),!0)},ze.App.prototype.renderCreatedZip=function(e,t,i,r,s,o,n,p,a,l){logImpression("create_zip_success","create_zip"),this.numFilesRecentlyAdded=o,this.numFilesRecentlyRemoved=n;a=bindFn(this.handlePostCreatedZipRenderActions,this,e,t,i,r,a);this.setAppState(ze.App.APP_STATE.FILES_ADDED_TO_ZIP,l,a,r,p),s||this.setAppState(ze.App.APP_STATE.ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE,r,o,n,p),this.zipIsDirty=!0},ze.App.prototype.updateButtonEnablementAfterZipEntryTreeRender=function(){var e=this.zipHasAtLeastOneEntry();this.enableEl(this.extractButton,e)},ze.App.prototype.zipHasAtLeastOneEntry=function(){return!(!this.zipEntryTree||!this.zipEntryTree.originalEntries)&&0<this.zipEntryTree.originalEntries.length},ze.App.prototype.zipIsEmpty=function(){return!this.zipEntryTree||!this.zipEntryTree.originalEntries||0==this.zipEntryTree.originalEntries.length},ze.App.prototype.zipHasExactlyOneEntry=function(){return!(!this.zipEntryTree||!this.zipEntryTree.originalEntries)&&1==this.zipEntryTree.originalEntries.length},ze.App.prototype.handlePostCreatedZipRenderActions=function(e,t,i,r,s){var o;t&&(o="Created ZIP file",i&&(o+=" from "+i),this.updateLabelsAndProgress(o),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS)),this.updateButtonEnablementAfterZipEntryTreeRender(),this.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP,!1,void 0,!0),t&&this.zipHasExactlyOneEntry()&&(this.zipEntryTree.originalEntries[0].driveFileId=t),e&&this.zipHasAtLeastOneEntry()&&this.previewEntry(this.zipEntryTree.originalEntries[0],!0),r&&(this.updateLabelsAndProgress("Password set. Editing ZIP file"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.LOCKED)),s&&s()},ze.App.prototype.refreshZipEntryTreeIconsFromCurrentState=function(e,t,i){this.refreshZipEntryTreeItemState(void 0,e,t,i)},ze.App.prototype.refreshZipEntryTreeItemState=function(e,t,i,r){this.updateZipEntryTreeEntriesStateRecursive(e,t,i,r)},ze.App.prototype.refreshZipEntryMissingDiskStatusFromCurrentState=function(e,t){var i=this.numExtraZipParts,r=this.zipPartsLoadedMask;if(this.zipEntryTree.originalEntries)for(var s=0;s<this.zipEntryTree.originalEntries.length;s++){var o,n,p=this.zipEntryTree.originalEntries[s];p.state==ze.App.ESTATE.ENTRY_DISK_MISSING&&(o=!1,0<i&&(null!=(n=p.diskNumberStart)&&n!=i&&1!=r[n]&&(o=!0)),o||(this.updateEntryState(p,ze.App.ESTATE.DEFAULT,void 0,void 0,!0),ze.App.updateEntryRowStyle(p,!0)))}},ze.App.prototype.maybeRemoveEntryFromZipInEditMode=function(e){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.doMaybeRemoveEntryFromZipInEditMode,this,e))},ze.App.prototype.doMaybeRemoveEntryFromZipInEditMode=function(e){var t;this.isSavingToDrive||this.isCurrentlyInJumpToZipOperation||this.appState!=ze.App.APP_STATE.ADDING_FILES_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED&&this.appState!=ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP&&(!this.isInZipEditMode||-1!=(e=(t=this.zipEntryTree.originalEntries).indexOf(e))&&(t.splice(e,1),this.updateAndReserializeZipWithEntries(t,1)))},ze.App.prototype.handleRootStatusIconClick=function(e){this.isInZipEditMode&&"delete_sweep"==e.target.textContent&&this.zipEntryTree&&this.zipEntryTree.originalEntries&&(0<(e=this.zipEntryTree.originalEntries.length)&&(confirm("Are you sure you want to remove "+(1==e?"one item":"all "+e+" items")+" from this ZIP file?")&&this.updateAndReserializeZipWithEntries([],e)))},ze.App.prototype.reserializeCurrentZipEntryTreeAsNewZip=function(){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPWRITER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPWRITER_SCRIPT_NAME,bindFn(this.updateAndReserializeZipWithEntries,this))},ze.App.prototype.updateAndReserializeZipWithEntries=function(e,t){this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=t||0,this.zipIsDirty=!0;var i=this.zipEntryTree.isEncrypted,r=this.zipEntryTree.encryptionMode,s=null==e?this.zipEntryTree.originalEntries:e,e=this.zipEntryTree.isEncrypted?bindFn(this.handleZipEncryptError,this):bindFn(this.handleZipWriteError,this),o=this;zeZipWriter.serializeZipFromEntries(s,this.zipBlob,[],bindFn(this.renderCreatedZip,this,!1,null,null,!1,!1,void 0,t,!1,function(){o.zipEntryTree&&(o.zipEntryTree.isEncrypted=i,o.zipEntryTree.encryptionMode=r,i&&o.refreshZipTableBannerHeading(),o.showEl(o.addPasswordButton,!1))}),e,bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipEncryptError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,this.zipEntryTree.encryptionMode,this.getZipPasswordCharCodeByteArray(),this.currentAutodetectedEncoding,this.zipEntryTree.isZip64)},ze.App.prototype.canResetZip=function(){return this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE||this.appState==ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS||this.appState==ze.App.APP_STATE.EXTRACTION_CANCELED},ze.App.prototype.resetZipAsync=function(t,e,i){var r=this.zipFilename,s=this.zipBlob,o=this.zipFileSize,n=this.parentFolderId,p=this.zipParentId,a=this.previousZipBlobs,l=this.previousZipFilenames,h=null;e||(h=this.currentAutodetectedEncoding);e=null;this.appState!=ze.App.APP_STATE.PASSWORD_REQUIRED&&(e=this.zipPasswordInput.value),this.closeSession(),this.parentFolderId=n,this.zipParentId=p,this.previousZipBlobs=a,this.previousZipFilenames=l,h&&(this.currentAutodetectedEncoding=h);var d=!1;e&&(d=!0,this.zipPasswordInput.value=e,this.enableEl(this.checkPasswordButton,!0),this.enableEl(this.zipPasswordInput,!0),e=""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.updateDownloadingFilename(r,s.size),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="downloading",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0);var E=this;this.readArchive(r,o,void 0,s,void 0,function(e){e&&(d&&(E.zipEntryTree.isEncrypted=!1,E.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED),E.refreshZipTableBannerHeading()),t&&E.configureZipEditMode(),i&&i())},this.getZipPasswordCharCodeByteArray())},ze.App.prototype.handleZipWriteError=function(e,t){t?(logImpression("write_zip_canceled","write_zip"),this.setAppState(ze.App.APP_STATE.ZIP_WRITE_CANCELLED)):(logImpression("write_zip_error","write_zip","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_WRITE_ERROR,e)),this.showEl(this.doneButton,!0),this.doneButton.focus()},ze.App.prototype.handleZipEncryptError=function(e,t){t?(this.setAppState(ze.App.APP_STATE.ZIP_ENCRYPTION_CANCELLED),logImpression("encrypt_zip_canceled","encrypt_zip")):(this.setAppState(ze.App.APP_STATE.ZIP_ENCRYPTION_ERROR,e),logImpression("encrypt_zip_error","encrypt_zip","error: "+e)),this.showEl(this.doneButton,!0),this.doneButton.focus()},ze.App.prototype.handleZipCreateOrEncryptProgress=function(e,t){this.handleGenericMainProgress(e,t)},ze.App.prototype.previewEntry=function(e,t,i){if(this.appState==ze.App.APP_STATE.PASSWORD_REQUIRED&&this.isElementShown(this.checkPasswordButton)){var r=0<this.zipPasswordInput.value.length?this.checkPasswordButton:this.zipPasswordInput;this.flashElement(r,"#d00000",2,100)}else if(this.appState==ze.App.APP_STATE.PASSWORD_INCORRECT&&this.isElementShown(this.zipPasswordInput))this.flashElement(this.zipPasswordInput,"#d00000",2,100);else if(this.appState!=ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED&&this.areAllStatesTerminal()&&!this.isSavingToDrive&&!this.isCurrentlyInJumpToZipOperation&&this.appState!=ze.App.APP_STATE.CHECKING_PASSWORD&&this.appState!=ze.App.APP_STATE.ADDING_FILES_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED&&this.appState!=ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP&&(this.isSessionAbortedForThePurposesOfPreview=!1,this.wasArchiveDecompressionProcessCancelled=!1,!e.directory)){if(e.error&&e.state!=ze.App.ESTATE.CANCELED&&e.state!=ze.App.ESTATE.UPLOAD_ABORTED&&e.state!=ze.App.ESTATE.DECOMPRESSION_CANCELED)return this.previewedEntry=e,this.configurePreviewForDisplay(e),void this.renderErrorPreview(e,e.error,e.message);if(0==e.uncompressedSize)return this.previewedEntry=e,this.configurePreviewForDisplay(e),void this.renderErrorPreview(e,"Cannot preview empty file (file size is 0 bytes)");if(e.state!=ze.App.ESTATE.ENTRY_DISK_MISSING){logImpression("preview_item","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDPREVIEW]=!0;var s=ze.App.getFileExtension(e.name).toLowerCase(),o=!0,n=null,p="";if(ze.App.isSystemFile(e.name,s,e.directory))p="nopreview-"+s,o=!1,n=bindFn(this.renderGenericPreview,this);else if(e.forcePreviewInDrive)p="drive-"+s,o=!1,n=bindFn(this.renderDrivePreview,this);else if(ze.App.isHiddenTextViewableDotFile(e.name,s))p="text-"+s,n=bindFn(this.renderTextPreview,this);else if(""===s)p="text-"+s,n=bindFn(this.renderTextPreview,this);else{var a=ze.App.getTypesMapKeyNameByExtension(s),r=ze.App.getPreviewableState(a,s);if(2==r)"pdf"==a?(p="pdf",n=bindFn(this.renderPdfPreview,this)):"archive"==a?(p="archive-"+s,i||(n=bindFn(this.renderArchivePreview,this),o=!1)):ze.App.isTextFileType(e.name,a)?(p="text-"+s,n=bindFn(this.renderTextPreview,this)):"image"==a?(p="image-"+s,n=bindFn(this.renderImagePreview,this)):"video"==a?(p="video-"+s,n=bindFn(this.renderVideoPreview,this)):"audio"==a&&(p="audio-"+s,n=bindFn(this.renderAudioPreview,this));else if(3==r)p="drive-"+s,o=!1,n=bindFn(this.renderDrivePreview,this);else{if(t)return;p="generic-"+s,o=!1,n=bindFn(this.renderGenericPreview,this)}}this.previewType=p,logImpression("preview_render","preview","renderer="+p),n?(this.configurePreviewForDisplay(e),this.previewedEntry=e,o?this.decompressPreviewedBlob(e,bindFn(this.previewReadyForRender,this,n,e,!1),bindFn(this.previewDecompressionErrorOrCancel,this,e),bindFn(this.previewDecompressionProgressFunction,this,e,!0),bindFn(this.generalDecompressionCheckCancelFn,this)):this.previewReadyForRender(n,e,!1)):ze.App.startsWith(this.previewType,"archive")&&(this.isInZipEditMode||this.openEmbeddedArchive(e))}else{this.previewedEntry=e,this.configurePreviewForDisplay(e);n=e.diskNumberStart<=8?".z0"+(e.diskNumberStart+1):".z"+(e.diskNumberStart+1);this.renderErrorPreview(e,"Missing the ZIP part for this entry: "+ze.App.getBaseFilenameNoExtension(this.zipFilename)+n)}}},ze.App.prototype.configurePreviewForDisplay=function(e){this.configurePreviewHeader(e),this.configurePreviewForLoading(e),this.showEl(this.zipTable,!1),this.showEl(this.preview,!0)},ze.App.prototype.getZipPasswordCharCodeByteArray=function(){var e=[];try{for(var t=ze.App.isForTesting()?ze.App.getTestingPassword():this.zipPasswordInput.value,i=0;i<t.length;i++)e.push(255&t.charCodeAt(i))}catch(e){}return e},ze.App.prototype.jumpToZipSuccess=function(e,t){this.isCurrentlyInJumpToZipOperation=!1;var i=this.previousZipBlobs,r=this.previousZipFilenames;this.closeSession(),this.closePreview(),this.previousZipBlobs=i,this.previousZipFilenames=r,this.readArchiveWithInferredMimetype(e.name,t),this.enableEl(this.previousZipButton,!0)},ze.App.prototype.jumpToZipErrorOrCancel=function(e,t,i){i?logImpression("jump_to_zip_canceled","zip"):logImpression("jump_to_zip_error","zip","error: "+t),this.isCurrentlyInJumpToZipOperation=!1,this.setProgressBarPercent(100),i?(this.showEl(this.extractButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.showEl(this.mainMoreActionsMouseDownButton,!0),this.updateLabelsForReadyToExtract()):(this.configurePreviewForDisplay(e),this.renderErrorPreview(e,t)),this.enableEl(this.previousZipButton,!0)},ze.App.prototype.previewDecompressionErrorOrCancel=function(e,t,i){var r=null!=e.compressionMethod?"Compression Method: "+e.compressionMethod+"; ":"";i?(logImpression("preview_render_canceled","preview"),logImpression(this.currentArchiveTypeString.toLowerCase(),"preview_decompress",r+"Canceled")):(logImpression("preview_render_error","preview","decompression error: "+t),logImpression(this.currentArchiveTypeString.toLowerCase(),"preview_decompress",r+"Error: "+t)),this.isPreviewDecompressing=!1,this.configurePreviewActionButtonsForWorkingOperation(!1),this.updatePreviewFilenameLabel(),i?(this.willSaveToDriveAfterDecompression||this.willDownloadAfterDecompression?this.setPreviewProgressBarPercent(0):this.closePreview(),this.wasPreviewDecompressionCancelled=!1,this.willDownloadAfterDecompression=!1,this.willSaveToDriveAfterDecompression=!1):(this.hideAllPreviewDivs(),this.renderErrorPreview(e,t))},ze.App.prototype.renderErrorPreview=function(e,t,i){this.showEl(this.previewErrorContent,!0),this.showEl(this.previewDownloadButton,!1),this.showEl(this.previewOpenEmbeddedArchiveButton,!1),this.showEl(this.previewCloseButton,!0),this.showEl(this.previewNextButton,!0),this.showEl(this.previewPrevButton,!0),this.showEl(this.previewOpenInDriveButton,!1),this.showEl(this.previewSaveToDriveButton,!1),this.enableEl(this.previewNextButton,!0),this.enableEl(this.previewPrevButton,!0),this.showEl(this.previewMoreActionsMouseDownButton,!1),this.setPreviewProgressBarPercent(100),this.previewErrorCaption.textContent="An error occurred when extracting this item from the "+this.currentArchiveTypeString+" file";e=i||e.message,t=e?t+" ("+e+")":t;this.previewErrorDetails.textContent=t},ze.App.prototype.getBlobMimeTypeByExtension=function(e){return null!=e&&""!==e&&ze.App.EXTENSION_TO_MIMETYPE_MAP[e]||""},ze.App.prototype.previewReadyForRender=function(e,t,i){this.updatePreviewFilenameLabel(),this.showEl(this.previewDownloadButton,!0),this.showEl(this.previewMoreActionsMouseDownButton,!0);var r=null!=t.driveFileId;this.configurePreviewActionButtonsForWorkingOperation(!1,!1,r),e(t,this.previewedBlob),i||this.handlePreviewRenderComplete()},ze.App.prototype.handlePreviewRenderComplete=function(){this.setPreviewProgressBarPercent(100)},ze.App.prototype.renderImagePreview=function(i,e){var r,t=window.URL||window.webkitURL,s=ze.App.getFileExtension(i.name),o=this;"svg"==s?((r=new FileReader).addEventListener("loadend",function(e){var t=r.result,t=(i.cachedObjectUrl=t).split(",")[1];o.previewImg.src="data:image/svg+xml;base64,"+t,o.showEl(o.previewImageContent,!0)}),r.readAsDataURL(e)):(e=t.createObjectURL(e),i.cachedObjectUrl=e,this.previewImg.src=e,this.showEl(this.previewImageContent,!0))},ze.App.prototype.renderTextPreview=function(r,e){var t=new FileReader,s=this;t.addEventListener("error",function(e){s.hideAllPreviewDivs();var t="",i="",i=e&&e.target&&e.target.error?(t=e.target.error.name,e.target.error.message):(t=e,"FileReader.readAsText() error");s.renderErrorPreview(r,t,i)}),t.addEventListener("loadend",function(e){var t,i;e&&e.target&&e.target.error||e&&e.srcElement&&e.srcElement.error||(t="",e.srcElement?t=e.srcElement.result:e.target&&(t=e.target.result),i=!1,e="",e=t&&2e4<t.length?(i=!0,t.substring(0,2e4)):t,s.previewTxt.textContent=e,s.showEl(s.previewTextContent,!0),s.previewTextContent.scrollTop=0,i&&ze.App.execLater(bindFn(s.handleSecondPhasePreviewTextLoad,s,t,r),void 0,500))});e=2097152<e.size?e.slice(0,2097152):e;t.readAsText(e)},ze.App.prototype.handleSecondPhasePreviewTextLoad=function(e,t){this.previewedEntry==t&&(t="",t=e&&524288<e.length?e.substring(0,524288)+"\n \n ------- PREVIEW TEXT WAS SHORTENED BY ZIP EXTRACTOR ------- ":e,this.previewTxt.textContent=t)},ze.App.prototype.renderPdfPreview=function(e,t){var i=window.URL||window.webkitURL,t=new Blob([t],{type:"application/pdf"}),t=i.createObjectURL(t);e.cachedObjectUrl=t,this.previewPdf.setAttribute("src",t),this.isPreviewPdfDirty=!0,this.previewPdf.title=e.name,this.showEl(this.previewPdfContent,!0)},ze.App.prototype.renderDrivePreview=function(e,t){e=e.driveFileId;null==e?(isAuthorized()?this.showEl(this.previewSaveToDriveDetails,!1):this.showEl(this.previewSaveToDriveDetails,!0),this.showEl(this.previewDriveContent,!0),this.showEl(this.previewDriveSaveToDriveFirst,!0),this.previewDrv&&this.showEl(this.previewDrv,!1),this.handlePreviewRenderComplete(),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0)):(this.showEl(this.previewDriveSaveToDriveFirst,!1),this.showEl(this.previewSaveToDriveDetails,!1),this.doEmbeddedDrivePreview(e),this.showEl(this.previewDriveContent,!0))},ze.App.prototype.doEmbeddedDrivePreview=function(e){this.showEl(this.previewSpinner,!0),this.showEl(this.previewItemIcon,!1),this.previewDrv?this.showEl(this.previewDrv,!0):(this.previewDrv=document.createElement("iframe"),this.previewDrv.className="previewDrv",this.previewDriveContent.appendChild(this.previewDrv)),this.previewDrv.onload=bindFn(this.previewDriveEmbeddedViewerLoaded,this);e="https://docs.google.com/file/d/"+e+"/preview?authuser="+CURRENT_AUTH_USER;this.previewDrv.setAttribute("src",e),this.isPreviewDrvDirty=!0},ze.App.prototype.previewDriveEmbeddedViewerLoaded=function(e){this.handlePreviewRenderComplete(),this.showEl(this.previewOpenInDriveButton,!0),this.showEl(this.previewSaveToDriveButton,!1),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0),this.previewDrv.onload=null},ze.App.prototype.renderVideoPreview=function(e,t){t=(window.URL||window.webkitURL).createObjectURL(t);e.cachedObjectUrl=t,this.previewVid.src=t,this.previewVid.title=e.name,this.showEl(this.previewVideoContent,!0)},ze.App.prototype.renderGenericPreview=function(e,t){this.noPreviewIcon.textContent=this.previewItemIconImg.textContent,this.showEl(this.previewGenericContent,!0)},ze.App.prototype.renderArchivePreview=function(e,t){this.showEl(this.previewArchiveContent,!0),this.showEl(this.previewOpenEmbeddedArchiveButton,!0)},ze.App.prototype.renderAudioPreview=function(e,t){t=(window.URL||window.webkitURL).createObjectURL(t);e.cachedObjectUrl=t,this.previewAud.src=t,this.previewAud.title=e.name,this.showEl(this.previewAudioContent,!0)},ze.App.prototype.configurePreviewHeader=function(e){if(this.previewItemFilename.textContent=e.name||"",this.updatePreviewFilenameLabel(),this.previewItemIconImg.textContent=ze.App.getMaterialIconIdForEntry(e),this.previewItemSize.textContent="("+ze.App.formatSize(e.uncompressedSize)+") ",e.lastModDate)try{var t=e.lastModDate.toLocaleDateString([],{dateStyle:"short"})+" "+e.lastModDate.toLocaleTimeString([],{timeStyle:"short"});this.previewItemSize.textContent+=t}catch(e){}var i=this.previewItemSize.textContent;this.previewItemFilename.innerHTML+=" <small>"+i+"</small>"},ze.App.prototype.configurePreviewForLoading=function(e){this.setPreviewProgressBarPercent(0)},ze.App.prototype.previewDecompressionProgressFunction=function(e,t,i,r){this.handleGenericPreviewProgress(i,r,t,"Decompressing...")},ze.App.prototype.hideAllPreviewDivs=function(){this.showEl(this.previewTextContent,!1),this.showEl(this.previewImageContent,!1),this.showEl(this.previewVideoContent,!1),this.showEl(this.previewPdfContent,!1),this.showEl(this.previewAudioContent,!1),this.showEl(this.previewGenericContent,!1),this.showEl(this.previewErrorContent,!1),this.showEl(this.previewDriveContent,!1),this.showEl(this.previewArchiveContent,!1)},ze.App.prototype.resetPreview=function(){if(this.hideAllPreviewDivs(),this.clearAllPreviewObjects(),this.previewedEntry&&this.previewedEntry.cachedObjectUrl){var e=window.URL||window.webkitURL;try{e.revokeObjectURL(this.previewedEntry.cachedObjectUrl)}catch(e){logImpression("revokeObjectURL()","misc",e)}}this.previewedEntry=null,this.previewedBlob=null,this.previewType=null},ze.App.prototype.clearAllPreviewObjects=function(){if(this.previewTxt.textContent="",this.previewImg.src="",this.previewDrv&&this.isPreviewDrvDirty)try{this.previewDrv.src="",this.previewDrv.removeAttribute("src");var e=this.previewDrv.cloneNode(!0);e.setAttribute("src",""),this.previewDrv.parentNode.replaceChild(e,this.previewDrv),this.previewDrv=e,this.isPreviewDrvDirty=!1}catch(e){console.error(e)}try{var t;this.isPreviewPdfDirty&&(this.previewPdf.src="",this.previewPdf.removeAttribute("src"),(t=this.previewPdf.cloneNode(!0)).setAttribute("src",""),this.previewPdf.parentNode.replaceChild(t,this.previewPdf),this.previewPdf=t),this.isPreviewPdfDirty=!1}catch(e){}try{this.previewAud.pause();try{0!==this.previewAud.currentTime&&(this.previewAud.currentTime=0)}catch(e){}this.previewAud.src="",this.previewAud.removeAttribute("src")}catch(e){}try{this.previewVid.pause();try{0!==this.previewVid.currentTime&&(this.previewVid.currentTime=0)}catch(e){}this.previewVid.src="",this.previewVid.removeAttribute("src")}catch(e){}},ze.App.prototype.flashTimer=null,ze.App.prototype.flashElement=function(e,t,i,r,s,o){clearTimeout(this.flashTimer);var n=null!=s?s:e.style.backgroundColor,p=o||0,a=this;e.style.backgroundColor=p%2==0?t:n,++p<2*i&&(a.flashTimer=setTimeout(bindFn(a.flashElement,a,e,t,i,r,n,p),r))},ze.App.INDENT_PX=24,ze.App.BASE_INDENT_PX=0,ze.App.checkboxIdCounter=0,ze.App.UNCHECKED_COLOR="#888",ze.App.clearTable=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},ze.App.disableCheckboxesForChildren=function(e){for(var t in e.children){var i=e.children[t];ze.App.getCheckboxButtonForEntry(i).disabled=!0,i.directory&&ze.App.disableCheckboxesForChildren(i)}},ze.App.generateZipTable=function(e,t,i,r,s){ze.App.execLater(bindFn(ze.App.generateZipTableInternal,null,e,t,r,s),i)},ze.App.generateZipTableInternal=function(e,t,i,r){ze.App.generateZipTableChildren(e,t,0,0,i,r);e=e.lastElementChild;e&&e.classList.add("lastZipTableRow")},ze.App.generateZipTableChildren=function(e,t,i,r,s,o){var n,p=MAINAPP.numExtraZipParts,a=MAINAPP.zipPartsLoadedMask;for(n in t.children){var l=t.children[n],h=ze.App.generateFileTableRow(l,i,s,o);l.tableRow=h,l.tableRowIndex=r++,e.appendChild(h),l.error&&(MAINAPP.updateEntryState(l,ze.App.ESTATE.PARSE_ERROR,l.error),ze.App.updateEntryRowStyle(l,!1)),0<p&&(null!=(h=l.diskNumberStart)&&h!=p&&1!=a[h]&&(MAINAPP.updateEntryState(l,ze.App.ESTATE.ENTRY_DISK_MISSING),ze.App.updateEntryRowStyle(l,!1))),l.directory&&(r=ze.App.generateZipTableChildren(e,l,i+1,r,s,o))}return r},ze.App.handleRowClick=function(e,t){var i="";t&&t.target&&t.target.className&&(i=t.target.className),i.indexOf&&-1==i.indexOf("button")&&(-1==i.indexOf("zipStatusIcon")?-1==i.indexOf("icon")&&-1==i.indexOf("statusCell")&&ze.App.previewEntry(e,!1,!0):"delete"==t.target.textContent&&ze.App.removeEntryFromZipInEditMode(e))},ze.App.removeEntryFromZipInEditMode=function(e){MAINAPP.maybeRemoveEntryFromZipInEditMode(e)},ze.App.openEntryInDrive=function(e){ze.App.openItemInDrive(e.driveFileId)},ze.App.openItemInDrive=function(e){e="https://drive.google.com/open?id="+e,e=window.open(e,"_blank");e&&e.focus()},ze.App.locateEntryInDrive=function(e,t){ze.App.locateItemInDrive(e.driveFileId,t)},ze.App.locateItemInDrive=function(e,t){t=ze.App.createDriveLocateLink(e,t),t=window.open(t,"_blank");t&&t.focus&&t.focus()},ze.App.previewEntry=function(e,t,i){MAINAPP.previewEntry(e,t,i)},ze.App.isEntryDownloadable=function(e){return!e.directory},ze.App.generateFileTableRow=function(e,t,i,r){var s=document.createElement("div");s.className=e.directory?"zipTableRow directoryRow":"zipTableRow",s.onclick=bindFn(ze.App.handleRowClick,this,e),s.entry=e;var o=document.createElement("div");s.appendChild(o),o.className=e.directory?"zipTableCell filenameCell directoryCell":"zipTableCell filenameCell";var n=document.createElement("div");s.appendChild(n),n.className="zipTableCell sizeCell";var p=document.createElement("div");s.appendChild(p),p.className="zipTableCell statusCell";var a=document.createElement("div");p.appendChild(a),a.className="statusCellIcon",a.hidden=!(i||r);var l=document.createElement("i");a.appendChild(l),l.className="material-icons zipStatusIcon",l.textContent="";l=ze.App.createSpinner();p.appendChild(l);l=ze.App.createMaterialCheckbox(!0);p.appendChild(l),l.hidden=i||r,l.onclick=bindFn(ze.App.handleCheckboxButtonClick,MAINAPP,l,e),o.style.paddingLeft=ze.App.BASE_INDENT_PX+ze.App.INDENT_PX*t+"px";l=document.createElement("div");l.className="tableRowName",l.textContent=e.name;t=document.createElement("i");return o.appendChild(t),t.className="material-icons tableRowIcon",t.tabIndex=-1,t.textContent=ze.App.getMaterialIconIdForEntry(e),o.appendChild(l),!e.directory&&(!e.error||void 0!==e.uncompressedSize&&null!==e.uncompressedSize)?n.textContent=ze.App.formatSize(e.uncompressedSize):n.textContent="",s},ze.App.createSpinner=function(){var e=document.createElement("img");e.className="newSpinnerImg",e.tabIndex=-1,e.src="images/spinner-44.gif";var t=document.createElement("div");return t.hidden=!0,t.className="newSpinnerDiv",t.appendChild(e),t},ze.App.createMaterialCheckbox=function(e,t){var i=document.createElement("button");i.className="ze-button ze-icon-button ze-button--colored zipEntryCheckboxButton",t&&(i.id=t);t=document.createElement("i");return t.className="material-icons ze-icon-button-icon ze-checkbox-button",i.appendChild(t),ze.App.setCheckboxIconButtonChecked(i,e),i},ze.App.getEntryStatusIconMaterialId=function(e,t,i,r){switch(e){case ze.App.ESTATE.DEFAULT:return i?"delete":t?"lock":"__";case ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE:case ze.App.ESTATE.ADDED_TO_ZIP:return i?"delete":t?"lock":"check_circle_outline";case ze.App.ESTATE.QUEUED:return r?"downloading":"cloud_queue";case ze.App.ESTATE.QUEUED_PENDING_RETRY:return"info_outline";case ze.App.ESTATE.REQUEUED_AFTER_ERROR:return r?"downloading":"cloud_queue";case ze.App.ESTATE.SKIPPED:return"not_interested";case ze.App.ESTATE.PARSE_ERROR:case ze.App.ESTATE.ENTRY_DISK_MISSING:return"warning";case ze.App.ESTATE.PENDING_UPLOAD:return"cloud_upload";case ze.App.ESTATE.PENDING_DOWNLOAD:return"file_download";case ze.App.ESTATE.WAITING:return r?"pending":"cloud";case ze.App.ESTATE.DECOMPRESSION_COMPLETE:return"filter_drama";case ze.App.ESTATE.BEGIN_UPLOAD:return"backup";case ze.App.ESTATE.UPLOAD_PROGRESS:return"cloud_upload";case ze.App.ESTATE.UPLOAD_ERROR:case ze.App.ESTATE.DECOMPRESSION_ERROR:return"warning";case ze.App.ESTATE.DECOMPRESSION_CANCELED:return"error_outline";case ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED:return"cached";case ze.App.ESTATE.UPLOAD_COMPLETE:return r?"file_download_done":"cloud_done";case ze.App.ESTATE.DOWNLOAD_COMPLETE:return"file_download_done";case ze.App.ESTATE.CANCELED:case ze.App.ESTATE.UPLOAD_ABORTED:return"error_outline";default:return console.log("DEFAULT STATE",e),"help_outline"}},ze.App.SIZE_BYTE_UNITS=["KB","MB","GB","TB"],ze.App.formatSize=function(e){if(null==e)return"? KB";if(0===e)return"0 KB";if(e<1e3)return e.toString()+" B";for(var t=0;e/=1024,t++,1024<e;);var i=Math.max(e,.1),i=1===t?Math.ceil(i):Math.round(i*Math.pow(10,1))/Math.pow(10,1);return i+" "+ze.App.SIZE_BYTE_UNITS[t-1]},ze.App.TYPES_MAP={image:{"*":"photo",bmp:2,jpg:2,jpeg:2,gif:2,png:2,webp:2,tif:3,tiff:3,svg:3,ico:2,heic:3,heif:3,raw:3,cr2:3,cr3:3,crw:3,nef:3,nrw:3,arw:3,srf:3,sr2:3,rw2:3,dcr:3,k25:3,kdc:3},text:{"*":"description",txt:2,rtf:2,htm:2,html:2,mhtml:2,mxml:2,xml:2,log:2,tex:2,cls:2,bak:2,rels:2,bat:2,stp:2,ini:2,inf:2,mbox:2,msg:2,lic:2,eml:2,text:2,latex:2,conf:2,smi:2,sub:2,srt:2,asc:2,lst:2,bas:2,reg:2,manifest:2,ascii:2,yml:2,eng:2,xsl:2,xslt:2,enc:2,ps1:2,ino:2,url:2,vcf:2,aux:2,toc:2,properties:2,cfg:2,sys:2,cnf:2,prefs:2},code:{"*":"code",c:2,h:2,m:2,md:2,cc:2,cs:2,pl:2,pm:2,rb:2,sh:2,ts:2,tsx:2,js:2,css:2,scss:2,java:2,py:2,cpp:2,hpp:2,php:2,perl:2,ipynb:2,asp:2,aspx:2,jsp:2,json:2,yaml:2,bsh:2,csh:2,cyc:2,cv:2},csv:{"*":"grid_on",csv:2,tsv:2},video:{"*":"videocam",mp4:2,ogv:2,mpg:2,mpeg:2,mov:2,webm:2,m4v:2,mkv:2,"3gp":3,wmv:1,avi:3,flv:3},audio:{"*":"audiotrack",mp3:2,m4a:2,wav:2,flac:2,aac:2,mid:2,ogg:2,oga:2,opus:2,weba:2,aif:1,aiff:1},font:{"*":"font_download",ttf:3,otf:3},pdf:{"*":"picture_as_pdf",pdf:2,xps:3},drawing:{"*":"category",dwg:3,odg:3,eps:3,psd:3,ps:3,ai:3,dxf:3},archive:{"*":"business_center",zip:2,zipx:2,gz:2,whl:2,jar:2,tar:2,tgz:2,rar:2,bzip:2,bzip2:2,bz2:2,tbz:2,tbz2:2,lzma:2,tlz:2,lz:2,xz:2,txz:2,"7z":2},office:{"*":"assignment",ppt:3,pptx:3,pot:3,potx:3,potm:3,pps:3,ppsx:3,ppsm:3,pptm:3,thmx:1,doc:3,docm:3,docx:3,dot:3,dotx:3,dotm:3,xls:3,xlsx:3,xlt:3,xltx:3,xlsm:3,xltm:3,xlsb:1,xlam:1,xla:1,slk:1,odt:3,ods:3,odp:3},executable:{"*":"dns",exe:1,dll:1}},ze.App.TYPES_MAP_KEYS=Object.keys(ze.App.TYPES_MAP),ze.App.getMaterialIconIdForEntry=function(e){if(e.directory)return"folder";var t=e.name;if(!t)return"error_outline";t=ze.App.getFileExtension(t);if(ze.App.startsWith(e.name,"._")||!t||""===t)return"insert_drive_file";t=ze.App.getTypesMapEntryByExtension(t);return null!=t?t["*"]:"insert_drive_file"},ze.App.getPreviewableState=function(e,t){e=ze.App.getTypesMapEntryByKeyName(e);return null!=e?e[t]:null},ze.App.getTypesMapEntryByKeyName=function(e){return null!=e?ze.App.TYPES_MAP[e]:null},ze.App.getTypesMapEntryByExtension=function(e){e=ze.App.getTypesMapKeyNameByExtension(e);return ze.App.getTypesMapEntryByKeyName(e)},ze.App.getTypesMapKeyNameByExtension=function(e){for(var t=0;t<ze.App.TYPES_MAP_KEYS.length;t++)if(null!=ze.App.TYPES_MAP[ze.App.TYPES_MAP_KEYS[t]][e])return ze.App.TYPES_MAP_KEYS[t];return null},ze.App.setEntryChecked=function(e,t,i){var r;e.root?ze.App.setCheckboxIconButtonChecked(MAINAPP.selectAllCheckbox,t,i):(r=ze.App.getCheckboxButtonForEntry(e),ze.App.setCheckboxIconButtonChecked(r,t,i),ze.App.updateEntryRowStyle(e,t,i))},ze.App.setCheckboxIconButtonChecked=function(e,t,i){e.firstElementChild.textContent=t?i?"indeterminate_check_box":"check_box":"check_box_outline_blank"},ze.App.isCheckboxIconButtonChecked=function(e,t,i){var r="i"==e.tagName.toLowerCase()?e:e.firstElementChild,e="indeterminate_check_box"==r.textContent,r="check_box"==r.textContent;return t?r:!i&&r||e},ze.App.updateEntryRowStyle=function(e,t,i){e.tableRow.style.color=t?"inherit":ze.App.UNCHECKED_COLOR;t=!(e.state==ze.App.ESTATE.PARSE_ERROR)&&!t;this.getFilenameCell(e).style.textDecoration=t?"line-through":"inherit"},ze.App.getChildEntriesAggregateCheckState=function(e,t){for(var i in e.children){var r=e.children[i],s=ze.App.isChecked(r)?"checked":"unchecked";if(t){if(t!=s)return"indeterminate"}else t=s;if(r.directory)if(ze.App.getChildEntriesAggregateCheckState(r,t)!=t)return"indeterminate"}return t},ze.App.handleCheckboxButtonClick=function(e,t,i){ze.App.doUpdateCheckboxButtons(e,t,i),MAINAPP.updateExtractButtonEnablement()},ze.App.prototype.updateExtractButtonEnablement=function(){var e=ze.App.isCheckboxIconButtonChecked(MAINAPP.selectAllCheckbox),t=this.zipHasAtLeastOneEntry();this.enableEl(MAINAPP.extractButton,e&&t)},ze.App.doUpdateCheckboxButtons=function(e,t,i){var r=i.target==MAINAPP.selectAllCheckbox||i.target.parentElement==MAINAPP.selectAllCheckbox;r&&(e=MAINAPP.selectAllCheckbox,t=MAINAPP.zipEntryTree),ze.App.isClickEventFromKeyboard(i)||e.blur();var s=ze.App.isCheckboxIconButtonChecked(e,!0),i=!ze.App.isCheckboxIconButtonChecked(e),i=!r&&(t.directory&&i);ze.App.setCheckboxIconButtonChecked(e,!s,i);s=!s;if(!s&&t.directory?ze.App.setChildEntriesCheckState(t,!1):s&&!i&&t.directory&&ze.App.setChildEntriesCheckState(t,!0),!r){ze.App.updateEntryRowStyle(t,s,i);for(var o=t.parentEntry;null!=o;){var n=ze.App.getChildEntriesAggregateCheckState(o,null);if("indeterminate"==n)return void ze.App.setEntryAndParentEntriesCheckState(o,!0,!0);n="checked"==n;ze.App.setEntryChecked(o,n,!1),o=o.parentEntry}}},ze.App.setChildEntriesCheckState=function(e,t){for(var i in e.children){var r=e.children[i];r.error||ze.App.setEntryChecked(r,t),r.directory&&ze.App.setChildEntriesCheckState(r,t)}},ze.App.setEntryAndParentEntriesCheckState=function(e,t,i){e&&(ze.App.setEntryChecked(e,t,i),ze.App.setEntryAndParentEntriesCheckState(e.parentEntry,t,i))},ze.App.getCheckboxButtonForEntry=function(e){return e.tableRow.children[2].children[2]},ze.App.isChecked=function(e){return ze.App.isCheckboxIconButtonChecked(ze.App.getCheckboxButtonForEntry(e))},ze.App.translateEntryState=function(e,t,i){switch(e){case ze.App.ESTATE.QUEUED:return"Queued";case ze.App.ESTATE.QUEUED_PENDING_RETRY:return"Queued (Pending resolution of error on parent folder)";case ze.App.ESTATE.SKIPPED:return"Skipped";case ze.App.ESTATE.PARSE_ERROR:return"Parse Error";case ze.App.ESTATE.ENTRY_DISK_MISSING:return"Entry Disk Missing";case ze.App.ESTATE.PENDING_UPLOAD:return"Pending creation of parent folder";case ze.App.ESTATE.PENDING_DOWNLOAD:return"Pending download";case ze.App.ESTATE.WAITING:return"Waiting";case ze.App.ESTATE.BEGIN_DECOMPRESSION:case ze.App.ESTATE.DECOMPRESSION_PROGRESS:return"Decompressing File...";case ze.App.ESTATE.DECOMPRESSION_COMPLETE:return"Decompressed File";case ze.App.ESTATE.BEGIN_UPLOAD:case ze.App.ESTATE.UPLOAD_PROGRESS:return"Extracting to Google Drive...";case ze.App.ESTATE.UPLOAD_ERROR:return"Extraction to Drive Error ("+t.message+")";case ze.App.ESTATE.DECOMPRESSION_ERROR:return"Decompression Error ("+t.message+")";case ze.App.ESTATE.DECOMPRESSION_CANCELED:return"Decompression Canceled";case ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED:return"Finishing...";case ze.App.ESTATE.UPLOAD_COMPLETE:return i?"Downloaded to your computer":"Extracted to Google Drive";case ze.App.ESTATE.DOWNLOAD_COMPLETE:return"Downloaded to your computer";case ze.App.ESTATE.CANCELED:return"Canceled";case ze.App.ESTATE.UPLOAD_ABORTED:return"Aborted";default:return""}},ze.App.getFilenameCell=function(e){return e.tableRow.children[0].children[1]},ze.App.getIconCell=function(e){return e.tableRow.children[0].children[0]},ze.App.prototype.executeSession=function(e,t,i){var r;e&&(this.sessionHasBeenRetried=!0),this.isPreviewDecompressing=!1,this.wasPreviewDecompressionCancelled=!1,this.isSessionAborted=!1,this.isSessionAbortedForThePurposesOfPreview=!1,this.highestZipEntryIndexUploadedInSession=0,this.fileTableContainer.scrollTop=0,i?(r=t?ze.App.ESTATE.DOWNLOAD_COMPLETE:ze.App.ESTATE.UPLOAD_COMPLETE,this.updateEntryState(this.zipEntryTree,r,void 0,void 0,void 0,void 0,t)):this.queueEntry(this.zipEntryTree,t),this.queueEntryChildren(this.zipEntryTree,t),this.currentSessionProgress=0,this.totalSessionSize=ze.App.computeSessionSize(this.zipEntryTree),this.updateSecondaryProgressString(void 0,t,i),this.asyncWorkQueue=new ze.AsyncWorkQueue(ze.App.MAX_WORKQUEUE_WORKERS),ze.App.entryIsUploadable(this.zipEntryTree)&&!i?(this.asyncWorkQueue.enqueue(this.generateWorkItem(this.zipEntryTree,this.parentFolderId,t,i)),r=t?ze.App.ESTATE.PENDING_DOWNLOAD:ze.App.ESTATE.PENDING_UPLOAD,this.updateEntryState(this.zipEntryTree,r),this.runWorkQueue(t)):(i=i?this.parentFolderId:this.zipEntryTree.driveFileId,this.processEntryTreeChildren(this.zipEntryTree,i,e,t))},ze.App.prototype.abortSession=function(e){this.isSessionAborted=!0,this.isSessionAbortedForThePurposesOfPreview=!0,this.asyncWorkQueue.stop(),this.abortedSessionWasForDownloadAllToLocal=e,ze.Dapi.abortAllRequests(),this.cancelAllUnstartedEntries(),this.checkForExtractionComplete(e)},ze.App.prototype.isZipDirty=function(){return this.zipIsDirty},ze.App.prototype.closeSession=function(){this.isSessionClosed,ze.App.resetPageTitle(),this.asyncWorkQueue.close(),this.zipEntryStateMap={},this.zipEntriesInProcessMap={},this.totalSessionSize=0,this.currentSessionProgress=0,this.isSessionClosed=!0,this.highestZipEntryIndexUploadedInSession=0,this.isInZipEditMode=!1,this.wasZipFileCreatedLocallyOrEdited=!1,this.zipFilename=null,this.zipFileSize=null,this.zipMimeType=null,this.isTarFile=!1,this.extraZipPartsMap={},this.numExtraZipParts=0,this.zipPartsLoadedMask=[],this.errorCounter=0,this.previousZipBlobs=[],this.previousZipFilenames=[],this.zipEntryTree=null,this.zipBlob=null,this.zipDriveFileId=null,this.zipIsDirty=!1,this.zipBlobSource=null,this.currentArchiveHeaderIsEncrypted=!1,this.lastDownloadId=null,this.hasDownloadBeenAutoRetried=!1,this.isSessionAborted=!1,this.abortedSessionWasForDownloadAllToLocal=!1,this.fileIdToOpen=null,this.parentFolderId=null,this.zipParentId=null,this.isSavingToDrive=!1,this.wasSaveToDriveCancelled=!1,this.wasArchiveDecompressionProcessCancelled=!1,this.wasCheckPasswordCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.willDownloadAfterDecompression=!1,this.isPreviewDecompressing=!1,this.isCurrentlyInJumpToZipOperation=!1,this.wasPreviewDecompressionCancelled=!1,this.addFilesToZipOrEncryptZipCancelRequested=!1,this.isPreviewPdfDirty=!1,this.isPreviewDrvDirty=!1,this.currentExtractionLocation=ze.App.DEFAULT_DRIVE_EXTRACTION_LOCATION,this.skipCreateParentFolderForSession=!1,this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=null,this.cachedMistypedZipImageUri&&(this.fileTableAlternateImageImg.src=""),this.cachedMistypedZipImageUri=null,this.setResumeFlags(!1,!1,!1,!1,!1,!1),this.createZipFromFileAssociatedExtension=null,this.currentAutodetectedEncoding=null,clearState(),ze.App.clearTable(this.fileTableItems),this.startNewManualSession()},ze.App.prototype.processEntryTreeChildren=function(e,t,i,r){for(var s in e.children){var o,n=e.children[s];this.isSessionAborted?this.updateEntryState(n,ze.App.ESTATE.CANCELED):ze.App.entryIsUploadable(n)?(this.asyncWorkQueue.enqueue(this.generateWorkItem(n,t,r)),o=r?ze.App.ESTATE.PENDING_DOWNLOAD:ze.App.ESTATE.PENDING_UPLOAD,this.updateEntryState(n,o,void 0,void 0,void 0,void 0,r)):(n.directory&&n.state==ze.App.ESTATE.UPLOAD_COMPLETE||n.directory&&n.state==ze.App.ESTATE.DOWNLOAD_COMPLETE)&&this.processEntryTreeChildren(n,n.folder.id,i,r)}this.isSessionAborted||this.runWorkQueue(r)},ze.App.computeSessionSize=function(e){return ze.App.getEntrySize(e)+ze.App.computeChildEntriesSize(e)},ze.App.computeChildEntriesSize=function(e){var t,i=0;for(t in e.children){var r=e.children[t];i+=ze.App.getEntrySize(r)+(r.directory?ze.App.computeChildEntriesSize(r):0)}return i},ze.App.getEntrySize=function(e){if(ze.App.entryIsUploadable(e))return(e.directory?0:null==e.uncompressedSize?2*e.compressedSize:e.uncompressedSize)+ze.App.ENTRY_OVERHEAD_BYTES;return 0},ze.App.prototype.queueEntry=function(e,t){var i=this.isTableEntrySelected(e),r="";e.state==ze.App.ESTATE.DEFAULT||e.state==ze.App.ESTATE.CANCELED||e.state==ze.App.ESTATE.DECOMPRESSION_CANCELED||e.state==ze.App.ESTATE.UPLOAD_ABORTED||e.state==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE||e.state==ze.App.ESTATE.ADDED_TO_ZIP?(r=i?ze.App.ESTATE.QUEUED:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,r,void 0,void 0,void 0,void 0,t)):e.state==ze.App.ESTATE.UPLOAD_ERROR?(r=i?ze.App.ESTATE.REQUEUED_AFTER_ERROR:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,r,void 0,void 0,void 0,void 0,t)):e.state==ze.App.ESTATE.REQUEUED_AFTER_ERROR&&(r=i?ze.App.ESTATE.QUEUED:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,r,void 0,void 0,void 0,void 0,t))},ze.App.prototype.queueEntryChildren=function(e,t){for(var i in e.children){var r=e.children[i];this.queueEntry(r,t),r.directory&&this.queueEntryChildren(r,t)}},ze.App.prototype.updateZipEntryTreeEntriesStateRecursive=function(e,t,i,r){this.zipEntryTree&&(r&&this.doUpdateEntryUiState(this.zipEntryTree,e,t,this.zipEntryTree.isEncrypted,i),this.updateEntryUiStateForChildren(this.zipEntryTree,e,t,this.zipEntryTree.isEncrypted,i))},ze.App.prototype.updateEntryUiStateForChildren=function(e,t,i,r,s){for(var o in e.children){var n=e.children[o];this.doUpdateEntryUiState(n,t,i,r,s),n.directory&&this.updateEntryUiStateForChildren(n,t,i,r,s)}},ze.App.prototype.doUpdateEntryUiState=function(e,t,i,r,s){t?this.updateEntryState(e,t,void 0,void 0,i,r):this.updateZipEntryUi(e,i,s,r)},ze.App.prototype.cancelAllUnstartedEntries=function(){this.cancelUnstartedEntry(this.zipEntryTree),this.cancelUnstartedChildEntries(this.zipEntryTree)},ze.App.prototype.cancelUnstartedEntry=function(e){ze.App.entryIsTerminal(e)||ze.App.entryIsInProgress(e)||this.updateEntryState(e,ze.App.ESTATE.CANCELED)},ze.App.prototype.cancelUnstartedChildEntries=function(e){for(var t in e.children){var i=e.children[t];this.cancelUnstartedEntry(i),i.directory&&this.cancelUnstartedChildEntries(i)}},ze.App.prototype.runWorkQueue=function(e){this.asyncWorkQueue.run(bindFn(this.workQueueExecutionComplete,this,e))},ze.App.prototype.updateEntryState=function(e,t,i,r,s,o,n){e.error=i||"",e.message=r||"",this.updateZipEntryStateMap(e,t),e.state=t,this.updateZipEntryUi(e,s,void 0,o,n)},ze.App.prototype.incrementSessionProgress=function(e,t){return this.isSessionAborted?-1:(this.currentSessionProgress+=t,this.handleProgress(this.currentSessionProgress,this.totalSessionSize))},ze.App.prototype.updateZipEntryStateMap=function(e,t){var i=e.state,r=e.path,s=this.zipEntryStateMap[t];s||(s={},this.zipEntryStateMap[t]=s),s[r]=e;i=this.zipEntryStateMap[i];i&&i.hasOwnProperty(r)&&delete i[r],ze.App.isTerminalState(t)?delete this.zipEntriesInProcessMap[r]:this.zipEntriesInProcessMap[r]=e},ze.App.prototype.areAllStatesTerminal=function(){return 0===Object.keys(this.zipEntriesInProcessMap).length},ze.App.entryIsTerminal=function(e){return ze.App.isTerminalState(e.state)},ze.App.isTerminalState=function(e){return e==ze.App.ESTATE.UPLOAD_COMPLETE||e==ze.App.ESTATE.UPLOAD_ERROR||e==ze.App.ESTATE.DOWNLOAD_COMPLETE||e==ze.App.ESTATE.DECOMPRESSION_ERROR||e==ze.App.ESTATE.DECOMPRESSION_CANCELED||e==ze.App.ESTATE.SKIPPED||e==ze.App.ESTATE.CANCELED||e==ze.App.ESTATE.QUEUED_PENDING_RETRY||e==ze.App.ESTATE.UPLOAD_ABORTED||e==ze.App.ESTATE.ADDED_TO_ZIP||e==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE||e==ze.App.ESTATE.DEFAULT||e==ze.App.ESTATE.PARSE_ERROR||e==ze.App.ESTATE.ENTRY_DISK_MISSING},ze.App.entryIsUploadable=function(e){e=e.state;return e==ze.App.ESTATE.QUEUED||e==ze.App.ESTATE.QUEUED_PENDING_RETRY||e==ze.App.ESTATE.REQUEUED_AFTER_ERROR||e==ze.App.ESTATE.UPLOAD_ERROR},ze.App.entryIsCanceled=function(e){e=e.state;return e==ze.App.ESTATE.CANCELED||e==ze.App.ESTATE.UPLOAD_ABORTED||e==ze.App.ESTATE.DECOMPRESSION_CANCELED},ze.App.entryIsInProgress=function(e){e=e.state;return e==ze.App.ESTATE.BEGIN_UPLOAD||e==ze.App.ESTATE.UPLOAD_PROGRESS||e==ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED},ze.App.prototype.generateWorkItem=function(e,t,i,r){e.parentId=t;var s=e.directory?this.processFolder:this.processFile;return bindFn(s,this,e,t,!!i,!!r)},ze.App.prototype.processFolder=function(e,t,i,r,s){if(this.isSessionAborted)this.updateEntryState(e,ze.App.ESTATE.CANCELED);else{if(e.uploadPrev=0,e.uploadCurrent=0,e.uploadTotal=0,this.updateEntryState(e,ze.App.ESTATE.BEGIN_UPLOAD,void 0,void 0,void 0,void 0,i),ze.App.isForTesting()){var o={};return o.name="test folder name: "+e.name,o.id="test folder id "+Math.random(),void this.folderInsertComplete(e,s,bindFn(this.processEntryTreeChildren,this,e,o.id,!1,i),o)}i?(this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE,void 0,void 0,void 0,void 0,i),this.updateUiForFileComplete(e),i=this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.setProgressBarPercent(i),(i={}).name="test folder name: "+e.name,i.id="test folder id "+Math.random(),e.folder=i,e.driveFileId=i.id,this.processEntryTreeChildren(e,i,!1,!0),s(),this.isSessionAborted&&this.checkForExtractionComplete(!0)):(s=ze.Dapi.generateCallbacks(bindFn(this.folderInsertComplete,this,e,s,bindFn(this.processEntryTreeChildren,this,e)),bindFn(this.folderInsertError,this,e,s),void 0,bindFn(this.folderInsertAborted,this,e,s)),ze.Dapi.createFolder(s,e.name,t))}},ze.App.prototype.processFile=function(e,t,i,r,s){this.isSessionAborted?this.updateEntryState(e,ze.App.ESTATE.CANCELED,void 0,void 0,void 0,void 0,i):(e.decompressionPrev=0,e.decompressionCurrent=0,e.decompressionTotal=0,e.uploadPrev=0,e.uploadCurrent=0,e.uploadTotal=0,this.updateEntryState(e,ze.App.ESTATE.BEGIN_DECOMPRESSION,void 0,void 0,void 0,void 0,i),ze.App.decompressArchiveEntry(this.zipBlob,e,!0,bindFn(this.decompressionComplete,this,e,t,i,r,s),bindFn(this.uploadDecompressionErrorOrCancel,this,e,i,r,s),bindFn(this.handleDecompressionProgress,this,e),bindFn(this.generalDecompressionCheckCancelFn,this),this.getZipPasswordCharCodeByteArray()))},ze.App.prototype.uploadDecompressionErrorOrCancel=function(e,t,i,r,s,o){var n=null!=e.compressionMethod?"Compression Method: "+e.compressionMethod+"; ":"";o?(logImpression(this.currentArchiveTypeString.toLowerCase(),"extract_decompress",n+"Canceled"),this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_CANCELED,"Decompression Canceled",s,void 0,void 0,t)):(logImpression(this.currentArchiveTypeString.toLowerCase(),"extract_decompress",n+"Error: "+s),this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_ERROR,"Decompression Error",s,void 0,void 0,t));s=null!=e.uncompressedSize?e.uncompressedSize:2*e.compressedSize;this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*s),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),r(),this.checkForExtractionComplete(t)},ze.App.prototype.handleDecompressionProgress=function(e,t,i){this.isSessionAborted||(e.decompressionPrev=e.decompressionCurrent||0,e.decompressionCurrent=t,e.decompressionTotal=i)},ze.App.prototype.decompressionComplete=function(e,t,i,r,s,o){if(this.isSessionAborted)return this.updateEntryState(e,ze.App.ESTATE.CANCELED),void this.checkForExtractionComplete(i);var n,p;this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_COMPLETE),i?(this.downloadBlobToBrowser(e.name,new Blob([o],{type:"application/octet-stream"}),!0),this.updateEntryState(e,ze.App.ESTATE.DOWNLOAD_COMPLETE,void 0,void 0,void 0,i),this.updateUiForFileComplete(e),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*e.uncompressedSize),n=this.handleProgress(this.currentSessionProgress,this.totalSessionSize),this.updateSecondaryProgressString(n,i,r),p=this,ze.App.execLater(function(){s(),p.checkForExtractionComplete(i)},void 0,1e3)):this.uploadFile(e,t,o,s)},ze.App.prototype.uploadFile=function(e,t,i,r){if(this.isSessionAborted)return this.updateEntryState(e,ze.App.ESTATE.CANCELED),void this.checkForExtractionComplete();if(this.updateEntryState(e,ze.App.ESTATE.BEGIN_UPLOAD),ze.App.isForTesting()){var s={};return s.name="test filename: "+e.name,s.id="test random id: id-"+Math.random(),void this.fileUploadComplete(e,r,s)}!e.directory&&e.tableRowIndex>this.highestZipEntryIndexUploadedInSession&&(this.highestZipEntryIndexUploadedInSession=e.tableRowIndex,e.tableRow.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}));r=ze.Dapi.generateCallbacks(bindFn(this.fileUploadComplete,this,e,r),bindFn(this.fileUploadError,this,e,r),bindFn(this.fileUploadProgress,this,e),bindFn(this.fileUploadAborted,this,e,r));ze.Dapi.uploadFile(r,e.name,i,t)},ze.App.prototype.fileUploadComplete=function(e,t,i){e.file=i,e.driveFileId=i.id,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE),this.updateUiForFileComplete(e),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES);e=this.handleProgress(this.currentSessionProgress,this.totalSessionSize);this.updateSecondaryProgressString(e),t(),this.checkForExtractionComplete()},ze.App.prototype.maybeRefreshCredentials=function(e){e!=ze.Dapi.ErrType.AUTH_ERROR&&401!=e||authorize(!0,void 0,void 0,void 0,CURRENT_AUTH_USER,!1,"maybeRefreshCredentials")},ze.App.prototype.fileUploadError=function(e,t,i,r){logImpression("upload_file","save_to_drive","error: "+i),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*e.uncompressedSize),this.updateSecondaryProgressString(),this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ERROR,i,r),t(),this.checkForExtractionComplete(),this.maybeRefreshCredentials(i)},ze.App.prototype.fileUploadAborted=function(e,t,i){logImpression("upload_file","save_to_drive","aborted"),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString();this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ABORTED,"Upload Aborted",i),t(),this.checkForExtractionComplete()},ze.App.prototype.fileUploadProgress=function(e,t,i){this.isSessionAborted||(e.uploadPrev=e.uploadCurrent||0,e.uploadCurrent=t,e.uploadTotal=i,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_PROGRESS),t===i&&this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED),t=e.uploadCurrent-e.uploadPrev,t=e.uncompressedSize/i*t,t=this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*t),this.updateSecondaryProgressString(t))},ze.App.prototype.folderInsertComplete=function(e,t,i,r){e.folder=r,e.driveFileId=r.id,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE),this.updateUiForFileComplete(e);e=this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES);this.updateSecondaryProgressString(e),i(r.id),t(),this.isSessionAborted&&this.checkForExtractionComplete()},ze.App.prototype.folderInsertError=function(e,t,i,r){logImpression("create_folder","save_to_drive","error: "+i),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString(),this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ERROR,i,r),this.setAllChildEntriesQueuedPendingRetry(e),t(),this.checkForExtractionComplete(),this.maybeRefreshCredentials(i)},ze.App.prototype.folderInsertAborted=function(e,t,i){logImpression("create_folder","save_to_drive","aborted"),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString();this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ABORTED,"Folder Create Aborted",i),this.cancelAllChildEntries(e),t(),this.checkForExtractionComplete()},ze.App.prototype.cancelAllChildEntries=function(e){for(var t in e.children){var i=e.children[t];this.updateEntryState(i,ze.App.ESTATE.CANCELED),i.directory&&this.cancelAllChildEntries(i)}},ze.App.prototype.setAllChildEntriesQueuedPendingRetry=function(e){for(var t in e.children){var i=e.children[t];i.state!=ze.App.ESTATE.SKIPPED&&i.state!=ze.App.ESTATE.PARSE_ERROR&&i.state!=ze.App.ESTATE.ENTRY_DISK_MISSING&&(this.updateEntryState(i,ze.App.ESTATE.QUEUED_PENDING_RETRY),this.incrementSessionProgress(i,ze.App.ENTRY_OVERHEAD_BYTES),i.directory&&this.setAllChildEntriesQueuedPendingRetry(i))}},ze.App.prototype.workQueueExecutionComplete=function(e){this.checkForExtractionComplete(e)},ze.App.prototype.checkForExtractionComplete=function(e){this.areAllStatesTerminal()&&this.appState!=ze.App.APP_STATE.EXTRACTION_COMPLETE_WITH_ERRORS&&this.appState!=ze.App.APP_STATE.EXTRACTION_COMPLETE&&this.handleExtractionComplete(this.isSessionAborted,e)},ze.App.prototype.updateZipEntryUi=function(e,t,i,r,s){if(e.root)return t?(this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!1),void this.showEl(this.selectAllCheckbox,!0)):void this.updateRootEntryUi(e,e.isEncrypted,this.isInZipEditMode,s);var o=e.state,n=e.tableRow;if(n||e.zipTreeEntry&&(n=e.zipTreeEntry.tableRow),n){var p=n.children[2],a=p.children[0],l=a.children[0],h=p.children[1],n=p.children[2];if(t&&o!=ze.App.ESTATE.PARSE_ERROR&&o!=ze.App.ESTATE.ENTRY_DISK_MISSING)return this.showEl(a,!1),this.showEl(h,!1),void this.showEl(n,!0);i=!!o&&i||this.isInZipEditMode&&(o==ze.App.ESTATE.ADDED_TO_ZIP||o==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE);e.directory&&!e.root&&(i=!1),p.children[0].children[0].style.cursor=i?"pointer":"default",o==ze.App.ESTATE.BEGIN_DECOMPRESSION?(this.showEl(a,!1),this.showEl(h,!0),this.showEl(n,!1),h.title="Decompressing file..."):o==ze.App.ESTATE.DECOMPRESSION_PROGRESS||(o==ze.App.ESTATE.BEGIN_UPLOAD?(this.showEl(a,!1),this.showEl(h,!0),this.showEl(n,!1),h.title="Extracting file to Google Drive..."):o==ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED||o==ze.App.ESTATE.UPLOAD_PROGRESS||(p=e.isEncrypted||e.directory&&r,i=null,i=e.directory&&!o||e.directory&&s?"remove":e.directory&&e.state==ze.App.ESTATE.DEFAULT?r&&!this.isInZipEditMode?"lock":"remove":ze.App.getEntryStatusIconMaterialId(o,p,this.isInZipEditMode,s),l.style.color="warning"==i||"error_outline"==i?"#d00000":"lock"==i?"#DCA93B":"",i=i||"whatshot",l.textContent=i,this.showEl(n,!1),this.showEl(h,!1),this.showEl(a,!0),l.title=ze.App.translateEntryState(o,e,s)))}},ze.App.prototype.updateRootEntryUi=function(e,t,i,r){var s;this.showEl(this.selectAllCheckbox,!1),e.state==ze.App.ESTATE.BEGIN_UPLOAD?(this.showEl(this.rootStatusSpinner,!0),this.showEl(this.rootStatusIconContainer,!1)):(s=this.rootStatusIcon,t=ze.App.getEntryStatusIconMaterialId(e.state,t,!1),i&&!this.zipIsEmpty()?(t="delete_sweep",s.style.cursor="pointer"):(r||this.zipIsEmpty())&&(s.style.cursor="default",t="remove"),s.style.color="warning"==t||"error_outline"==t?"#d00000":"lock"==t?"#DCA93B":"",t=t||"whatshot",s.textContent=t,this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!0))},ze.App.prototype.sendFeedbackEmail=function(e){e="mailto:feedback@zipextractor.app?subject=ZIP Extractor Feedback&body="+this.generateFeedbackEmailInformation(e);window.open(e)},ze.App.prototype.generateFeedbackEmailInformation=function(e){if(e)return"Hello ZIP Extractor developers, here is some feedback for you:%0D%0A================================================== %0D%0A%0D%0A%0D%0A";var t="* ZIP Extractor version: "+ze.VERSION+"%0D%0A",i="* Current app status: "+this.mainLabel.textContent+"%0D%0A* Additional details: "+this.secondaryLabel.textContent+"%0D%0A",e=this.getFirstErrorInfo();e&&(i+="* Error information: "+e+"%0D%0A");return"Hello ZIP Extractor developers, here is some feedback for you.%0D%0A%0D%0AApp Information: %0D%0A============================================= %0D%0A"+t+i+"%0D%0AAdditional Feedback: %0D%0A============================================= %0D%0A%0D%0A%0D%0A "},ze.App.showPicker=function(e,t,i,r,s,o,n){n={callback:bindFn(ze.App.showPickerInternal,window,e,t,i,r,s,o,n)};gapi.load("picker",n)},ze.App.showPickerInternal=function(e,t,i,r,s,o,n){t?ze.App.showFolderPicker(bindFn(ze.App.pickerFileChosenInternalCallback,window,!!o,e)):ze.App.showFilePicker(bindFn(ze.App.pickerFileChosenInternalCallback,window,!!o,e),i,r,s,o,n)},ze.App.pickerFileChosenInternalCallback=function(e,t,i){i.action==google.picker.Action.PICKED?i.docs&&0<i.docs.length?(logImpression("show_file_picker","picker","file_picked"),t(e?i.docs:i.docs[0])):logImpression("show_file_picker","picker","no_file_picked_in_data"):logImpression("show_file_picker","picker","other_data_action: "+i.action)},ze.App.pickerFolderChosenInternalCallback=function(e,t){t.action==google.picker.Action.PICKED?t.docs&&0<t.docs.length?(logImpression("show_folder_picker","picker","folder_picked"),e(t.docs[0])):logImpression("show_folder_picker","picker","no_folder_picked_in_data"):logImpression("show_folder_picker","picker","other_data_action: "+t.action)},ze.App.showFilePicker=function(e,t,i,r,s,o){logImpression("show_file_picker","picker","show");var n=ze.App.SUPPORTED_MIME_TYPES.join(","),p=new google.picker.DocsView(google.picker.ViewId.DOCS).setSelectFolderEnabled(!1).setIncludeFolders(!1).setMode(google.picker.DocsViewMode.LIST);o&&p.setQuery('title:"'+o+'"'),r||p.setMimeTypes(n),t&&p.setParent(t);i=i||"Open ZIP file from Google Drive",i=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(APP_CONFIG.appId).setOAuthToken(getAccessToken()).setDeveloperKey(APP_CONFIG.apiKey).setCallback(e).addView(p).setTitle(i);s&&i.enableFeature(google.picker.Feature.MULTISELECT_ENABLED),i.build().setVisible(!0)},ze.App.showFolderPicker=function(e){logImpression("show_folder_picker","picker","show");var t=new google.picker.DocsView(google.picker.ViewId.DOCS).setSelectFolderEnabled(!0).setIncludeFolders(!0).setMode(google.picker.DocsViewMode.LIST).setMimeTypes(ze.Dapi.MimeType.FOLDER),i="phone"==detectDevice()?"Select a Google Drive folder":"Select a Google Drive folder for extracted files";(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(APP_CONFIG.appId).setOAuthToken(getAccessToken()).setDeveloperKey(APP_CONFIG.apiKey).setCallback(e).addView(t).setTitle(i).build().setVisible(!0)},ze.App.getStringFromBytes=function(e,t,i,r){for(var s="",t=null!=t?t:0,o=null!=i?i:e.length,n=t;n<o;n++)s+=String.fromCharCode(e[n]),r&&127<e[n]&&(r.hasExtendedChar=!0);return s},ze.App.isExportableGoogleDocsMimeType=function(e){if(ze.App.isGoogleAppsMimeType(e)){e=ze.App.stringSuffixAt(e,28);return-1!=ze.App.SUPPORTED_GOOGLE_DOCS_EXPORT_TYPES.indexOf(e)}return!1},ze.App.isGoogleAppsMimeType=function(e){return ze.App.startsWith(e,"application/vnd.google-apps.")},ze.App.isSupportedArchiveType=function(e,t){e=ze.App.getFileExtension(e.toLowerCase());return!!(e&&""!=e&&-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(e))||!!t&&-1!=ze.App.SUPPORTED_MIME_TYPES.indexOf(t)},ze.App.inferArchiveMimetypeFromMagicBlobAsync=function(e,t,i){e.size<5?t(null):ze.App.blobToByteArrayAsync(e,0,5,function(e){e=ze.App.inferArchiveMimetypeFromMagicBytes(e);t(e)},i)},ze.App.inferArchiveMimetypeFromMagicBytes=function(e){return 80==e[0]&&75==e[1]?ze.App.CANONICAL_MIME_TYPES.ZIP:31==e[0]&&139==e[1]?ze.App.CANONICAL_MIME_TYPES.GZIP:253==e[0]&&55==e[1]&&122==e[2]?ze.App.CANONICAL_MIME_TYPES.XZ:55==e[0]&&122==e[1]&&188==e[2]&&175==e[3]?ze.App.CANONICAL_MIME_TYPES.SEVENZIP:82==e[0]&&97==e[1]&&114==e[2]&&33==e[3]&&26==e[4]?ze.App.CANONICAL_MIME_TYPES.RAR:66==e[0]&&90==e[1]&&104==e[2]?ze.App.CANONICAL_MIME_TYPES.BZIP:76==e[0]&&90==e[1]&&73==e[2]&&80==e[3]&&1==e[4]?ze.App.CANONICAL_MIME_TYPES.LZIP:137==e[0]&&80==e[1]&&78==e[2]&&71==e[3]&&13==e[4]?ze.App.CANONICAL_MIME_TYPES.PNG:255==e[0]&&216==e[1]?ze.App.CANONICAL_MIME_TYPES.JPG:71==e[0]&&73==e[1]&&70==e[2]&&56==e[3]?ze.App.CANONICAL_MIME_TYPES.GIF:66==e[0]&&77==e[1]?ze.App.CANONICAL_MIME_TYPES.BMP:37==e[0]&&80==e[1]&&68==e[2]&&70==e[3]?ze.App.CANONICAL_MIME_TYPES.PDF:null},ze.App.postProcessEntryFilenameAndMaybeSkip=function(e,t){var i=!1;return null==e.filename&&(e.filename=""),e.filename=e.filename.replace(/\\/g,"/"),null!=e.filename&&""!=e.filename&&"/"!=e.filename&&"./"!=e.filename&&"."!=e.filename&&".."!=e.filename||(e.directory||0==e.uncompressedSize?i=!0:e.filename="(No name "+t+")"),ze.App.startsWith(e.filename,"./")?e.filename=e.filename.substring(2):ze.App.startsWith(e.filename,"/")&&(e.filename=e.filename.substring(1)),ze.App.isSystemFile(e.filename,null,e.directory)&&(i=!0),i},ze.App.getErrorDetailsFromErrorObject=function(e){var t="";return e&&(t+=e.stack),t},ze.App.getParentIdOfDriveFile=function(e){e=e.parents;return e&&0<e.length?e[0]:null},ze.App.blobToString=function(e,t,i,r,s){t=null!=t?t:0,i=null!=i?i:e.size;ze.App.blobToByteArrayAsync(e,t,i,function(e){r(ze.App.getStringFromBytes(e))},s)},ze.App.blobToDataViewAsync=function(e,t,i,r,s){ze.App.blobToArrayLikeAsync(!0,e,t,i,r,s)},ze.App.blobToByteArrayAsync=function(e,t,i,r,s){ze.App.blobToArrayLikeAsync(!1,e,t,i,r,s)},ze.App.blobToArrayLikeAsync=function(i,e,t,r,s,o){var n=new FileReader;n.onload=function(e){try{var t=e.target.result;null==t&&(t=n.result),s(new(i?DataView:Uint8Array)(t))}catch(e){o(e)}},n.onerror=function(){var e=n.error;o(e)},0==t&&r==e.size?n.readAsArrayBuffer(e):(r=e.slice(t,r),n.readAsArrayBuffer(r))},ze.App.decompressArchiveEntry=function(t,r,i,s,o,n,p,a,l,h){if("7z"==r.type)try{zeSevenZLib.getDecodedBlobForEntry(t,r,s,o,n,p,a,!0)}catch(e){return void o("7z Entry Decompress Error: "+e)}else if("tar"==r.type){var e;try{e=t.slice(r.offset+ze.TarLib.TAR_HEADER_SIZE,r.offset+ze.TarLib.TAR_HEADER_SIZE+r.compressedSize),s(e)}catch(e){return void o("TAR Slice Error: "+e)}}else if("rar"==r.type)!r.isEncrypted||null!=a&&0!=a.length?ze.RarLib.decompressRarEntry(r.originalRarLibEntry,a,s,o,n,p):o("RAR file is password protected but no password was provided");else if("bzip"==r.type)ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_BZIP_SCRIPT_NAME),ze.App.CHUNK_SIZE_BZIP,t,r.offset,r.compressedSize,r.uncompressedSize,r.crc32,function(e){var t=0;if(null!=e.size)t=e.size;else for(var i=0;i<e.length;i++)t+=e[i].length;r.uncompressedSize=t,s(e)},o,null,void 0,void 0,n,p,!0,l,void 0,void 0,h);else if("gzip"==r.type)ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_INFLATE_SCRIPT_NAME),ze.App.CHUNK_SIZE_INFLATE,t,r.offset,r.compressedSize,r.uncompressedSize,r.crc32,s,o,null,void 0,void 0,n,p,!0,l,void 0,void 0,h);else if("lzma"==r.type){var d=null!=r.uncompressedSize?r.uncompressedSize:-1,E={};E.decoderProperties=r.decoderProperties,ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_LZMA_SCRIPT_NAME),ze.App.CHUNK_SIZE_LZMA,t,r.offset,r.compressedSize,d,r.crc32,s,o,null,void 0,E,n,p,!0,l,void 0,void 0,h)}else if("xz"==r.type)ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_XZ_SCRIPT_NAME),ze.App.CHUNK_SIZE_XZ,t,r.offset,r.compressedSize,r.uncompressedSize,r.crc32,s,o,null,void 0,void 0,n,p,!0,l,void 0,void 0,h);else if("lzip"==r.type)try{ze.App.decompressLzipArchiveEntryMembers(t,r.lzipMembers,r.totalUncompressedSize,r.totalCompressedSize,function(e){s(l?e:new Blob(e))},o,n,p)}catch(e){return void o(e)}else"zip"==r.type?!r.isEncrypted||null!=a&&0!=a.length?(E=zeZipReader.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES+65536+(r.isEncrypted?zeZipReader.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH:0),ze.App.blobToDataViewAsync(t,r.offset,Math.min(r.offset+E,t.size),function(e){try{zeZipReader.decompressZipEntry(t,e,r.offset,r.compressedSize,r.uncompressedSize,r.bitFlag,i?r.crc32:null,r.compressionMethod,r.encryptionMode,s,o,n,p,a,r.aesKeyStrengthBits,l,h)}catch(e){o("decompressEntryData error: "+e)}},o)):o(zeZipReader.ERR_INFLATION+" - ZIP file is password protected but no password was provided"):o("Error: Unrecognized Entry Archive Type: "+r.type)},ze.App.decompressLzipArchiveEntryMembers=function(e,t,i,r,s,o,n,p){ze.App.doDecompressLzipArchiveEntryMember(e,t,0,i,r,0,[],s,o,n,p)},ze.App.doDecompressLzipArchiveEntryMember=function(r,s,o,n,p,a,l,h,d,E,A){try{var c=s[o],e={};e.decoderProperties=c.lzmaProps,ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_LZMA_SCRIPT_NAME),ze.App.CHUNK_SIZE_LZMA,r,c.offset,c.compressedSize,-1,c.crc32,function(e){for(var t=0,i=0;i<e.length;i++)l.push(e[i]),t+=e[i].length;t==c.uncompressedSize?o==s.length-1?h(l):ze.App.doDecompressLzipArchiveEntryMember(r,s,o+1,n,p,a+c.compressedSize,l,h,d,E,A):d("LZIP uncompressed LZMA stream size mismatch: Expected "+c.uncompressedSize+", got: "+t)},d,null,void 0,e,E,A,!0,!0,p,a)}catch(e){return void d(e)}},ze.App.isTextFileType=function(e,t){return"text"==t||"code"==t||"csv"==t||("README"==(e||"").toUpperCase()||"LICENSE"==(e||"").toUpperCase()||"INSTALL"==(e||"").toUpperCase()||"COPYING"==(e||"").toUpperCase()||"NEWS"==(e||"").toUpperCase()||"THANKS"==(e||"").toUpperCase())},ze.App.isHiddenTextViewableDotFile=function(e,t){return e==="."+t},ze.App.isSystemFile=function(e,t,i){if(null==e)return!1;t=null!=t?t:ze.App.getFileExtension(e).toLowerCase();return ze.App.startsWith(e,"._")||ze.App.stringContains(e,"/._")||ze.App.startsWith(e,"__MACOSX")&&ze.App.stringContains(e,"/._")||ze.App.startsWith(e,"__MACOSX")&&i||"ds_store"==t.toLowerCase()||"thumbs.db"==e.toLowerCase()||ze.App.endsWith(e.toLowerCase(),"/thumbs.db")},ze.App.htmlEscape=function(e,t){e=String(e).replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t||(e=e.replace(/&/g,"&amp;").replace(/'/g,"&#39;")),e},ze.App.updateEmbeddedTarFilename=function(e,t,i){t=(e=e||"").toLowerCase().indexOf(t,e.length-t.length);return-1!==t?(e=e.substring(0,t),e+="tar"):-1!==(i=e.toLowerCase().indexOf(i,e.length-i.length))&&(e=e.substring(0,i-1)),e},ze.App.updatePageTitle=function(e){document.title=e?e+" - "+ze.App.NAME:ze.App.NAME},ze.App.resetPageTitle=function(){document.title=ze.App.DEFAULT_PAGE_TITLE},ze.App.getProcessedSizeFromDriveFileObj=function(e){e=null!=e.size?e.size:null!=e.sizeBytes?e.sizeBytes:null;return null!=e?parseInt(e,10):-1},ze.App.getZipExtractorCreateZipCommentString=function(e){return"Created by ZIP Extractor v"+ze.VERSION+" on "+ze.App.getCurrentDateFormatted()+" (https://zipextractor.app)"+(e?" [ZIP64 Format]":"")},ze.App.getDateFormatted=function(e){return[e.getDate(),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],e.getFullYear()].join("-")},ze.App.getDateFormatted2=function(e){var t=e.getDate();return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+t+", "+e.getFullYear()},ze.App.getCurrentDateFormatted=function(){return ze.App.getDateFormatted(new Date)},ze.App.sanitizeDriveFilename=function(e){return null==e?null:e.replace("/","_").replace("?","_").replace("*","_").replace("+","_").replace(",","_").replace(":","_").replace(";","_").replace("<","_").replace("=","_").replace(">","_").replace("\\","_").replace("[","_").replace("]","_")},ze.App.genericDecompressWithWorker=function(d,E,s,o,n,e,A,c,u,T,z,t,_,P,I,S,i,r,D){var p,a,m=performance.now(),w=0,l=0,v=[],R=null==r?0:r,y=null==i?n:i;function C(e,t,i){var r;-1==e&&(e=n),(w=l*e)<n?(r=o+w,e=Math.min(e,n-w),ze.App.blobToByteArrayAsync(s,r,r+e,function(e){try{t==ze.App.ENCRYPTION_MODE_PKZIPSTANDARD?zeZipReader.Crypto.decryptChunkBytesInPlaceZipCrypto(e,i):t==ze.App.ENCRYPTION_MODE_WINZIPAES?zeZipReader.Crypto.Aes.decryptChunkBytesInPlaceWinZipAes(e,i):t==ze.App.ENCRYPTION_MODE_7ZAES&&zeSevenZLib.decryptChunkBytesInPlace7zAes(e,i),d.postMessage({append:!0,data:e},[e.buffer]),l++}catch(e){d.terminate(),u(e)}},function(e){d.terminate(),u(e)})):d.postMessage({flush:!0})}d.addEventListener(ze.App.DECOMPRESS_WORKER_MESSAGE_EVENT,function e(t){var i=t.data;if(i.progress&&_)return _(R+w+i.current,y,I,D),P&&P()?(d.terminate(),void u(ze.App.ERR_WRITE_DATA+" - cancelled",!0)):void 0;var r=i.onflush,s=i.onappend,o=i.isError,t=i.oninit,n=r?" - flush() -":t?" - init() - ":"";if(o)return d.terminate(),void u(ze.App.ERR_GENERIC_DECOMPRESS+n+" - "+i.errorMessage);if(t)if(T!=ze.App.ENCRYPTION_MODE_PKZIPSTANDARD)if(T!=ze.App.ENCRYPTION_MODE_WINZIPAES)if(T!=ze.App.ENCRYPTION_MODE_7ZAES)try{C(E,T,z)}catch(e){d.terminate(),u(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decompress() - "+n+e)}else ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){try{C(E,T,z)}catch(e){d.terminate(),u(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decrypt decompress() - "+n+e)}});else ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPREADER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPREADER_SCRIPT_NAME,function(){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){try{C(E,T,z)}catch(e){d.terminate(),u(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decrypt decompress() - "+n+e)}})});else ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIPREADER_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIPREADER_SCRIPT_NAME,function(){try{C(E,T,z)}catch(e){d.terminate(),u(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decrypt decompress() - "+n+e)}});else{if(!r&&!s)return d.terminate(),void u(ze.App.ERR_GENERIC_DECOMPRESS+" - Expected message type of either flush or append");if(!r&&null==i.data)return d.terminate(),void u(ze.App.ERR_GENERIC_DECOMPRESS+" - Inflated data chunk is required but was null");var p=i.data;if(null!=i.data){p.length;try{v.push(p)}catch(e){return d.terminate(),void u(ze.App.ERR_WRITE_DATA+" - decompress() - "+n+e)}}if(P&&P())return d.terminate(),void u(ze.App.ERR_WRITE_DATA+" - inflate() - cancelled",!0);if(s)try{C(E,T,z),_&&_(Math.min(R+w,y),y,I,D)}catch(e){return d.terminate(),void u(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decompress() - "+n+e)}else if(r){if(d.removeEventListener(ze.App.DECOMPRESS_WORKER_MESSAGE_EVENT,e,!1),d.terminate(),window.console.log("Elapsed Time to decompress entry: "+Math.round(performance.now()-m)),r=A,i=i.crc32,null!=r){if(null==i)return void u(ze.App.ERR_READ_DATA_CRC+" - No CRC32 valued was computed for this entry, but a CRC32 check value was provided and required to be checked.");if(r!=i>>>0)return void u(ze.App.ERR_READ_DATA_CRC)}if(T==ze.App.ENCRYPTION_MODE_WINZIPAES){if(!z)return void u("Encryption params required for WINZIP AES decryption verification");var a=z.authenticationCodeBytes;if(!a)return void u("Authentication code required for WINZIP AES decryption verification");var l=z.hmac;if(!l)return void u("HMAC required for WINZIP AES decryption verification");var h=null;try{h=zeZipReader.Crypto.Aes.verifyWinzipAesAuthenticationCode(a,l)}catch(e){return void u(e)}if(!h)return void u("Message authentication code did not match. Password is invalid or ZIP file data has been corrupted.")}c(S?v:new Blob(v))}else d.terminate(),u(ze.App.ERR_WRITE_DATA+" - finalization - decompress() - expected either append or flush for finalization actions")}},!1),d.onerror=function(e){d.terminate();var t=e||"",t=t.message+" (Line "+t.lineno+") "+(t.filename||" ")+(t.target||" ")+(t.type||" ");u(ze.App.ERR_GENERIC_DECOMPRESS+" - Worker Error #1 - "+e+" - "+t)},d.addEventListener("error",function(e){d.terminate();var t=e||"",t=t.message+" (Line "+t.lineno+") "+(t.filename||" ")+(t.target||" ")+(t.type||" ");u(ze.App.ERR_GENERIC_DECOMPRESS+" - Worker Error #2 - "+e+" - "+t)},!1),p=null!=A,a=t||{},d.postMessage({init:!0,computeCrc32:p,uncompressedSize:e,params:a}),_&&_(R+0,y,I,D)},ze.AsyncWorkQueue=function(e){this.maxWorkers=e,this.workQueue=null,this.runCompleteCallback=null,this.numCurrentWorkers=-1,this.isRunning=!1,this.init()},ze.AsyncWorkQueue.prototype.init=function(){this.workQueue=[],this.numCurrentWorkers=0,this.runCompleteCallback=null,this.isRunning=!1},ze.AsyncWorkQueue.prototype.close=function(){this.init()},ze.AsyncWorkQueue.prototype.enqueue=function(e){this.workQueue.push(e)},ze.AsyncWorkQueue.prototype.run=function(e){this.runCompleteCallback=e,this.isEmpty()?this.runCompleteCallback():(this.isRunning=!0,this.processQueue())},ze.AsyncWorkQueue.prototype.processQueue=function(){for(;this.numCurrentWorkers<this.maxWorkers&&!this.isEmpty();)this.executeNextWorkItem()},ze.AsyncWorkQueue.prototype.stop=function(){this.workQueue.length=0,this.isRunning=!1},ze.AsyncWorkQueue.prototype.isEmpty=function(){return 0===this.workQueue.length},ze.AsyncWorkQueue.prototype.isActive=function(){return this.isRunning||!this.isDone()},ze.AsyncWorkQueue.prototype.isDone=function(){return 0===this.numCurrentWorkers&&this.isEmpty()},ze.AsyncWorkQueue.prototype.executeNextWorkItem=function(){var e=this.workQueue.shift();if(this.numCurrentWorkers>this.maxWorkers)throw new Error("Error: too many workers. Current # of Workers: "+this.numCurrentWorkers+"; max: "+this.maxWorkers);this.numCurrentWorkers++,e(bindFn(this.workItemComplete,this))},ze.AsyncWorkQueue.prototype.workItemComplete=function(){if(this.isRunning){if(this.numCurrentWorkers--,this.numCurrentWorkers<0)throw console.log("*** Error: too few workers"),new Error("Error: too few workers. Current # of Workers: "+this.numCurrentWorkers+"; min: 0");this.isDone()?(this.isRunning=!1,this.runCompleteCallback&&this.runCompleteCallback()):this.processQueue()}},ze.Dapi={},ze.Dapi.activeRequests=[],ze.Dapi.ApiUrl={UPLOAD:"https://www.googleapis.com/upload/drive/v3/files/",FILES:"https://www.googleapis.com/drive/v3/files/"},ze.Dapi.ErrType={FORBIDDEN:"forbidden",FILE_NOT_FOUND:"fileNotFound",METHOD_NOT_ALLOWED:"methodNotAllowed",DEADLINE_EXCEEDED:"deadlineExceeded",SERVER_ERROR:"serverError",AUTH_ERROR:"authError",BAD_REQUEST:"badRequest",REQUEST_ABORTED:"requestAborted",UNKNOWN:"unknown"},ze.Dapi.ErrMsg={FORBIDDEN:"There was a problem with the server request; please try again",FILE_NOT_FOUND:'You do not have read access to this file; try the "Open with" option in Drive or try using a different Google account',METHOD_NOT_ALLOWED:"An configuration error occured when uploading this file",DEADLINE_EXCEEDED:"The server took too long to respond; please try again",SERVER_ERROR:"An internal server error occurred; please try again",AUTH_ERROR:"An authorization error occurred; please re-authorize",BAD_REQUEST:"The server request could not be understood; please report this error to the developers",REQUEST_ABORTED:"The request was aborted when it was still in progress",UNKNOWN:"An unknown error occurred; please try again or report this error to the developers",XHR_NETWORK:"Network request failed. Please check that you are online and try again"},ze.Dapi.XHR_ERROR_CODES={403:ze.Dapi.ErrType.FORBIDDEN,404:ze.Dapi.ErrType.FILE_NOT_FOUND,405:ze.Dapi.ErrType.METHOD_NOT_ALLOWED,500:ze.Dapi.ErrType.SERVER_ERROR,503:ze.Dapi.ErrType.DEADLINE_EXCEEDED,401:ze.Dapi.ErrType.AUTH_ERROR,400:ze.Dapi.ErrType.BAD_REQUEST,0:ze.Dapi.ErrType.REQUEST_ABORTED},ze.Dapi.getErrorMessage=function(e,t){switch(e){case ze.Dapi.ErrType.FORBIDDEN:return ze.Dapi.ErrMsg.FORBIDDEN+(t?" ("+t+")":"");case ze.Dapi.ErrType.FILE_NOT_FOUND:return ze.Dapi.ErrMsg.FILE_NOT_FOUND;case ze.Dapi.ErrType.SERVER_ERROR:return ze.Dapi.ErrMsg.SERVER_ERROR;case ze.Dapi.ErrType.DEADLINE_EXCEEDED:return ze.Dapi.ErrMsg.DEADLINE_EXCEEDED;case ze.Dapi.ErrType.AUTH_ERROR:return ze.Dapi.ErrMsg.AUTH_ERROR;case ze.Dapi.ErrType.BAD_REQUEST:return ze.Dapi.ErrMsg.BAD_REQUEST;case ze.Dapi.ErrType.REQUEST_ABORTED:return ze.Dapi.ErrMsg.REQUEST_ABORTED;case ze.Dapi.ErrType.METHOD_NOT_ALLOWED:return ze.Dapi.ErrMsg.METHOD_NOT_ALLOWED;default:return ze.Dapi.ErrMsg.UNKNOWN}},ze.Dapi.DEFAULT_FIELDS_GET="id,name,size,parents,mimeType",ze.Dapi.DEFAULT_FIELDS_CREATE="id",ze.Dapi.Method={POST:"POST",GET:"GET",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},ze.Dapi.CbType={SUCCESS:"success",ERROR:"error",PROGRESS:"progress",ABORT:"abort"},ze.Dapi.MimeType={JSON:"application/json",FOLDER:"application/vnd.google-apps.folder"},ze.Dapi.XhrResponseType={BLOB:"blob",JSON:"json",TEXT:"text"},ze.Dapi.generateCallbacks=function(e,t,i,r){var s={};return s[ze.Dapi.CbType.SUCCESS]=e,s[ze.Dapi.CbType.ERROR]=t,i&&(s[ze.Dapi.CbType.PROGRESS]=i),r&&(s[ze.Dapi.CbType.ABORT]=r),s},ze.Dapi.abortDownload=function(){var e=ze.Dapi.getDownloadXhr();e&&e.abort()},ze.Dapi.getDownloadXhr=function(){return 0<ze.Dapi.activeRequests.length?ze.Dapi.activeRequests[0]:null},ze.Dapi.get=function(e,t){var i={fields:ze.Dapi.DEFAULT_FIELDS_GET,supportsAllDrives:"true"};ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e,i)},ze.Dapi.uploadFile=function(e,t,i,r,s){i&&0<i.size?ze.Dapi.uploadFileResumeable(e,t,i,r,s):ze.Dapi.createEmptyFile(e,t,r)},ze.Dapi.uploadFileResumeable=function(r,e,s,t,i){var o=ze.Dapi.generateCallbacks(function(e,t){var i;t?MAINAPP.isSessionAborted?(i=r[ze.Dapi.CbType.ABORT])&&i():ze.Dapi.sendResumeableUploadFileData(r,t,s):(0,r[ze.Dapi.CbType.ERROR])(void 0,'No Session URI was provided in server response for "Location" response header')},r[ze.Dapi.CbType.ERROR],void 0,r[ze.Dapi.CbType.ABORT]);ze.Dapi.getResumeableUploadSessionUri(o,e,s,t,i)},ze.Dapi.getResumeableUploadSessionUri=function(e,t,i,r,s){var o={uploadType:"resumable",fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"},t={name:t};r&&!s&&(t.parents=[r]);r="application/json; charset=UTF-8",i={"X-Upload-Content-Type":"application/octet-stream","X-Upload-Content-Length":i.size,"Content-Type":r};ze.Dapi.sendXhr(e,s?ze.Dapi.Method.PATCH:ze.Dapi.Method.POST,ze.Dapi.ApiUrl.UPLOAD+(s||""),o,JSON.stringify(t),r,ze.Dapi.XhrResponseType.JSON,void 0,i,"Location",!0)},ze.Dapi.sendResumeableUploadFileData=function(e,t,i){ze.Dapi.sendXhr(e,ze.Dapi.Method.PUT,t,{},i,"",ze.Dapi.XhrResponseType.JSON,void 0,{})},ze.Dapi.updateFileNameInDrive=function(e,t,i){var r={};r.name=i,ze.Dapi.updateFileMetadata(e,t,r)},ze.Dapi.updateFileMetadata=function(e,t,i){var r={fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"};ze.Dapi.sendXhr(e,ze.Dapi.Method.PATCH,ze.Dapi.ApiUrl.FILES+t,r,JSON.stringify(i),ze.Dapi.MimeType.JSON,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.createFolder=function(e,t,i){ze.Dapi.createEmptyItemOrFolder(e,t,!0,i)},ze.Dapi.createEmptyFile=function(e,t,i){ze.Dapi.createEmptyItemOrFolder(e,t,!1,i)},ze.Dapi.createEmptyItemOrFolder=function(e,t,i,r){t={name:t};i&&(t.mimeType=ze.Dapi.MimeType.FOLDER),r&&(t.parents=[r]);r={fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"};ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.FILES,r,JSON.stringify(t),ze.Dapi.MimeType.JSON,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.createFolder=function(e,t,i){t={name:t,mimeType:ze.Dapi.MimeType.FOLDER};i&&(t.parents=[i]);i={fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"};ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.FILES,i,JSON.stringify(t),ze.Dapi.MimeType.JSON,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.sendXhr=function(p,a,e,t,i,r,s,o,n,l,h){var d=new XMLHttpRequest;ze.Dapi.activeRequests.push(d);var E=t||{},t=i||void 0,i=r||ze.Dapi.MimeType.JSON,r=s||ze.Dapi.XhrResponseType.JSON;d.onreadystatechange=function(e){var t,o,n,i,r,s;4==d.readyState&&(ze.Dapi.removePendingXhr(d),200==d.status&&(null==d.response||null==d.response)&&h||200==d.status&&null!=d.response&&null!=d.response||204==d.status&&!d.response?((i=d.response)&&""===d.responseType&&"string"==typeof d.response&&(i=JSON.parse(d.response)),l?(t=d.getResponseHeader(l),ze.Dapi.invokeCallback(p,ze.Dapi.CbType.SUCCESS,i,t)):ze.Dapi.invokeCallback(p,ze.Dapi.CbType.SUCCESS,i)):0===d.status||200==d.status&&(null==d.response||null==d.response)?(logImpression("xhr_aborted","xhr","xhr_status="+d.status+", xhr_response == null? "+d.response==null),r=ze.Dapi.getErrorMessage(ze.Dapi.ErrType.REQUEST_ABORTED),ze.Dapi.invokeCallback(p,ze.Dapi.CbType.ABORT,r)):(o=ze.Dapi.XHR_ERROR_CODES[d.status],n=d.statusText||"",i="",(r=d.response)&&""===d.responseType&&"string"==typeof r&&(r=JSON.parse(r)),r&&r.error&&(i=r.error.message||"")&&(n?n+=" - "+i:n=i),d.response&&d.response instanceof Blob&&"application/json"===d.response.type?((s=new FileReader).onload=function(e){var t="";try{var i,r=JSON.parse(e.target.result);r&&r.error?r.error.errors&&0<r.error.errors.length?(t=(t=r.error.errors[0].reason)||"",(i=r.error.errors[0].message)&&(t+=" - "+i)):t=r.error:t=(r||"")+" ("+e.target.result+")"}catch(e){t="Error parsing response BLOB JSON ("+e+")"}var s=o+" "+d.status+" ["+t+"]"+(n?" ("+n+")":"");logImpression("xhr_http_error","xhr","method="+a+"; error: "+s),ze.Dapi.invokeCallback(p,ze.Dapi.CbType.ERROR,o,ze.Dapi.getErrorMessage(o,t))},s.readAsText(d.response)):(s=o+" "+d.status+(n?" ("+n+")":""),logImpression("xhr_http_error2","xhr","method="+a+"; error: "+s),ze.Dapi.invokeCallback(p,ze.Dapi.CbType.ERROR,o,ze.Dapi.getErrorMessage(o,i)))))},p[ze.Dapi.CbType.PROGRESS]&&(s=function(e){var t;e&&(t=e.loaded,e=e.total,400==d.status||401==d.status||403==d.status||404==d.status||500==d.status||503==d.status||ze.Dapi.invokeCallback(p,ze.Dapi.CbType.PROGRESS,t,e))},a==ze.Dapi.Method.GET?d.onprogress=s:d.upload.onprogress=s),p[ze.Dapi.CbType.ERROR]&&(d.onerror=function(e){var t=ze.Dapi.ErrMsg.XHR_NETWORK,i="";d.statusText&&(i+=d.statusText+" - "),e&&(e.target&&e.target.status&&(i+=" - "+e.target.status),e.error&&(i+=" - "+e.error)),logImpression("xhr_network_error","xhr","error: "+(t+(i?" ("+i+")":""))),ze.Dapi.removePendingXhr(d),ze.Dapi.invokeCallback(p,ze.Dapi.CbType.ERROR,t,i)});E=ze.Dapi.buildCorsUrl(e,E);if(d.open(a,E,!0),d.responseType=r,d.setRequestHeader("Authorization","Bearer "+getAccessToken()),i&&d.setRequestHeader("Content-Type",i),o&&d.setRequestHeader("Range","bytes="+o),n)for(var A in n)n.hasOwnProperty(A)&&d.setRequestHeader(A,n[A]);d.send(t)},ze.Dapi.buildCorsUrl=function(e,t){t=ze.Dapi.buildQuery(t);return t&&(e+="?"+t),e},ze.Dapi.buildQuery=function(t){return t=t||{},Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},ze.Dapi.removePendingXhr=function(e){e=ze.Dapi.activeRequests.indexOf(e);-1!=e&&ze.Dapi.activeRequests.splice(e,1)},ze.Dapi.abortAllRequests=function(){for(var e=ze.Dapi.activeRequests.slice(0),t=0;t<e.length;t++){var i=e[t];i&&i.abort&&i.abort()}},ze.Dapi.invokeCallback=function(e,t,i,r){t=e[t];t&&t(i,r)},ze.Dapi.downloadFileBytes=function(e,t,i,r){var s={alt:"media",supportsAllDrives:"true"};r&&(s.acknowledgeAbuse=!0),ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e,s,void 0,void 0,ze.Dapi.XhrResponseType.BLOB,i)},ze.Dapi.exportGoogleDocFileBytes=function(e,t,i){i={alt:"media",supportsAllDrives:"true",mimeType:i||"application/pdf"};ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e+"/export",i,void 0,void 0,ze.Dapi.XhrResponseType.BLOB)},ze.RarLib={},ze.RarLib.RAR_HEADER_V1=String.fromCharCode(82,69,126,94),ze.RarLib.RAR_HEADER_V4=String.fromCharCode(82,97,114,33,26,7,0),ze.RarLib.RAR_HEADER_V5=String.fromCharCode(82,97,114,33,26,7,1,0),ze.RarLib.HEADER_MAGIC_BYTES_SIZE=8,ze.RarLib.ARCHIVE_HEADER_MIN_SIZE=18,ze.RarLib.verifyRarFile=function(e,t,i){e.size<ze.RarLib.ARCHIVE_HEADER_MIN_SIZE?i("RAR file size is less than required header size."):ze.App.blobToString(e,0,ze.RarLib.HEADER_MAGIC_BYTES_SIZE,function(e){ze.RarLib.RAR_HEADER_V4==e.slice(0,ze.RarLib.RAR_HEADER_V4.length)?t(ze.RarLib.RAR_HEADER_V4):ze.RarLib.RAR_HEADER_V1==e.slice(0,ze.RarLib.RAR_HEADER_V1.length)?i("Older RAR Version 1 format is not yet supported."):ze.RarLib.RAR_HEADER_V5==e.slice(0,ze.RarLib.RAR_HEADER_V5.length)?t(ze.RarLib.RAR_HEADER_V5):i('File does not appear to be a RAR file ("'+e+'")')},i)},ze.RarLib.getRarEntries=function(e,t,i,r,s,o){e.size<=ze.RarLib.ARCHIVE_HEADER_MIN_SIZE?i("RAR file insufficient size ("+e.size+")"):o==ze.RarLib.RAR_HEADER_V5||o==ze.RarLib.RAR_HEADER_V4?(s=bindFn(ze.RarLib.doGetRarEntries,this,e,t,i,r,s),ze.App.ensureLibLoadedAndCallback(ze.App.LIB_RAR_WINDOW_OBJECT_CHECK,ze.App.LIB_RAR_SCRIPT_NAME,s)):i("Unexpected RAR version: "+o)},ze.RarLib.doGetRarEntries=function(n,p,a,e,l){logImpression("read_rar_new","rar","start"),MAINAPP.updateLabelsAndProgress("Loading..."),ze.App.blobToByteArrayAsync(n,0,n.size,function(e){try{var t=new FileInfo("default_rar_filename");t.InitStream(e.buffer);var i={};i.password=l?String.fromCharCode.apply(String,l):null;var r=null;try{r=GetRarArchive(t,i)}catch(e){return MAINAPP.zipBlob=n,e.type==RarError.EncryptedNeedPassword?i.password?void a("Incorrect RAR password for encrypted header",!1,!0,!0):void a("RAR Archive header is encrypted but no password specified",!1,!0):e.type==RarError.WrongPassword?void a("Wrong RAR password for encrypted header",!1,!0,!0):void a(e)}var s=r.IsEncrypted();if(console.log("Got RarArchive. Archive Header Encrypted? "+s),s&&!i.password)return void a("RAR Archive header is encrypted but no password specified (2)",!1,!0);var o=r.Entries();return void p(ze.RarLib.translateFilterAndProcessRarLibEntries(o),function(){s&&(MAINAPP.zipEntryTree.isEncrypted=!1,MAINAPP.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED))})}catch(e){return void a("An error occurred when reading the RAR file: "+e)}},a)},ze.RarLib.translateFilterAndProcessRarLibEntries=function(e){for(var t=[],i=0;i<e.length;i++){var r=ze.RarLib.maybeTranslateRarLibEntry(e[i]);r&&t.push(r)}return t},ze.RarLib.maybeTranslateRarLibEntry=function(e){var t=e.FileHeader(),i=t.IsDirectory(),r=(r=t.FileName).replace(/\\/g,"/");if(ze.App.isSystemFile(r,null,i))return null;var s={type:"rar"};return s.originalRarLibEntry=e,s.filename=r,s.originalRarFilename=t.FileName,s.lastModDate=t.FileLastModifiedTime,s.compressedSize=t.CompressedSize,s.uncompressedSize=t.UncompressedSize,s.directory=i,e.IsEncrypted()&&(s.isEncrypted=!0,s.encryptionMode=ze.App.ENCRYPTION_MODE_RAR),s},ze.RarLib.decompressRarEntry=function(e,t,i,r,s,o){var n={};try{t&&t.length&&0<t.length&&(n.password=String.fromCharCode.apply(String,t)),i(new Blob(e.getDecompressedByteArrayParts(n)))}catch(e){console.log(e),r("General RAR Decompression error: "+e);r=(e||"")+" - "+ze.App.getErrorDetailsFromErrorObject(e);n.password?logImpression("rar_decompress_special_error_with_password","rar",r):logImpression("rar_decompress_special_error","rar",r)}},ze.LzipLib={},ze.LzipLib.LZIP_HEADER_SIZE=6,ze.LzipLib.LZIP_FOOTER_SIZE=20,ze.LzipLib.HEADER_SIGNATURE_BYTE_0=76,ze.LzipLib.HEADER_SIGNATURE_BYTE_1=90,ze.LzipLib.HEADER_SIGNATURE_BYTE_2=73,ze.LzipLib.HEADER_SIGNATURE_BYTE_3=80,ze.LzipLib.HEADER_SIGNATURE_BYTE_4=1,ze.LzipLib.MIN_DICTIONARY_SIZE=4096,ze.LzipLib.MAX_DICTIONARY_SIZE=1<<29,ze.LzipLib.verifyLzipFile=function(e,t,i){e.size<ze.LzipLib.LZIP_HEADER_SIZE+ze.LzipLib.LZIP_FOOTER_SIZE?i("LZIP file is less than required size."):ze.App.blobToByteArrayAsync(e,0,ze.LzipLib.LZIP_HEADER_SIZE,function(e){ze.LzipLib.isValidLzipMemberHeader(e)?t(e):(e=ze.App.getStringFromBytes(e),i('File does not appear to be an LZIP V1 file ("'+e+'")'))},i)},ze.LzipLib.getLzipEntry=function(e,t,o,i,r){var n={type:"lzip"},p=ze.App.updateEmbeddedTarFilename(t,"tlz","lz");n.filename=p,ze.LzipLib.getLzipMembersByTail(e,function(e){n.lzipMembers=e;for(var t=0,i=0;i<e.length;i++)t+=e[i].uncompressedSize;n.uncompressedSize=t;for(var r=0,s=0;s<e.length;s++)r+=e[s].compressedSize;n.totalCompressedSize=r,o(n,p)},i)},ze.LzipLib.getLzipMembersByTail=function(e,t,i){ze.LzipLib.doGetLzipMemberByTail(e,e.size,[],t,i)},ze.LzipLib.doGetLzipMemberByTail=function(s,o,n,p,a){var l;o-ze.LzipLib.LZIP_FOOTER_SIZE<0?a("Not enough bytes for LZIP footer. tailOffset: "+o):(l={},n.unshift(l),ze.App.blobToDataViewAsync(s,o-ze.LzipLib.LZIP_FOOTER_SIZE,o,function(e){var t=e.getUint32(0,!0);0===t&&(t=null),l.crc32=t;var r,t=ze.App.readUint64FromDataView(e,4,!0);Number.isSafeInteger(t)?(l.uncompressedSize=t,r=ze.App.readUint64FromDataView(e,12,!0),Number.isSafeInteger(r)&&Number.isSafeInteger(r)?o-r<0?a("LZIP bad (negative) member size"):(l.memberSize=r,l.compressedSize=r-ze.LzipLib.LZIP_HEADER_SIZE-ze.LzipLib.LZIP_FOOTER_SIZE,l.offset=o-r+ze.LzipLib.LZIP_HEADER_SIZE,ze.App.blobToByteArrayAsync(s,o-r,o-r+ze.LzipLib.LZIP_HEADER_SIZE,function(e){if(e.length<ze.LzipLib.LZIP_HEADER_SIZE)a("LZIP member header size is less than required size.");else if(ze.LzipLib.isValidLzipMemberHeader(e)){var t=e[5],i=null;try{i=ze.LzipLib.getLzmaPropertiesFromLzipPackedPropertiesByte(t)}catch(e){return void a(e)}l.lzmaProps=i,o-r==0?p(n):ze.LzipLib.doGetLzipMemberByTail(s,o-r,n,p,a)}else{e=ze.App.getStringFromBytes(e);a('LZIP member has invalid signature ("'+e+'")')}},a)):a("LZIP memberSize > MAX_SAFE_INTEGER")):a("LZIP uncompressedSize > MAX_SAFE_INTEGER")},a))},ze.LzipLib.isValidLzipMemberHeader=function(e){return e[0]==ze.LzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.LzipLib.HEADER_SIGNATURE_BYTE_1&&e[2]==ze.LzipLib.HEADER_SIGNATURE_BYTE_2&&e[3]==ze.LzipLib.HEADER_SIGNATURE_BYTE_3&&e[4]==ze.LzipLib.HEADER_SIGNATURE_BYTE_4},ze.LzipLib.getLzmaPropertiesFromLzipPackedPropertiesByte=function(e){var t=31&e,t=(1<<t)-((224&e)>>5)*(1<<t-4);if(t<ze.LzipLib.MIN_DICTIONARY_SIZE||t>ze.LzipLib.MAX_DICTIONARY_SIZE)throw new Error("LZIP invalid dictionary size: "+t);return new Uint8Array([93,255&t,t>>8&255,t>>16&255,t>>24&255])},ze.LzmaLib={},ze.LzmaLib.LZMA_HEADER_SIZE=13,ze.LzmaLib.verifyLzmaFile=function(e,t,i){e.size<ze.LzmaLib.LZMA_HEADER_SIZE?i("LZMA file size is less than required header size."):ze.App.blobToByteArrayAsync(e,0,ze.LzmaLib.LZMA_HEADER_SIZE,function(e){t(e)},i)},ze.LzmaLib.getLzmaEntry=function(e,t,i,r,s){var o={type:"lzma"};o.decoderProperties=s.slice(0,5);var n=new DataView(s.buffer,5),s=n.getUint32(0,!0),n=n.getUint32(4,!0);if(4294967295!=s||4294967295!=n){n=s+Math.pow(2,32)*n;if(!Number.isSafeInteger(n))return void r("LZMA Entry Uncompressed Size exceeds MAX_SAFE_INTEGER");o.uncompressedSize=n}else o.uncompressedSize=-1;o.filename=ze.App.updateEmbeddedTarFilename(t,"tlz","lzma"),o.offset=ze.LzmaLib.LZMA_HEADER_SIZE,o.compressedSize=e.size-ze.LzmaLib.LZMA_HEADER_SIZE,i(o,o.filename)},ze.XzLib={},ze.XzLib.XZ_HEADER_SIZE=6,ze.XzLib.HEADER_MAGIC_BYTES2=[253,55,122,88,90,0],ze.XzLib.verifyXzFile=function(e,t,i){e.size<ze.XzLib.XZ_HEADER_SIZE?i("XZ file size ("+e.size+") is less than required header size"):ze.App.blobToByteArrayAsync(e,0,ze.XzLib.XZ_HEADER_SIZE,function(e){e[0]==ze.XzLib.HEADER_MAGIC_BYTES2[0]&&e[1]==ze.XzLib.HEADER_MAGIC_BYTES2[1]&&e[2]==ze.XzLib.HEADER_MAGIC_BYTES2[2]&&e[3]==ze.XzLib.HEADER_MAGIC_BYTES2[3]&&e[4]==ze.XzLib.HEADER_MAGIC_BYTES2[4]&&e[5]==ze.XzLib.HEADER_MAGIC_BYTES2[5]?t(e):(e=ze.App.getStringFromBytes(e),i('File does not appear to be an XZ file ("'+e+'")'))},i)},ze.XzLib.getXzEntry=function(e,t,i,r){var s={type:"xz"};s.filename=ze.App.updateEmbeddedTarFilename(t,"txz","xz"),s.compressedSize=e.size,s.uncompressedSize=-1,s.crc32=null,s.offset=0,i(s,s.filename)},ze.BzipLib={},ze.BzipLib.BZIP_SIGNATURE_SIZE=3,ze.BzipLib.HEADER_SIGNATURE_BYTE_0=66,ze.BzipLib.HEADER_SIGNATURE_BYTE_1=90,ze.BzipLib.HEADER_SIGNATURE_BYTE_2=104,ze.BzipLib.bzipLzmaLibraryPendingLoad=!1,ze.BzipLib.additionalPendingBzipLibCallbackFn=null,ze.BzipLib.verifyBzipFile=function(e,t,i){e.size<ze.BzipLib.BZIP_SIGNATURE_SIZE?i("BZIP file size is less than required signature size."):ze.App.blobToByteArrayAsync(e,0,ze.BzipLib.BZIP_SIGNATURE_SIZE,function(e){e[0]==ze.BzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.BzipLib.HEADER_SIGNATURE_BYTE_1&&e[2]==ze.BzipLib.HEADER_SIGNATURE_BYTE_2?t(e):(e=ze.App.getStringFromBytes(e),i('File does not appear to be a Bzip file ("'+e+'")'))},i)},ze.BzipLib.getBzipEntry=function(e,t,i,r){var s={type:"bzip"};s.filename=ze.App.updateEmbeddedTarFilename(t,"tbz2","bz2"),s.filename=ze.App.updateEmbeddedTarFilename(s.filename,"tbz","bz2"),s.compressedSize=e.size,s.offset=0,i(s,s.filename)},ze.GzipLib={},ze.GzipLib.HEADER_SIGNATURE_BYTE_0=31,ze.GzipLib.HEADER_SIGNATURE_BYTE_1=139,ze.GzipLib.COMPRESSION_MODE_DEFLATE=8,ze.GzipLib.GZIP_SIGNATURE_SIZE=2,ze.GzipLib.GZIP_FIXED_HEADER_SIZE=18,ze.GzipLib.GZIP_MAX_HEADER_READ_SIZE=65535,ze.GzipLib.GZIP_FOOTER_SIZE=8,ze.GzipLib.FLAG_FTEXT=1,ze.GzipLib.FLAG_FHCRC=2,ze.GzipLib.FLAG_FEXTRA=4,ze.GzipLib.FLAG_FNAME=8,ze.GzipLib.FLAG_FCOMMENT=16,ze.GzipLib.verifyGzipFile=function(e,t,i){e.size<ze.GzipLib.GZIP_FIXED_HEADER_SIZE?i("GZIP file size is less than required minimum header size."):ze.App.blobToByteArrayAsync(e,0,ze.GzipLib.GZIP_SIGNATURE_SIZE,function(e){e[0]==ze.GzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.GzipLib.HEADER_SIGNATURE_BYTE_1?t(e):(e=ze.App.getStringFromBytes(e),i('File does not appear to be a Gzip file ("'+e+'")'))},i)},ze.GzipLib.getGzipEntry=function(r,s,o,n){var p={type:"gzip"},a=2;ze.App.blobToDataViewAsync(r,0,ze.GzipLib.GZIP_MAX_HEADER_READ_SIZE,function(e){var t,i;p.compressionMethod=e.getUint8(a),a+=1,p.compressionMethod==ze.GzipLib.COMPRESSION_MODE_DEFLATE?(t=e.getUint8(a),p.flags=t,a+=1,t&ze.GzipLib.FLAG_FTEXT?p.ftext=!0:p.ftext=!1,p.mtime=e.getUint32(a,!0),a+=4,p.xflags=e.getUint8(a),a+=1,p.os=e.getUint8(a),a+=1,t&ze.GzipLib.FLAG_FEXTRA&&(p.xlen=e.getUint16(a,!0),a+=2,p.xbytes=new Uint8Array(e.buffer,a,a+p.xlen).slice(),a+=p.xlen),t&ze.GzipLib.FLAG_FNAME?(i=ze.GzipLib.getNullTerminatedStringFromDataView(e,a),p.filename=i,a+=i.length,a+=1):p.filename=ze.App.updateEmbeddedTarFilename(s,"tgz","gz"),t&ze.GzipLib.FLAG_FCOMMENT&&(i=ze.GzipLib.getNullTerminatedStringFromDataView(e,a),p.comment=i,a+=i.length,a+=1),t&ze.GzipLib.FLAG_FHCRC&&(p.fhcrc16=e.getUint16(a,!0),a+=2),p.offset=a,e=r.size-a-ze.GzipLib.GZIP_FOOTER_SIZE,p.compressedSize=e,ze.App.blobToDataViewAsync(r,a+e,a+e+ze.GzipLib.GZIP_FOOTER_SIZE,function(e){p.crc32=e.getUint32(0,!0),0===p.crc32&&(p.crc32=null),p.uncompressedSize=e.getUint32(4,!0),o(p,p.filename)},n)):n("Error: GZIP does not support non-DEFLATE compression method ("+p.compressionMethod+")")},n)},ze.GzipLib.getNullTerminatedStringFromDataView=function(e,t){for(var i,r="",s=e.byteLength,o=t;o<s;o++){if(0===(i=e.getUint8(o)))return r;r+=String.fromCharCode(i)}return r},ze.SevenZLibCore={},ze.SevenZLibCore.SEVENZ_SIGNATURE=[55,122,188,175,39,28,0],ze.SevenZLibCore.SEVENZ_SIGNATURE_STRING=String.fromCharCode(55,122,188,175,39,28,0),ze.SevenZLibCore.SEVENZ_SIGNATURE_SIZE=7,ze.SevenZLibCore.SEVENZ_START_HEADER_SIZE=32,ze.SevenZLibCore.verifySevenZFile=function(e,t,i){e.size<ze.SevenZLibCore.SEVENZ_HEADER_SIZE?i("SevenZ file size is less than required start header size."):ze.App.blobToString(e,0,ze.SevenZLibCore.SEVENZ_SIGNATURE_SIZE,function(e){ze.SevenZLibCore.SEVENZ_SIGNATURE_STRING==e?t():i('File does not appear to be a 7z file, or unsupported version ("'+e+'")')},i)},ze.SevenZLibCore.getSevenZEntries=function(r,s,o,n,p){ze.App.blobToDataViewAsync(r,0,ze.SevenZLibCore.SEVENZ_START_HEADER_SIZE,function(e){zeSevenZLib.getEndHeaderMetaDataFromStartHeader(e,function(e,t,i){ze.App.blobToDataViewAsync(r,e,e+t,function(e){if(0!=i){var t=zeSevenZLib.computeCrc32SliceBy8(new Uint8Array(e.buffer));if(t!=i)return console.log("7z End Header CRC FAIL"),void o("End Header CRC Fail: Expected: "+i+"; got: "+t)}zeSevenZLib.isEndHeaderEncoded(e)?(t=zeSevenZLib.getEncodedHeaderDecodeSequence(e),zeSevenZLib.decodeEncodedHeaderDecodeSequence(r,t,function(e){ze.SevenZLibCore.doGetSevenZEntriesFromDecodedEndHeader(r,e,s,o,n,p)},function(e){MAINAPP.zipBlob=r,"encryptedHeader"==e.type?p?o("Incorrect 7z Password for Encrypted Header",!1,!0,!0):o("7z archive header is encrypted but no password specified",!1,!0):"wrongPassword"==e.type?o("Wrong 7z Password for Encrypted Header",!1,!0,!0):o(e)},n,void 0,p)):ze.SevenZLibCore.doGetSevenZEntriesFromDecodedEndHeader(r,e,s,o,n,p)},o)},o)},o)},ze.SevenZLibCore.doGetSevenZEntriesFromDecodedEndHeader=function(e,t,i,r,s,o){var n=null;try{n=zeSevenZLib.getEntriesFromDecodedEndHeader(t)}catch(e){return void r(e)}i(n,function(){!o||(MAINAPP.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED),MAINAPP.zipEntryTree.isEncrypted=!1)})},ze.TarLib={},ze.TarLib.TAR_TYPE_FILE=0,ze.TarLib.TAR_TYPE_DIR=5,ze.TarLib.TAR_HEADER_SIZE=512,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET=257,ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE=5,ze.TarLib.TAR_TYPE_OFFSET=156,ze.TarLib.TAR_TYPE_SIZE=1,ze.TarLib.TAR_LINKNAME_OFFSET=157,ze.TarLib.TAR_LINKNAME_SIZE=100,ze.TarLib.TAR_SIZE_OFFSET=124,ze.TarLib.TAR_SIZE_SIZE=12,ze.TarLib.TAR_MTIME_OFFSET=136,ze.TarLib.TAR_MTIME_SIZE=12,ze.TarLib.TAR_NAME_OFFSET=0,ze.TarLib.TAR_NAME_SIZE=100,ze.TarLib.TAR_PREFIX_OFFSET=345,ze.TarLib.TAR_PREFIX_SIZE=155,ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING="ustar",ze.TarLib.verifyTarFile=function(e,t,i){e.size<ze.TarLib.TAR_HEADER_SIZE?i("TAR file size is less than required header size."):ze.App.blobToByteArrayAsync(e,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE,function(e){e=ze.TarLib.verifyTarFileSignatureAsResultPair(e,0);e[0]?t():i(e[1])},i)},ze.TarLib.verifyTarFileSignatureAsResultPair=function(e,t){var i=new Array(2);if(e.length<t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE)return i[0]=!1,i[1]="TAR file signature size less than required size",i;var r=ze.App.getStringFromBytes(e,t,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE),s=r==ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING,t=0==e[t]&&0==e[t+1]&&0==e[t+2]&&0==e[t+3]&&0==e[t+4];return s||t?i[0]=!0:(i[0]=!1,i[1]='File does not appear to be a TAR file ("'+r+'")'),i},ze.TarLib.getTarEntriesFromBlob=function(e,t,i,r,s,o){ze.App.blobToByteArrayPartsAsync(e,function(e){try{ze.TarLib.getTarEntriesFromByteArrayParts(e,t,i,r,s,o)}catch(e){return void i(e)}},i,void 0,r,o)},ze.TarLib.getTarEntriesFromByteArrayParts=function(e,t,i,r,s){if(e&&0!=e.length){var o=new ze.JaggedByteArrayPartsWrapper(e),e=new Uint8Array(ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE);o.readBytesIntoBuffer(ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE,e);e=ze.TarLib.verifyTarFileSignatureAsResultPair(e,0);if(e[0]){for(var n=0,p=[],a=o.getSize(),l=new Uint8Array(ze.TarLib.TAR_HEADER_SIZE);n+ze.TarLib.TAR_HEADER_SIZE<a;){o.readBytesIntoBuffer(n,ze.TarLib.TAR_HEADER_SIZE,l);var h=ze.TarLib.getTarEntryFromFileHeader(l,0,s);null!=h&&""!=h.filename&&"."!=h.filename&&".."!=h.filename&&(ze.App.stringContains(h.filename,"PaxHeader/")||ze.App.postProcessEntryFilenameAndMaybeSkip(h)||(h.offset=n,p.push(h))),0<(n+=(h?h.compressedSize:0)+ze.TarLib.TAR_HEADER_SIZE)%ze.TarLib.TAR_HEADER_SIZE&&(n=(1+(n/ze.TarLib.TAR_HEADER_SIZE|0))*ze.TarLib.TAR_HEADER_SIZE)}t(p)}else i(e[1])}else i("Cannot get TAR entries from null or empty tarByteArrayParts")},ze.TarLib.getTarEntryFromFileHeader=function(e,t,i){var r={type:"tar"},s=i?new TextDecoder(i):null;try{var o={},n=null;i?n=s.decode(e.subarray(t+ze.TarLib.TAR_NAME_OFFSET,t+ze.TarLib.TAR_NAME_OFFSET+ze.TarLib.TAR_NAME_SIZE)):(n=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_NAME_OFFSET,t+ze.TarLib.TAR_NAME_OFFSET+ze.TarLib.TAR_NAME_SIZE,o),o.hasExtendedChar&&(r.filenameHasExtendedChar=!0));var p=n.replace(/\0/g,"");if(0===(r.filename=p).length)return void(r.lastBlock=!0);n=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_SIZE_OFFSET,t+ze.TarLib.TAR_SIZE_OFFSET+ze.TarLib.TAR_SIZE_SIZE),p=parseInt(n,8);r.compressedSize=p,r.uncompressedSize=p;var a,n=0|ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_TYPE_OFFSET,t+ze.TarLib.TAR_TYPE_OFFSET+ze.TarLib.TAR_TYPE_SIZE),p=n==ze.TarLib.TAR_TYPE_DIR;return r.directory=p,!r.directory&&0<r.filename.length&&"/"==r.filename.charAt(r.filename.length-1)&&(r.directory=!0),0==e[t+ze.TarLib.TAR_LINKNAME_OFFSET]||(a=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_LINKNAME_OFFSET,t+ze.TarLib.TAR_LINKNAME_OFFSET+ze.TarLib.TAR_LINKNAME_SIZE),r.linkname=a),r.tarChecksum=-1,ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE)==ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING&&(0==e[t+ze.TarLib.TAR_PREFIX_OFFSET]||(a=null,i?a=s.decode(e.subarray(t+ze.TarLib.TAR_PREFIX_OFFSET,t+ze.TarLib.TAR_PREFIX_OFFSET+ze.TarLib.TAR_PREFIX_SIZE)):(a=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_PREFIX_OFFSET,t+ze.TarLib.TAR_PREFIX_OFFSET+ze.TarLib.TAR_PREFIX_SIZE,o),o.hasExtendedChar&&(r.filenameHasExtendedChar=!0)),null!=a&&0<a.length&&(a=a.replace(/\0/g,""),r.filename=a+"/"+r.filename))),n===ze.TarLib.TAR_TYPE_FILE||n===ze.TarLib.TAR_TYPE_DIR?r:null}catch(e){return r.err=e,r}},ze.App.decodeUTF8Bytes=function(e){for(var t,i,r,s="",o=e.length,n=0;n<o;)switch((t=e[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(e[n-1]);break;case 12:case 13:i=e[n++],s+=String.fromCharCode((31&t)<<6|63&i);break;case 14:i=e[n++],r=e[n++],s+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&r)<<0)}return s};var winOpen=window.open;window.open=function(){try{var e,t,i,r,s,o;arguments&&2<arguments.length&&(null!=(o=arguments[2])&&(window.screen.width,e=window.screen.height,i="height=",t=o.indexOf(i),r=o.indexOf(",",t),-1!=t&&-1!=r&&(s=parseInt(o.substring(t+i.length,r)),e=Math.round(Math.min(660,e)),o=o.substring(0,t+i.length)+e+o.substring(r),t="top=",i=o.indexOf(t),r=o.indexOf(",",i),-1!=i&&-1!=r&&(s=parseInt(o.substring(i+t.length,r))-(e-s)/2,o=o.substring(0,i+t.length)+s+o.substring(r)),arguments[2]=o)))}catch(e){logImpression("window_open_height_update_err","app_load",e)}return winOpen.apply(this,arguments)},ze.App.getStackInfoFromErrorObj=function(e){var t,i,r="";try{return e&&(!(t=e.stack)||(i=t.split("\n"))&&i.length&&0<i.length&&(0<=(t=(i[0]||"").trim()).indexOf("@")?(r=t,(t=1<i.length?i[1]:null)&&(r+=" - "+t.trim())):1<i.length&&(r=(i[1]||"").trim(),2<i.length&&((i=i[2]||"")&&(r+=" - "+i.trim()))))),r.trim()}catch(e){return"Error getting stack details: "+e}},ze.App.blobToByteArrayPartsAsync=function(e,t,i,r,s,o){r=r||20971520;ze.App.doReadBlobIntoByteArrayParts(e,r,0,t,i,[],s,o)},ze.App.doReadBlobIntoByteArrayParts=function(t,i,e,r,s,o,n,p){var a=Math.min(e+i,t.size);n&&n(a,t.size,!0,p),ze.App.blobToByteArrayAsync(t,e,a,function(e){o.push(e),a==t.size?r(o):ze.App.doReadBlobIntoByteArrayParts(t,i,a,r,s,o,n,p)},s)},ze.JaggedByteArrayPartsWrapper=function(e){if(!e)throw new Error("JaggedByteArrayPartsWrapper Error: byteArrayParts cannot be null");if(null==e.length)throw new Error("JaggedByteArrayPartsWrapper Error: byteArrayParts must be an array");if(0<e.length&&(null==e[0].length||!(e[0]instanceof Uint8Array)))throw new Error("JaggedByteArrayPartsWrapper Error: byteArrayParts must be an array of byte (Uint8) Arrays");this.byteArrayParts_=e,this.numRows_=this.byteArrayParts_.length,this.tmpRowColPair_=Array(2),this.rowLengths_=null,this.cumulativeRowOffsets_=null,this.totalSize_=null,this.indexByteArrayParts_()},ze.JaggedByteArrayPartsWrapper.prototype.indexByteArrayParts_=function(){this.rowLengths_=[],this.cumulativeRowOffsets_=[];for(var e=0,t=0;t<this.byteArrayParts_.length;t++){var i=this.byteArrayParts_[t].length;this.rowLengths_.push(i),e+=i,this.cumulativeRowOffsets_.push(e)}this.totalSize_=e},ze.JaggedByteArrayPartsWrapper.prototype.doReadOrWriteByteAtAndGetSubscripts_=function(e,t,i,r){var s=this.numRows_,i=i||0,o=t||this.tmpRowColPair_;if(s<=i)throw new Error("JaggedByteArrayPartsWrapper: startRow cannot exeed the number of rows");var n=this.cumulativeRowOffsets_;if(e<n[i])return o[0]=i,o[1]=e-(0==i?0:n[i-1]),null!=r?(this.byteArrayParts_[o[0]][o[1]]=r,i):this.byteArrayParts_[o[0]][o[1]];for(var p=++i;p<s;p++)if(e<n[p])return o[0]=p,o[1]=e-n[p-1],null!=r?(this.byteArrayParts_[o[0]][o[1]]=r,p):this.byteArrayParts_[o[0]][o[1]];throw new Error("JaggedByteArrayPartsWrapper: Could not resolve subscripts for idx: "+e)},ze.JaggedByteArrayPartsWrapper.prototype.doReadByteIntoBuffer_=function(e,t,i,r){return t[r||0]=this.doReadOrWriteByteAtAndGetSubscripts_(e,this.tmpRowColPair_,i),this.tmpRowColPair_[0]},ze.JaggedByteArrayPartsWrapper.prototype.readBytesIntoBufferSimple=function(e,t,i,r){for(var s=null,o=0;o<t;o++)s=this.doReadByteIntoBuffer_(e+o,i,s,r)},ze.JaggedByteArrayPartsWrapper.prototype.readBytesIntoBuffer=function(e,t,i,r){if(t!=i.length)throw new Error("JaggedByteArrayPartsWrapper: length of bytes to read is larger than the byteArray buffer");if(t-e>this.totalSize_)throw new Error("JaggedByteArrayPartsWrapper: read() length minus offset exceeds total size");for(var s,o,n,p,a,l=r||0,h=0,d=0;d<t;)this.doReadOrWriteByteAtAndGetSubscripts_(e+d,this.tmpRowColPair_,h),h=this.tmpRowColPair_[0],n=o=this.tmpRowColPair_[1],a=t-d,p=Math.min(this.byteArrayParts_[h].length,o+a),s=new Uint8Array(this.byteArrayParts_[h].buffer,n,p-n),i.set(s,l+d),d+=s.length},ze.JaggedByteArrayPartsWrapper.prototype.readByteAt=function(e,t,i){return this.doReadOrWriteByteAtAndGetSubscripts_(e,t,i)},ze.JaggedByteArrayPartsWrapper.prototype.getRowAt=function(e){return this.doReadOrWriteByteAtAndGetSubscripts_(e,this.tmpRowColPair_),this.tmpRowColPair_[0]},ze.JaggedByteArrayPartsWrapper.prototype.writeByteAt=function(e,t,i){return this.doReadOrWriteByteAtAndGetSubscripts_(e,void 0,i,t)},ze.JaggedByteArrayPartsWrapper.prototype.getSize=function(){return this.totalSize_},ze.JaggedByteArrayPartsWrapper.prototype.trimToMaxLength=function(e){e=this.totalSize_-e;return 0<e?this.trimBytes_(e):0},ze.JaggedByteArrayPartsWrapper.prototype.trimBytes_=function(e){if(e>this.totalSize_)throw new Error("Error: numBytesToTrim exceeds the total size");for(var t=e,i=0,r=this.numRows_-1;0<t;){var s=this.byteArrayParts_[r].length;t<s?(this.byteArrayParts_[r]=new Uint8Array(this.byteArrayParts_[r].buffer,this.byteArrayParts_[r].byteOffset,s-t),t=0):(i++,t-=s),r--}if(this.byteArrayParts_.length=this.byteArrayParts_.length-i,0!=t)throw new Error("Expected numTrimBytesRemaining to be 0 in JaggedByteArrayPartsWrapper.trimBytes_()");return this.indexByteArrayParts_(),e},ze.JaggedByteArrayPartsWrapper.prototype.toBlob=function(){return new Blob(this.byteArrayParts_)},ze.JaggedByteArrayPartsWrapper.prototype.getByteArrayParts=function(){return this.byteArrayParts_};